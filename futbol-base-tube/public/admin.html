<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Futbol Base Total</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0d9f4f;
            --primary-dark: #0a7a3d;
            --accent: #f5c518;
            --dark: #0f0f1a;
            --dark-card: #16162a;
            --dark-border: #2a2a4a;
            --text: #ffffff;
            --text-muted: #8b8ba7;
            --success: #22c55e;
            --danger: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--dark); color: var(--text); min-height: 100vh; }
        
        .header { background: var(--dark-card); padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--dark-border); }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 44px; height: 44px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .logo-text { font-family: 'Bebas Neue', sans-serif; font-size: 24px; }
        .logo-text span { color: var(--primary); }
        
        .connection-status { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--dark); border-radius: 8px; font-size: 13px; border: 1px solid var(--dark-border); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--danger); }
        .status-dot.connected { background: var(--success); }
        
        .tabs { display: flex; background: var(--dark-card); border-bottom: 1px solid var(--dark-border); padding: 0 24px; }
        .tab { padding: 16px 24px; color: var(--text-muted); cursor: pointer; border-bottom: 3px solid transparent; font-weight: 500; }
        .tab:hover { color: var(--text); background: rgba(255,255,255,0.03); }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        .panel { display: none; padding: 32px; min-height: calc(100vh - 130px); }
        .panel.active { display: block; }
        
        .config-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 20px; padding: 32px; max-width: 550px; margin: 0 auto; }
        .config-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; margin-bottom: 8px; text-align: center; }
        .config-subtitle { color: var(--text-muted); margin-bottom: 32px; text-align: center; }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; }
        .form-input { width: 100%; padding: 14px 18px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; color: var(--text); font-size: 14px; font-family: inherit; }
        .form-input:focus { outline: none; border-color: var(--primary); }
        .form-select { width: 100%; padding: 14px 18px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; color: var(--text); font-size: 14px; cursor: pointer; }
        .form-textarea { min-height: 80px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
        .form-row-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px; }
        .filled { border-color: var(--success) !important; background: rgba(34, 197, 94, 0.05) !important; }
        
        .btn { padding: 14px 28px; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; border: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(13, 159, 79, 0.4); }
        .btn-primary:disabled { background: var(--dark-border); cursor: not-allowed; transform: none; }
        .btn-youtube { background: #ff0000; color: white; }
        .btn-twitter { background: #1da1f2; color: white; }
        .btn-instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; }
        
        .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 24px; }
        .add-layout { display: grid; grid-template-columns: 1fr 350px; gap: 32px; max-width: 1200px; margin: 0 auto; }
        
        .source-selector { display: flex; gap: 16px; margin-bottom: 24px; }
        .source-btn { flex: 1; padding: 18px; background: var(--dark-card); border: 2px solid var(--dark-border); border-radius: 14px; color: var(--text-muted); font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .source-btn.active.youtube { border-color: #ff0000; background: rgba(255, 0, 0, 0.1); color: #ff0000; }
        .source-btn.active.twitter { border-color: #1da1f2; background: rgba(29, 161, 242, 0.1); color: #1da1f2; }
        .source-btn.active.instagram { border-color: #e1306c; background: rgba(225, 48, 108, 0.1); color: #e1306c; }
        
        .form-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .form-card-title { font-size: 13px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--dark-border); }
        
        .url-row { display: flex; gap: 12px; }
        .url-row .form-input { flex: 1; }
        .url-status { margin-top: 10px; font-size: 13px; min-height: 20px; }
        .url-status.success { color: var(--success); }
        .url-status.error { color: var(--danger); }
        .url-status.loading { color: var(--accent); }
        
        /* FAMILIA GRID - 4 FAMILIAS */
        .familia-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
        .familia-option { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 14px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .familia-option:hover { border-color: var(--text-muted); transform: translateY(-2px); }
        .familia-option.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); }
        .familia-icon { font-size: 28px; }
        .familia-name { font-size: 12px; font-weight: 600; }
        .familia-extra { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--dark-border); display: none; }
        .familia-extra.show { display: block; }
        
        .category-pills { display: flex; flex-wrap: wrap; gap: 8px; max-height: 200px; overflow-y: auto; padding: 4px; }
        .category-pill { padding: 8px 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.2s; user-select: none; white-space: nowrap; }
        .category-pill:hover { border-color: var(--text-muted); }
        .category-pill.active { background: var(--primary); border-color: var(--primary); color: white; }
        
        .custom-input-row { display: none; margin-top: 12px; }
        .custom-input-row.show { display: block; }
        
        .preview-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 16px; overflow: hidden; position: sticky; top: 24px; }
        .preview-header { padding: 16px 20px; border-bottom: 1px solid var(--dark-border); font-size: 13px; color: var(--text-muted); font-weight: 600; }
        .preview-media { aspect-ratio: 16/9; background: var(--dark); display: flex; align-items: center; justify-content: center; position: relative; }
        .preview-media img { width: 100%; height: 100%; object-fit: cover; }
        .preview-badge { position: absolute; top: 10px; left: 10px; padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; }
        .preview-badge.youtube { background: #ff0000; }
        .preview-duration { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.85); padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .preview-lang { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.85); padding: 4px 8px; border-radius: 4px; font-size: 14px; }
        .preview-body { padding: 20px; }
        .preview-title { font-size: 15px; font-weight: 700; margin-bottom: 6px; }
        .preview-title.placeholder { color: var(--text-muted); }
        .preview-meta { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; }
        .preview-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .preview-tag { padding: 4px 10px; background: rgba(139, 92, 246, 0.2); color: #a78bfa; border-radius: 12px; font-size: 11px; }
        .preview-tag.dif { background: rgba(245, 197, 24, 0.2); color: var(--accent); }
        .preview-tag.fam { background: rgba(13, 159, 79, 0.2); color: var(--primary); }
        
        .library-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
        .library-filters { display: flex; gap: 12px; flex-wrap: wrap; }
        .search-input { width: 220px; padding: 12px 16px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; }
        .filter-select { padding: 12px 16px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; min-width: 130px; }
        .library-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .exercise-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 14px; overflow: hidden; transition: all 0.3s; }
        .exercise-card:hover { border-color: var(--primary); transform: translateY(-4px); }
        .exercise-thumb { position: relative; aspect-ratio: 16/9; background: var(--dark); }
        .exercise-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .exercise-source { position: absolute; top: 8px; left: 8px; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; }
        .exercise-source.youtube { background: #ff0000; }
        .exercise-source.twitter { background: #1da1f2; }
        .exercise-source.instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
        .exercise-familia { position: absolute; bottom: 8px; left: 8px; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; background: var(--primary); }
        .exercise-lang { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .exercise-body { padding: 16px; }
        .exercise-title { font-weight: 600; margin-bottom: 6px; font-size: 14px; }
        .exercise-meta { font-size: 12px; color: var(--text-muted); margin-bottom: 10px; }
        .exercise-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px; }
        .exercise-tag { padding: 2px 8px; background: rgba(139, 92, 246, 0.2); color: #a78bfa; border-radius: 10px; font-size: 10px; }
        .exercise-actions { display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--dark-border); }
        .exercise-actions button { flex: 1; padding: 10px; border: none; border-radius: 8px; font-size: 12px; cursor: pointer; }
        .btn-view { background: rgba(13, 159, 79, 0.15); color: var(--primary); }
        .btn-delete { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        
        .empty-state { text-align: center; padding: 60px 40px; color: var(--text-muted); grid-column: 1 / -1; }
        .empty-icon { font-size: 48px; margin-bottom: 12px; }
        .empty-title { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 6px; }
        
        .stats-bar { display: none; gap: 20px; padding: 8px 16px; background: var(--dark); border-radius: 8px; }
        .stats-bar.show { display: flex; }
        .stat-item { text-align: center; }
        .stat-value { font-weight: 700; color: var(--primary); font-size: 16px; }
        .stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; }
        
        .toast { position: fixed; bottom: 24px; right: 24px; padding: 16px 24px; border-radius: 12px; font-weight: 500; transform: translateY(100px); opacity: 0; transition: all 0.3s; z-index: 1000; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { background: var(--success); color: white; }
        .toast.error { background: var(--danger); color: white; }
        
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .loading-overlay.show { display: flex; }
        .spinner { width: 40px; height: 40px; border: 3px solid var(--dark-border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 1024px) { .add-layout { grid-template-columns: 1fr; } .preview-card { position: static; } }
        @media (max-width: 768px) { .form-row, .form-row-3, .form-row-4 { grid-template-columns: 1fr; } .url-row { flex-direction: column; } .source-selector { flex-direction: column; } .library-filters { width: 100%; } .search-input { width: 100%; } .familia-grid { grid-template-columns: repeat(2, 1fr); } }

        .pending-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; }
        .pending-card { background: var(--dark-card); border: 2px solid #f59e0b; border-radius: 16px; overflow: hidden; }
        .pending-card.duplicate { border-color: var(--danger); }
        .pending-card.admin-upload { border-color: var(--primary); }
        .pending-card-header { display: flex; gap: 16px; padding: 16px; }
        .pending-card-thumb { width: 140px; height: 80px; border-radius: 8px; object-fit: cover; background: var(--dark); flex-shrink: 0; }
        .pending-card-info { flex: 1; min-width: 0; }
        .pending-card-title { font-weight: 700; font-size: 14px; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .pending-card-meta { font-size: 11px; color: var(--text-muted); display: flex; flex-wrap: wrap; gap: 6px; }
        .pending-card-body { padding: 0 16px 16px; }
        .pending-card-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .pending-card-tag { padding: 3px 8px; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border-radius: 10px; font-size: 10px; }
        .pending-card-url { font-size: 11px; color: var(--text-muted); word-break: break-all; margin-bottom: 12px; padding: 8px; background: var(--dark); border-radius: 8px; }
        .pending-card-duplicate { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; padding: 10px; margin-bottom: 12px; font-size: 11px; color: var(--danger); }
        .pending-card-admin { background: rgba(13, 159, 79, 0.1); border: 1px solid var(--primary); border-radius: 8px; padding: 8px; margin-bottom: 12px; font-size: 11px; color: var(--primary); font-weight: 600; }
        .pending-card-actions { display: flex; gap: 8px; }
        .pending-card-actions .btn { flex: 1; justify-content: center; font-size: 12px; padding: 10px 14px; }
        .btn-approve { background: rgba(34, 197, 94, 0.15); color: var(--success); border: none; border-radius: 10px; cursor: pointer; }
        .btn-approve:hover { background: var(--success); color: white; }
        .btn-reject { background: rgba(239, 68, 68, 0.15); color: var(--danger); border: none; border-radius: 10px; cursor: pointer; }
        .btn-reject:hover { background: var(--danger); color: white; }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: var(--dark-card); border-radius: 16px; padding: 24px; max-width: 450px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 16px; right: 16px; background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer; }
        .reject-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; margin-bottom: 16px; color: var(--danger); }
        .reject-reasons { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .reject-reason { padding: 12px 16px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 10px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .reject-reason:hover { border-color: var(--danger); }
        .reject-reason.selected { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); }

        .stats-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 24px; }
        .stat-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; padding: 16px; text-align: center; }
        .stat-card.warning { border-color: #f59e0b; }
        .stat-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 32px; color: var(--primary); }
        .stat-card.warning .stat-card-value { color: #f59e0b; }
        .stat-card-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }
        
        .pending-badge { background: #f59e0b; color: var(--dark); padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: 600; }

        @media (max-width: 768px) { .pending-grid { grid-template-columns: 1fr; } .pending-card-header { flex-direction: column; } .pending-card-thumb { width: 100%; height: 120px; } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading"><div class="spinner"></div></div>
    <div class="toast" id="toast"></div>
    
    <header class="header">
        <div class="logo">
            <div class="logo-icon">‚öΩ</div>
            <div class="logo-text">FUTBOL <span>BASE</span> TOTAL</div>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <div class="stats-bar" id="statsBar">
                <div class="stat-item"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Total</div></div>
                <div class="stat-item"><div class="stat-value" id="statYT">0</div><div class="stat-label">YouTube</div></div>
                <div class="stat-item"><div class="stat-value" id="statTW">0</div><div class="stat-label">Twitter</div></div>
            </div>
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Desconectado</span>
            </div>
        </div>
    </header>
    
    <nav class="tabs">
        <div class="tab active" id="tabConfig">‚öôÔ∏è Configuraci√≥n</div>
        <div class="tab" id="tabAdd">‚ûï A√±adir Ejercicio</div>
        <div class="tab" id="tabLibrary">üìö Biblioteca</div>
        <div class="tab" id="tabPending">üìã Pendientes <span class="pending-badge" id="pendingCount" style="display:none;">0</span></div>
    </nav>
    
    <!-- CONFIG -->
    <div class="panel active" id="panelConfig">
        <div class="config-card">
            <h1 class="config-title">‚öôÔ∏è CONFIGURACI√ìN</h1>
            <p class="config-subtitle">Conecta tu base de datos Supabase</p>
            <div class="form-group">
                <label class="form-label">üîó Supabase URL</label>
                <input type="text" id="inputUrl" class="form-input" placeholder="https://xxxxx.supabase.co">
            </div>
            <div class="form-group">
                <label class="form-label">üîë Supabase Anon Key</label>
                <input type="text" id="inputKey" class="form-input" placeholder="eyJhbGci...">
            </div>
            <div class="form-group">
                <label class="form-label">üì∫ YouTube API Key (opcional)</label>
                <input type="text" id="inputYT" class="form-input" placeholder="AIzaSy...">
            </div>
            <button class="btn btn-primary" style="width: 100%;" id="btnSaveConfig">üíæ Guardar y Conectar</button>
            <p style="margin-top: 20px; font-size: 12px; color: var(--text-muted); text-align: center;" id="loadStatus">Cargando librer√≠a Supabase...</p>
        </div>
    </div>
    
    <!-- ADD -->
    <div class="panel" id="panelAdd">
        <div class="add-layout">
            <div>
                <h1 class="section-title">‚ûï A√ëADIR EJERCICIO</h1>
                <div class="source-selector">
                    <button class="source-btn active youtube" id="srcYT">üì∫ YouTube</button>
                    <button class="source-btn twitter" id="srcTW">ùïè Twitter/X</button>
                    <button class="source-btn instagram" id="srcIG">üì∑ Instagram</button>
                </div>
                
                <div class="form-card">
                    <h3 class="form-card-title" id="urlTitle">üì∫ URL del Video</h3>
                    <div class="url-row">
                        <input type="text" id="inputVideoUrl" class="form-input" placeholder="https://www.youtube.com/watch?v=...">
                        <button class="btn btn-youtube" id="btnExtract">‚ñ∂ Extraer</button>
                    </div>
                    <div class="url-status" id="urlStatus"></div>
                </div>
                
                <div class="form-card">
                    <h3 class="form-card-title">üìù Datos del Video</h3>
                    <div class="form-group">
                        <label class="form-label">T√≠tulo del Video</label>
                        <input type="text" id="inputTituloVideo" class="form-input" placeholder="Se extraer√° autom√°ticamente...">
                    </div>
                    <div class="form-row-3">
                        <div class="form-group">
                            <label class="form-label">Canal / Autor</label>
                            <input type="text" id="inputCanal" class="form-input" placeholder="Canal...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duraci√≥n</label>
                            <input type="text" id="inputDuracion" class="form-input" placeholder="0:00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üåç Idioma</label>
                            <select id="inputIdioma" class="form-select">
                                <option value="es">üá™üá∏ Espa√±ol</option>
                                <option value="en">üá¨üáß Ingl√©s</option>
                                <option value="pt">üáµüáπ Portugu√©s</option>
                                <option value="it">üáÆüáπ Italiano</option>
                                <option value="de">üá©üá™ Alem√°n</option>
                                <option value="fr">üá´üá∑ Franc√©s</option>
                                <option value="other">üåê Otro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row-3">
                        <div class="form-group">
                            <label class="form-label">üëÅÔ∏è Vistas</label>
                            <input type="text" id="inputVistas" class="form-input" placeholder="Se extrae autom√°tico" readonly style="cursor:default;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚ù§Ô∏è Likes</label>
                            <input type="text" id="inputLikes" class="form-input" placeholder="Se extrae autom√°tico" readonly style="cursor:default;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üìÖ Fecha Publicaci√≥n</label>
                            <input type="text" id="inputFechaPublicacion" class="form-input" placeholder="Se extrae autom√°tico" readonly style="cursor:default;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n</label>
                        <textarea id="inputDesc" class="form-input form-textarea" placeholder="Descripci√≥n..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3 class="form-card-title">üìÇ FAMILIA DEL CONTENIDO *</h3>
                    <div class="familia-grid">
                        <div class="familia-option" onclick="selectFamilia('futbol_base')">
                            <span class="familia-icon">‚öΩ</span>
                            <span class="familia-name">F√∫tbol Base</span>
                        </div>
                        <div class="familia-option" onclick="selectFamilia('profesional')">
                            <span class="familia-icon">üèüÔ∏è</span>
                            <span class="familia-name">Profesional</span>
                        </div>
                        <div class="familia-option" onclick="selectFamilia('entrevista')">
                            <span class="familia-icon">üé§</span>
                            <span class="familia-name">Entrevista</span>
                        </div>
                        <div class="familia-option" onclick="selectFamilia('analisis')">
                            <span class="familia-icon">üìä</span>
                            <span class="familia-name">An√°lisis T√°ctico</span>
                        </div>
                    </div>
                    
                    <!-- Extra para Profesional -->
                    <div class="familia-extra" id="familiaExtraProfesional">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Entrenador</label>
                                <select id="inputEntrenador" class="form-select">
                                    <option value="">Sin especificar</option>
                                    <option value="Pep Guardiola">Pep Guardiola</option>
                                    <option value="J√ºrgen Klopp">J√ºrgen Klopp</option>
                                    <option value="Carlo Ancelotti">Carlo Ancelotti</option>
                                    <option value="Diego Simeone">Diego Simeone</option>
                                    <option value="Xavi Hern√°ndez">Xavi Hern√°ndez</option>
                                    <option value="Mikel Arteta">Mikel Arteta</option>
                                    <option value="Luis Enrique">Luis Enrique</option>
                                    <option value="Hansi Flick">Hansi Flick</option>
                                    <option value="Xabi Alonso">Xabi Alonso</option>
                                    <option value="Marcelo Bielsa">Marcelo Bielsa</option>
                                    <option value="_otro">‚ûï Otro...</option>
                                </select>
                                <div class="custom-input-row" id="customEntrenador">
                                    <input type="text" id="inputEntrenadorCustom" class="form-input" placeholder="Nombre del entrenador...">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Equipo</label>
                                <select id="inputEquipo" class="form-select">
                                    <option value="">Sin especificar</option>
                                    <optgroup label="üá™üá∏ Espa√±a"><option value="FC Barcelona">FC Barcelona</option><option value="Real Madrid">Real Madrid</option><option value="Atl√©tico Madrid">Atl√©tico Madrid</option><option value="Athletic Bilbao">Athletic Bilbao</option></optgroup>
                                    <optgroup label="üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Inglaterra"><option value="Manchester City">Manchester City</option><option value="Liverpool">Liverpool</option><option value="Arsenal">Arsenal</option><option value="Chelsea">Chelsea</option></optgroup>
                                    <optgroup label="üá©üá™ Alemania"><option value="Bayern Munich">Bayern Munich</option><option value="Borussia Dortmund">Borussia Dortmund</option><option value="Bayer Leverkusen">Bayer Leverkusen</option></optgroup>
                                    <optgroup label="üáÆüáπ Italia"><option value="Juventus">Juventus</option><option value="AC Milan">AC Milan</option><option value="Inter Milan">Inter Milan</option><option value="Napoli">Napoli</option></optgroup>
                                    <optgroup label="üåç Selecciones"><option value="Espa√±a">Espa√±a</option><option value="Alemania">Alemania</option><option value="Francia">Francia</option><option value="Argentina">Argentina</option></optgroup>
                                    <option value="_otro">‚ûï Otro...</option>
                                </select>
                                <div class="custom-input-row" id="customEquipo">
                                    <input type="text" id="inputEquipoCustom" class="form-input" placeholder="Nombre del equipo...">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Extra para An√°lisis -->
                    <div class="familia-extra" id="familiaExtraAnalisis">
                        <div class="form-group">
                            <label class="form-label">Sistema T√°ctico Analizado</label>
                            <select id="inputSistema" class="form-select">
                                <option value="">Sin especificar</option>
                                <option value="4-3-3">4-3-3</option>
                                <option value="4-4-2">4-4-2</option>
                                <option value="4-2-3-1">4-2-3-1</option>
                                <option value="3-5-2">3-5-2</option>
                                <option value="3-4-3">3-4-3</option>
                                <option value="5-3-2">5-3-2</option>
                                <option value="Varios">Varios sistemas</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3 class="form-card-title">‚öΩ Datos del Ejercicio</h3>
                    <div class="form-group">
                        <label class="form-label">T√≠tulo del Ejercicio *</label>
                        <input type="text" id="inputTitulo" class="form-input" placeholder="Ej: RONDO 4x4+3 POSICIONAL">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categor√≠as/Temas * (click para seleccionar)</label>
                        <div class="category-pills" id="categoryPills">
                            <span class="category-pill" data-cat="Rondos">üîÑ Rondos</span>
                            <span class="category-pill" data-cat="Posesi√≥n">‚öΩ Posesi√≥n</span>
                            <span class="category-pill" data-cat="Finalizaci√≥n">ü•Ö Finalizaci√≥n</span>
                            <span class="category-pill" data-cat="Transiciones">‚ö° Transiciones</span>
                            <span class="category-pill" data-cat="Pressing">üèÉ Pressing</span>
                            <span class="category-pill" data-cat="F√≠sico">üí™ F√≠sico</span>
                            <span class="category-pill" data-cat="T√©cnica">üéØ T√©cnica</span>
                            <span class="category-pill" data-cat="Porteros">üß§ Porteros</span>
                            <span class="category-pill" data-cat="T√°ctico">üìã T√°ctico</span>
                            <span class="category-pill" data-cat="Calentamiento">üî• Calentamiento</span>
                            <span class="category-pill" data-cat="SSG">üéÆ SSG</span>
                            <span class="category-pill" data-cat="Partidos Reducidos">‚öîÔ∏è Partidos Reducidos</span>
                            <span class="category-pill" data-cat="Defensa">üõ°Ô∏è Defensa</span>
                            <span class="category-pill" data-cat="Ataque">‚öîÔ∏è Ataque</span>
                            <span class="category-pill" data-cat="Centros/Remates">üéØ Centros/Remates</span>
                            <span class="category-pill" data-cat="Jugadas Ensayadas">üìê Jugadas Ensayadas</span>
                            <span class="category-pill" data-cat="Conducci√≥n">ü¶∂ Conducci√≥n</span>
                            <span class="category-pill" data-cat="Pase">‚û°Ô∏è Pase</span>
                            <span class="category-pill" data-cat="Control">üé± Control</span>
                            <span class="category-pill" data-cat="Velocidad">üí® Velocidad</span>
                            <span class="category-pill" data-cat="Coordinaci√≥n">ü§∏ Coordinaci√≥n</span>
                        </div>
                    </div>
                    
                    <div class="form-row-4">
                        <div class="form-group"><label class="form-label">Dificultad *</label><select id="inputDif" class="form-select"><option value="">Seleccionar</option><option value="1">1 - Muy f√°cil</option><option value="2">2 - F√°cil</option><option value="3">3 - Media</option><option value="4">4 - Dif√≠cil</option><option value="5">5 - Muy dif√≠cil</option></select></div>
                        <div class="form-group"><label class="form-label">N¬∫ Jugadores</label><select id="inputJugadores" class="form-select"><option value="">-</option><option value="2-4">2-4</option><option value="5-8">5-8</option><option value="9-12">9-12</option><option value="13-16">13-16</option><option value="17-20">17-20</option><option value="20+">20+</option></select></div>
                        <div class="form-group"><label class="form-label">N¬∫ Porteros</label><select id="inputPorteros" class="form-select"><option value="">-</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3+">3+</option></select></div>
                        <div class="form-group"><label class="form-label">Edad</label><select id="inputEdad" class="form-select"><option value="">-</option><option value="Prebenjam√≠n">Prebenjam√≠n</option><option value="Benjam√≠n">Benjam√≠n</option><option value="Alev√≠n">Alev√≠n</option><option value="Infantil">Infantil</option><option value="Cadete">Cadete</option><option value="Juvenil">Juvenil</option><option value="Senior">Senior</option><option value="Profesional">Profesional</option></select></div>
                    </div>
                    
                    <div class="form-row-3">
                        <div class="form-group"><label class="form-label">Dimensiones</label><select id="inputDimensiones" class="form-select"><option value="">-</option><option value="10x10m">10x10m</option><option value="15x15m">15x15m</option><option value="20x20m">20x20m</option><option value="30x30m">30x30m</option><option value="Medio campo">Medio campo</option><option value="Campo completo">Campo completo</option></select></div>
                        <div class="form-group"><label class="form-label">Material</label><select id="inputMaterial" class="form-select"><option value="">-</option><option value="Conos">Conos</option><option value="Conos, petos">Conos, petos</option><option value="Conos, petos, porter√≠as">Conos, petos, porter√≠as</option><option value="Varios">Varios</option></select></div>
                        <div class="form-group"><label class="form-label">Intensidad</label><select id="inputIntensidad" class="form-select"><option value="">-</option><option value="Baja">üü¢ Baja</option><option value="Media">üü° Media</option><option value="Alta">üî¥ Alta</option></select></div>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 12px;" id="btnSave" disabled>üíæ Guardar (sin XP - Admin)</button>
                </div>
            </div>
            <div>
                <div class="preview-card">
                    <div class="preview-header">üëÅÔ∏è Vista Previa</div>
                    <div class="preview-media" id="previewMedia"><div style="color: var(--text-muted); text-align: center;"><div style="font-size: 40px; margin-bottom: 8px;">üé¨</div><div style="font-size: 13px;">Pega una URL</div></div></div>
                    <div class="preview-body">
                        <div class="preview-title placeholder" id="previewTitle">T√≠tulo del ejercicio</div>
                        <div class="preview-meta" id="previewMeta">Canal ‚Ä¢ Duraci√≥n</div>
                        <div class="preview-tags" id="previewTags"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LIBRARY -->
    <div class="panel" id="panelLibrary">
        <div class="library-header">
            <h1 class="section-title">üìö BIBLIOTECA</h1>
            <div class="library-filters">
                <input type="text" class="search-input" id="searchInput" placeholder="üîç Buscar...">
                <select class="filter-select" id="filterFamilia">
                    <option value="">üìÇ Familia</option>
                    <option value="futbol_base">‚öΩ F√∫tbol Base</option>
                    <option value="profesional">üèüÔ∏è Profesional</option>
                    <option value="entrevista">üé§ Entrevista</option>
                    <option value="analisis">üìä An√°lisis T√°ctico</option>
                </select>
                <select class="filter-select" id="filterSource">
                    <option value="">üì∫ Fuente</option>
                    <option value="youtube">üì∫ YouTube</option>
                    <option value="twitter">ùïè Twitter</option>
                    <option value="instagram">üì∑ Instagram</option>
                </select>
                <select class="filter-select" id="filterIdioma">
                    <option value="">üåç Idioma</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="en">üá¨üáß Ingl√©s</option>
                    <option value="pt">üáµüáπ Portugu√©s</option>
                </select>
                <select class="filter-select" id="filterEdad">
                    <option value="">üë∂ Edad</option>
                    <option value="Prebenjam√≠n">Prebenjam√≠n</option>
                    <option value="Benjam√≠n">Benjam√≠n</option>
                    <option value="Alev√≠n">Alev√≠n</option>
                    <option value="Infantil">Infantil</option>
                    <option value="Cadete">Cadete</option>
                    <option value="Juvenil">Juvenil</option>
                    <option value="Senior">Senior</option>
                    <option value="Profesional">Profesional</option>
                </select>
            </div>
        </div>
        <div class="library-grid" id="libraryGrid"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No hay ejercicios</div></div></div>
    </div>

    <!-- PENDING -->
    <div class="panel" id="panelPending">
        <div class="stats-cards">
            <div class="stat-card warning"><div class="stat-card-value" id="statPending">0</div><div class="stat-card-label">Pendientes</div></div>
            <div class="stat-card"><div class="stat-card-value" id="statApproved">0</div><div class="stat-card-label">Aprobados hoy</div></div>
            <div class="stat-card"><div class="stat-card-value" id="statRejected">0</div><div class="stat-card-label">Rechazados hoy</div></div>
        </div>
        <h1 class="section-title">üìã EJERCICIOS PENDIENTES</h1>
        <div class="pending-grid" id="pendingGrid"><div class="empty-state"><div class="empty-icon">‚úÖ</div><div class="empty-title">No hay ejercicios pendientes</div></div></div>
    </div>

    <!-- Reject Modal -->
    <div class="modal-overlay" id="rejectOverlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeRejectModal()">√ó</button>
            <h2 class="reject-title">‚ùå Rechazar Ejercicio</h2>
            <div class="reject-reasons" id="rejectReasons">
                <div class="reject-reason" onclick="selectRejectReason(this, 'mal_etiquetado')">üè∑Ô∏è <strong>Mal etiquetado</strong></div>
                <div class="reject-reason" onclick="selectRejectReason(this, 'duplicado')">üìã <strong>Duplicado</strong></div>
                <div class="reject-reason" onclick="selectRejectReason(this, 'calidad')">üìâ <strong>Calidad insuficiente</strong></div>
                <div class="reject-reason" onclick="selectRejectReason(this, 'pizarra_incorrecta')">üé® <strong>Pizarra incorrecta</strong></div>
                <div class="reject-reason" onclick="selectRejectReason(this, 'otro')">‚ùì <strong>Otro motivo</strong></div>
            </div>
            <div id="rejectCustom" style="display:none;"><textarea id="rejectCustomText" class="form-input form-textarea" placeholder="Explica el motivo..."></textarea></div>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn" style="flex:1; background:var(--dark-border); color:var(--text);" onclick="closeRejectModal()">Cancelar</button>
                <button class="btn" style="flex:1; background:var(--danger); color:white;" onclick="confirmReject()">‚ùå Rechazar</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
    var db=null,source='youtube',videoId=null,tweetId=null,categories=[],extracted={},supabaseReady=false,pendingExercises=[],rejectingExerciseId=null,selectedRejectReason=null;
    var selectedFamilia = null;
    var LANG_FLAGS={'es':'üá™üá∏','en':'üá¨üáß','pt':'üáµüáπ','it':'üáÆüáπ','de':'üá©üá™','fr':'üá´üá∑','other':'üåê'};
    var FAMILIA_NAMES = { 'futbol_base': '‚öΩ F√∫tbol Base', 'profesional': 'üèüÔ∏è Profesional', 'entrevista': 'üé§ Entrevista', 'analisis': 'üìä An√°lisis' };
    var REJECT_REASONS={'mal_etiquetado':'üè∑Ô∏è Las categor√≠as o datos no son correctos.','duplicado':'üìã Este ejercicio ya existe.','calidad':'üìâ El video no cumple los est√°ndares.','pizarra_incorrecta':'üé® Usa la Pizarra de TopLiderCoach.','otro':''};

    function checkSupabase(){if(typeof supabase!=='undefined'&&supabase.createClient){supabaseReady=true;document.getElementById('loadStatus').textContent='‚úÖ Librer√≠a cargada';document.getElementById('loadStatus').style.color='#22c55e';init();}else{setTimeout(checkSupabase,500);}}
    setTimeout(checkSupabase,100);

    function init(){
        document.getElementById('inputUrl').value=localStorage.getItem('sb_url')||'';
        document.getElementById('inputKey').value=localStorage.getItem('sb_key')||'';
        document.getElementById('inputYT').value=localStorage.getItem('yt_key')||'';
        document.getElementById('tabConfig').onclick=function(){showTab('Config');};
        document.getElementById('tabAdd').onclick=function(){showTab('Add');};
        document.getElementById('tabLibrary').onclick=function(){showTab('Library');};
        document.getElementById('tabPending').onclick=function(){showTab('Pending');};
        document.getElementById('btnSaveConfig').onclick=saveConfig;
        document.getElementById('srcYT').onclick=function(){setSource('youtube');};
        document.getElementById('srcTW').onclick=function(){setSource('twitter');};
        document.getElementById('srcIG').onclick=function(){setSource('instagram');};
        document.getElementById('btnExtract').onclick=extractData;
        document.getElementById('btnSave').onclick=saveExercise;
        document.getElementById('inputTitulo').oninput=function(){updatePreview();checkValid();};
        document.getElementById('inputDif').onchange=function(){updatePreview();checkValid();};
        document.getElementById('inputIdioma').onchange=updatePreview;
        document.getElementById('inputEntrenador').onchange=function(){document.getElementById('customEntrenador').className=this.value==='_otro'?'custom-input-row show':'custom-input-row';};
        document.getElementById('inputEquipo').onchange=function(){document.getElementById('customEquipo').className=this.value==='_otro'?'custom-input-row show':'custom-input-row';};
        document.querySelectorAll('.category-pill').forEach(function(pill){pill.onclick=function(){var cat=this.getAttribute('data-cat');var idx=categories.indexOf(cat);if(idx===-1){categories.push(cat);this.classList.add('active');}else{categories.splice(idx,1);this.classList.remove('active');}updatePreview();checkValid();};});
        document.getElementById('searchInput').oninput=loadLibrary;
        document.getElementById('filterFamilia').onchange=loadLibrary;
        document.getElementById('filterSource').onchange=loadLibrary;
        document.getElementById('filterIdioma').onchange=loadLibrary;
        document.getElementById('filterEdad').onchange=loadLibrary;
        var url=localStorage.getItem('sb_url'),key=localStorage.getItem('sb_key');
        if(url&&key){connectDB(url,key);}
    }

    function showTab(name){['Config','Add','Library','Pending'].forEach(function(t){var tab=document.getElementById('tab'+t);var panel=document.getElementById('panel'+t);if(tab)tab.className='tab';if(panel)panel.className='panel';});document.getElementById('tab'+name).className='tab active';document.getElementById('panel'+name).className='panel active';if(name==='Library'&&db){loadLibrary();}if(name==='Pending'&&db){loadPending();}}

    function saveConfig(){var url=document.getElementById('inputUrl').value.trim();var key=document.getElementById('inputKey').value.trim();if(!url||!key){showToast('Introduce URL y Key','error');return;}localStorage.setItem('sb_url',url);localStorage.setItem('sb_key',key);localStorage.setItem('yt_key',document.getElementById('inputYT').value.trim());connectDB(url,key);}

    function connectDB(url,key){if(!supabaseReady){showToast('Esperando Supabase...','error');return;}showLoading(true);try{db=supabase.createClient(url,key);db.from('ejercicios').select('id').limit(1).then(function(result){showLoading(false);if(result.error){document.getElementById('statusDot').className='status-dot';document.getElementById('statusText').textContent='Error';showToast('Error: '+result.error.message,'error');return;}document.getElementById('statusDot').className='status-dot connected';document.getElementById('statusText').textContent='Conectado';document.getElementById('statsBar').className='stats-bar show';loadStats();loadPending();showToast('‚úÖ Conectado','success');showTab('Add');});}catch(err){showLoading(false);showToast('Error: '+err.message,'error');}}

    function loadStats(){if(!db)return;db.from('ejercicios').select('*',{count:'exact',head:true}).then(function(r){document.getElementById('statTotal').textContent=r.count||0;});db.from('ejercicios').select('*',{count:'exact',head:true}).eq('source','youtube').then(function(r){document.getElementById('statYT').textContent=r.count||0;});db.from('ejercicios').select('*',{count:'exact',head:true}).eq('source','twitter').then(function(r){document.getElementById('statTW').textContent=r.count||0;});}

    function setSource(s){source=s;document.getElementById('srcYT').className='source-btn '+(s==='youtube'?'active youtube':'');document.getElementById('srcTW').className='source-btn '+(s==='twitter'?'active twitter':'');document.getElementById('srcIG').className='source-btn '+(s==='instagram'?'active instagram':'');if(s==='youtube'){document.getElementById('inputVideoUrl').placeholder='https://www.youtube.com/watch?v=...';document.getElementById('btnExtract').className='btn btn-youtube';document.getElementById('btnExtract').textContent='‚ñ∂ Extraer';document.getElementById('urlTitle').textContent='üì∫ URL del Video';}else if(s==='twitter'){document.getElementById('inputVideoUrl').placeholder='https://twitter.com/usuario/status/...';document.getElementById('btnExtract').className='btn btn-twitter';document.getElementById('btnExtract').textContent='ùïè Cargar';document.getElementById('urlTitle').textContent='ùïè URL del Tweet';}else{document.getElementById('inputVideoUrl').placeholder='https://www.instagram.com/reel/...';document.getElementById('btnExtract').className='btn btn-instagram';document.getElementById('btnExtract').textContent='üì∑ Cargar';document.getElementById('urlTitle').textContent='üì∑ URL de Instagram';}resetForm();}

    // FAMILIA SELECTION
    function selectFamilia(familia) {
        selectedFamilia = familia;
        document.querySelectorAll('.familia-option').forEach(function(o) { o.classList.remove('selected'); });
        event.target.closest('.familia-option').classList.add('selected');
        
        document.getElementById('familiaExtraProfesional').className = familia === 'profesional' ? 'familia-extra show' : 'familia-extra';
        document.getElementById('familiaExtraAnalisis').className = familia === 'analisis' ? 'familia-extra show' : 'familia-extra';
        
        updatePreview();
        checkValid();
    }

    function extractData(){if(source==='youtube')extractYouTube();else if(source==='twitter')extractTwitter();else extractInstagram();}
    function getVideoId(url){var m=url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|shorts\/)([^&\n?#]+)/);return m?m[1]:null;}
    function getTweetId(url){var m=url.match(/(?:twitter|x)\.com\/\w+\/status\/(\d+)/);return m?m[1]:null;}
    function getInstagramId(url){var m=url.match(/instagram\.com\/(?:p|reel|reels)\/([A-Za-z0-9_-]+)/);return m?m[1]:null;}
    function parseDuration(iso){var m=iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!m)return{f:'0:00',s:0};var h=parseInt(m[1]||0),min=parseInt(m[2]||0),sec=parseInt(m[3]||0);return{f:h>0?h+':'+String(min).padStart(2,'0')+':'+String(sec).padStart(2,'0'):min+':'+String(sec).padStart(2,'0'),s:h*3600+min*60+sec};}
    function detectLanguage(code){if(!code)return'es';var c=code.substring(0,2).toLowerCase();return['es','en','pt','it','de','fr'].indexOf(c)!==-1?c:'other';}

    function formatNumber(num){if(num>=1000000)return(num/1000000).toFixed(1)+'M';if(num>=1000)return(num/1000).toFixed(1)+'K';return num.toString();}
    function formatDate(dateStr){if(!dateStr)return'';var d=new Date(dateStr);return d.toLocaleDateString('es-ES',{day:'2-digit',month:'short',year:'numeric'});}
    function extractYouTube(){var url=document.getElementById('inputVideoUrl').value.trim();videoId=getVideoId(url);if(!videoId){setStatus('‚ùå URL no v√°lida','error');return;}var thumb='https://img.youtube.com/vi/'+videoId+'/maxresdefault.jpg';updatePreviewMedia(thumb);extracted={videoId:videoId,thumb:thumb,videoUrl:url};var apiKey=localStorage.getItem('yt_key');if(!apiKey){setStatus('‚ö†Ô∏è Sin API Key','error');checkValid();return;}setStatus('üîÑ Extrayendo...','loading');fetch('https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id='+videoId+'&key='+apiKey).then(function(res){return res.json();}).then(function(data){if(data.error)throw new Error(data.error.message);if(!data.items||!data.items.length)throw new Error('Video no encontrado');var v=data.items[0];var dur=parseDuration(v.contentDetails.duration);var lang=detectLanguage(v.snippet.defaultAudioLanguage||v.snippet.defaultLanguage);var vistas=parseInt(v.statistics.viewCount||0);var likes=parseInt(v.statistics.likeCount||0);var fechaPub=v.snippet.publishedAt;extracted={videoId:videoId,videoUrl:url,thumb:thumb,tituloVideo:v.snippet.title,canal:v.snippet.channelTitle,duracion:dur.f,duracionSeg:dur.s,desc:(v.snippet.description||'').substring(0,500),vistas:vistas,likes:likes,fechaPublicacion:fechaPub,idioma:lang};document.getElementById('inputTituloVideo').value=extracted.tituloVideo;document.getElementById('inputTituloVideo').className='form-input filled';document.getElementById('inputCanal').value=extracted.canal;document.getElementById('inputCanal').className='form-input filled';document.getElementById('inputDuracion').value=extracted.duracion;document.getElementById('inputDuracion').className='form-input filled';document.getElementById('inputVistas').value=formatNumber(vistas)+' vistas';document.getElementById('inputVistas').className='form-input filled';document.getElementById('inputLikes').value=formatNumber(likes)+' likes';document.getElementById('inputLikes').className='form-input filled';document.getElementById('inputFechaPublicacion').value=formatDate(fechaPub);document.getElementById('inputFechaPublicacion').className='form-input filled';document.getElementById('inputDesc').value=extracted.desc;document.getElementById('inputIdioma').value=extracted.idioma;if(!document.getElementById('inputTitulo').value){document.getElementById('inputTitulo').value=extracted.tituloVideo;}updatePreviewMedia(thumb,extracted.duracion);document.getElementById('previewMeta').textContent=extracted.canal+' ‚Ä¢ '+extracted.duracion+' ‚Ä¢ '+formatNumber(vistas)+' vistas';updatePreview();setStatus('‚úÖ Datos extra√≠dos '+LANG_FLAGS[lang],'success');checkValid();}).catch(function(err){setStatus('‚ùå '+err.message,'error');checkValid();});}
    function extractTwitter(){var url=document.getElementById('inputVideoUrl').value.trim();tweetId=getTweetId(url);if(!tweetId){setStatus('‚ùå URL no v√°lida','error');return;}extracted={tweetId:tweetId,videoUrl:url};setStatus('‚úÖ Tweet listo','success');checkValid();}
    function extractInstagram(){var url=document.getElementById('inputVideoUrl').value.trim();var igId=getInstagramId(url);if(!igId){setStatus('‚ùå URL no v√°lida','error');return;}extracted={igId:igId,videoUrl:url};setStatus('‚úÖ Instagram listo','success');checkValid();}

    function updatePreviewMedia(thumb,dur){var lang=document.getElementById('inputIdioma').value;var html='<img src="'+thumb+'" onerror="this.src=\'https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg\'">';html+='<div class="preview-badge youtube">üì∫</div>';if(dur)html+='<div class="preview-duration">'+dur+'</div>';html+='<div class="preview-lang">'+(LANG_FLAGS[lang]||'üåê')+'</div>';document.getElementById('previewMedia').innerHTML=html;}
    function setStatus(msg,type){document.getElementById('urlStatus').textContent=msg;document.getElementById('urlStatus').className='url-status '+type;}
    
    function updatePreview(){
        var titulo=document.getElementById('inputTitulo').value||'T√≠tulo del ejercicio';
        var dif=document.getElementById('inputDif').value;
        var lang=document.getElementById('inputIdioma').value;
        document.getElementById('previewTitle').textContent=titulo;
        document.getElementById('previewTitle').className=document.getElementById('inputTitulo').value?'preview-title':'preview-title placeholder';
        var html='';
        if(selectedFamilia) html+='<span class="preview-tag fam">'+FAMILIA_NAMES[selectedFamilia]+'</span>';
        categories.forEach(function(c){html+='<span class="preview-tag">'+c+'</span>';});
        if(dif)html+='<span class="preview-tag dif">Dif: '+dif+'</span>';
        document.getElementById('previewTags').innerHTML=html;
        if(videoId&&extracted.thumb){updatePreviewMedia(extracted.thumb,extracted.duracion);}
    }
    
    function checkValid(){
        var hasSource=(source==='youtube'&&videoId)||(source==='twitter'&&tweetId)||(source==='instagram'&&extracted.igId);
        var titulo=document.getElementById('inputTitulo').value.trim();
        var dif=document.getElementById('inputDif').value;
        var hasFamilia = selectedFamilia !== null;
        document.getElementById('btnSave').disabled=!(hasSource&&titulo&&categories.length>0&&dif&&hasFamilia);
    }
    
    function getEntrenador(){var val=document.getElementById('inputEntrenador').value;return val==='_otro'?document.getElementById('inputEntrenadorCustom').value:val;}
    function getEquipo(){var val=document.getElementById('inputEquipo').value;return val==='_otro'?document.getElementById('inputEquipoCustom').value:val;}

    // GUARDAR - SIEMPRE CON sin_gamificacion: true + familia
    function saveExercise(){if(!db){showToast('‚ùå No conectado','error');return;}showLoading(true);var videoIdValue=null;if(source==='youtube')videoIdValue=videoId;else if(source==='twitter')videoIdValue=tweetId;else if(source==='instagram')videoIdValue=extracted.igId;var data={source:source,video_id:videoIdValue,video_url:document.getElementById('inputVideoUrl').value,thumbnail_url:extracted.thumb||null,titulo_video:document.getElementById('inputTituloVideo').value,canal:document.getElementById('inputCanal').value,duracion:document.getElementById('inputDuracion').value,duracion_segundos:extracted.duracionSeg||0,descripcion:document.getElementById('inputDesc').value,vistas:extracted.vistas||0,likes:extracted.likes||0,fecha_publicacion:extracted.fechaPublicacion||null,titulo_ejercicio:document.getElementById('inputTitulo').value,familia:selectedFamilia,entrenador:getEntrenador(),equipo:getEquipo(),sistema:document.getElementById('inputSistema')?document.getElementById('inputSistema').value:null,categorias:categories,dificultad:parseInt(document.getElementById('inputDif').value),jugadores:document.getElementById('inputJugadores').value,num_porteros:parseInt(document.getElementById('inputPorteros').value)||0,edad:document.getElementById('inputEdad').value,dimensiones:document.getElementById('inputDimensiones').value,material:document.getElementById('inputMaterial').value,idioma:document.getElementById('inputIdioma').value,estado:'publicado',aprobado:true,sin_gamificacion:true};db.from('ejercicios').insert(data).then(function(result){showLoading(false);if(result.error){showToast('‚ùå '+result.error.message,'error');return;}showToast('‚úÖ Guardado (sin XP)','success');resetForm();loadStats();});}

    function resetForm(){['inputVideoUrl','inputTituloVideo','inputCanal','inputDuracion','inputDesc','inputTitulo','inputEntrenadorCustom','inputEquipoCustom','inputVistas','inputLikes','inputFechaPublicacion'].forEach(function(id){var el=document.getElementById(id);if(el){el.value='';el.className='form-input';}});['inputDif','inputIdioma','inputEntrenador','inputEquipo','inputJugadores','inputPorteros','inputEdad','inputDimensiones','inputMaterial','inputIntensidad','inputSistema'].forEach(function(id){var el=document.getElementById(id);if(el)el.value=id==='inputIdioma'?'es':'';});document.getElementById('customEntrenador').className='custom-input-row';document.getElementById('customEquipo').className='custom-input-row';document.getElementById('familiaExtraProfesional').className='familia-extra';document.getElementById('familiaExtraAnalisis').className='familia-extra';categories=[];videoId=null;tweetId=null;extracted={};selectedFamilia=null;document.querySelectorAll('.category-pill').forEach(function(p){p.classList.remove('active');});document.querySelectorAll('.familia-option').forEach(function(o){o.classList.remove('selected');});document.getElementById('previewMedia').innerHTML='<div style="color:var(--text-muted);text-align:center;"><div style="font-size:40px;margin-bottom:8px;">üé¨</div><div style="font-size:13px;">Pega una URL</div></div>';document.getElementById('previewTitle').textContent='T√≠tulo del ejercicio';document.getElementById('previewTitle').className='preview-title placeholder';document.getElementById('previewMeta').textContent='Canal ‚Ä¢ Duraci√≥n';document.getElementById('previewTags').innerHTML='';document.getElementById('urlStatus').textContent='';document.getElementById('btnSave').disabled=true;}

    function loadLibrary(){if(!db)return;var search=document.getElementById('searchInput').value.trim();var filterFam=document.getElementById('filterFamilia').value;var filterSrc=document.getElementById('filterSource').value;var filterLang=document.getElementById('filterIdioma').value;var filterAge=document.getElementById('filterEdad').value;var q=db.from('ejercicios').select('*').order('created_at',{ascending:false}).limit(50);if(search)q=q.ilike('titulo_ejercicio','%'+search+'%');if(filterFam)q=q.eq('familia',filterFam);if(filterSrc)q=q.eq('source',filterSrc);if(filterLang)q=q.eq('idioma',filterLang);if(filterAge)q=q.eq('edad',filterAge);q.then(function(result){if(result.error)return;renderLibrary(result.data||[]);});}
    
    function renderLibrary(items){var grid=document.getElementById('libraryGrid');if(!items.length){grid.innerHTML='<div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No hay ejercicios</div></div>';return;}var sourceIcons={youtube:'üì∫',twitter:'ùïè',instagram:'üì∑'};var html='';items.forEach(function(ex){var cats=ex.categorias||[];var tagsHtml='';cats.slice(0,3).forEach(function(c){tagsHtml+='<span class="exercise-tag">'+c+'</span>';});if(ex.dificultad)tagsHtml+='<span class="exercise-tag" style="background:rgba(245,197,24,0.2);color:var(--accent);">Dif: '+ex.dificultad+'</span>';var icon=sourceIcons[ex.source]||'üì∫';var familiaLabel=ex.familia?FAMILIA_NAMES[ex.familia]||ex.familia:'';html+='<div class="exercise-card"><div class="exercise-thumb">'+(ex.thumbnail_url?'<img src="'+ex.thumbnail_url+'">':'<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:32px;background:var(--dark);">'+icon+'</div>')+'<div class="exercise-source '+ex.source+'">'+icon+'</div>'+(familiaLabel?'<div class="exercise-familia">'+familiaLabel+'</div>':'')+'<div class="exercise-lang">'+(LANG_FLAGS[ex.idioma]||'üåê')+'</div></div><div class="exercise-body"><div class="exercise-title">'+ex.titulo_ejercicio+'</div><div class="exercise-meta">'+(ex.entrenador||ex.canal||'-')+' ‚Ä¢ '+(ex.duracion||'--')+'</div><div class="exercise-tags">'+tagsHtml+'</div><div class="exercise-actions"><button class="btn-view" onclick="window.open(\''+ex.video_url+'\')">‚ñ∂ Ver</button><button class="btn-delete" onclick="deleteEx(\''+ex.id+'\')">üóëÔ∏è</button></div></div></div>';});grid.innerHTML=html;}
    function deleteEx(id){if(!confirm('¬øEliminar?'))return;showLoading(true);db.from('ejercicios').delete().eq('id',id).then(function(r){showLoading(false);if(r.error){showToast('‚ùå '+r.error.message,'error');return;}showToast('‚úÖ Eliminado','success');loadStats();loadLibrary();});}

    // PENDING
    function loadPending(){if(!db)return;db.from('ejercicios').select('*').eq('estado','pendiente').order('created_at',{ascending:true}).then(function(result){if(result.error)return;pendingExercises=result.data||[];renderPending();updatePendingBadge();loadTodayStats();});}
    function updatePendingBadge(){var badge=document.getElementById('pendingCount');var count=pendingExercises.length;badge.textContent=count;badge.style.display=count>0?'inline':'none';document.getElementById('statPending').textContent=count;}
    function renderPending(){var grid=document.getElementById('pendingGrid');if(!pendingExercises.length){grid.innerHTML='<div class="empty-state"><div class="empty-icon">‚úÖ</div><div class="empty-title">No hay ejercicios pendientes</div></div>';return;}var html='';pendingExercises.forEach(function(ex){var cats=ex.categorias||[];var tagsHtml=cats.slice(0,3).map(function(c){return'<span class="pending-card-tag">'+c+'</span>';}).join('');if(ex.familia)tagsHtml+='<span class="pending-card-tag" style="background:rgba(13,159,79,0.15);color:var(--primary);">'+(FAMILIA_NAMES[ex.familia]||ex.familia)+'</span>';var isAdminUpload=ex.sin_gamificacion===true;var cardClass='pending-card';if(isAdminUpload)cardClass+=' admin-upload';var approveText=isAdminUpload?'‚úÖ Aprobar':'‚úÖ Aprobar (+XP)';html+='<div class="'+cardClass+'" id="pending-'+ex.id+'"><div class="pending-card-header"><img class="pending-card-thumb" src="'+(ex.thumbnail_url||'https://via.placeholder.com/140x80/16162a/8b8ba7?text=Video')+'"><div class="pending-card-info"><div class="pending-card-title">'+ex.titulo_ejercicio+'</div><div class="pending-card-meta"><span>üì∫ '+(ex.source||'youtube')+'</span><span>‚è±Ô∏è '+(ex.duracion||'--')+'</span></div></div></div><div class="pending-card-body"><div class="pending-card-tags">'+tagsHtml+'</div><div class="pending-card-url">'+ex.video_url+'</div>'+(isAdminUpload?'<div class="pending-card-admin">üëë ADMIN - Sin XP</div>':'')+'<div class="pending-card-actions"><button class="btn btn-approve" onclick="approveExercise(\''+ex.id+'\', '+isAdminUpload+')">'+approveText+'</button><button class="btn btn-reject" onclick="openRejectModal(\''+ex.id+'\')">‚ùå Rechazar</button><button class="btn btn-view" style="flex:0.5;" onclick="window.open(\''+ex.video_url+'\')">‚ñ∂</button></div></div></div>';});grid.innerHTML=html;}
    function loadTodayStats(){if(!db)return;var today=new Date().toISOString().split('T')[0];db.from('ejercicios').select('*',{count:'exact',head:true}).eq('estado','publicado').gte('updated_at',today).then(function(r){document.getElementById('statApproved').textContent=r.count||0;});db.from('ejercicios').select('*',{count:'exact',head:true}).eq('estado','rechazado').gte('rechazado_en',today).then(function(r){document.getElementById('statRejected').textContent=r.count||0;});}

    // APROBAR
    function approveExercise(id,sinGamificacion){var msg=sinGamificacion?'¬øAprobar? (Sin XP)':'¬øAprobar? El usuario recibir√° XP.';if(!confirm(msg))return;showLoading(true);if(sinGamificacion){db.from('ejercicios').update({estado:'publicado',aprobado:true,updated_at:new Date().toISOString()}).eq('id',id).then(function(result){showLoading(false);if(result.error){showToast('‚ùå '+result.error.message,'error');return;}showToast('‚úÖ Aprobado (sin XP)','success');pendingExercises=pendingExercises.filter(function(ex){return ex.id!==id;});renderPending();updatePendingBadge();loadStats();loadTodayStats();});}else{db.rpc('aprobar_ejercicio',{p_ejercicio_id:id,p_admin_id:null}).then(function(result){showLoading(false);if(result.error){showToast('‚ùå '+result.error.message,'error');return;}showToast('‚úÖ Aprobado (+XP)','success');pendingExercises=pendingExercises.filter(function(ex){return ex.id!==id;});renderPending();updatePendingBadge();loadStats();loadTodayStats();});}}

    function openRejectModal(id){rejectingExerciseId=id;selectedRejectReason=null;document.querySelectorAll('.reject-reason').forEach(function(r){r.classList.remove('selected');});document.getElementById('rejectCustom').style.display='none';document.getElementById('rejectCustomText').value='';document.getElementById('rejectOverlay').classList.add('show');}
    function closeRejectModal(){document.getElementById('rejectOverlay').classList.remove('show');rejectingExerciseId=null;}
    function selectRejectReason(el,reason){document.querySelectorAll('.reject-reason').forEach(function(r){r.classList.remove('selected');});el.classList.add('selected');selectedRejectReason=reason;document.getElementById('rejectCustom').style.display=reason==='otro'?'block':'none';}
    function confirmReject(){if(!selectedRejectReason){showToast('Selecciona un motivo','error');return;}var motivo=REJECT_REASONS[selectedRejectReason];if(selectedRejectReason==='otro'){motivo=document.getElementById('rejectCustomText').value.trim();if(!motivo){showToast('Escribe el motivo','error');return;}}var idToReject=rejectingExerciseId;showLoading(true);db.from('ejercicios').update({estado:'rechazado',motivo_rechazo:motivo,rechazado_en:new Date().toISOString()}).eq('id',idToReject).then(function(result){showLoading(false);if(result.error){showToast('‚ùå '+result.error.message,'error');return;}closeRejectModal();showToast('‚ùå Rechazado','success');pendingExercises=pendingExercises.filter(function(ex){return ex.id!==idToReject;});renderPending();updatePendingBadge();loadTodayStats();});}

    function showLoading(show){document.getElementById('loading').className=show?'loading-overlay show':'loading-overlay';}
    function showToast(msg,type){var t=document.getElementById('toast');t.textContent=msg;t.className='toast '+type+' show';setTimeout(function(){t.className='toast';},3000);}
    </script>
</body>
</html>
