<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol Base TUBE - La Mayor Biblioteca de Ejercicios de F√∫tbol del Mundo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0d9f4f;
            --primary-dark: #0a7a3d;
            --primary-light: #10b85c;
            --accent: #f5c518;
            --dark: #0f0f1a;
            --dark-card: #16162a;
            --dark-border: #2a2a4a;
            --text: #ffffff;
            --text-muted: #8b8ba7;
            --danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, #0d9f4f 0%, #0a7a3d 100%);
            --gradient-hero: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0d2818 100%);
            --shadow-glow: 0 0 30px rgba(13, 159, 79, 0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--dark); color: var(--text); }
        
        /* Header */
        .header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(15, 15, 26, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--dark-border); }
        .header-inner { max-width: 1400px; margin: 0 auto; padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; cursor: pointer; }
        .logo-icon { width: 48px; height: 48px; background: var(--gradient-primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: var(--shadow-glow); }
        .logo-text { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--text); display: flex; align-items: center; gap: 6px; }
        .logo-tube { background: #ff0000; color: white; padding: 2px 8px; border-radius: 4px; font-size: 18px; font-family: 'Arial', sans-serif; font-weight: 900; font-style: italic; letter-spacing: -0.5px; }
        .nav { display: flex; align-items: center; gap: 8px; }
        .nav-link { padding: 10px 20px; color: var(--text-muted); text-decoration: none; font-weight: 500; border-radius: 8px; transition: all 0.3s; cursor: pointer; }
        .nav-link:hover, .nav-link.active { color: var(--text); background: rgba(255,255,255,0.05); }
        .nav-link.active { color: var(--primary); }
        .header-actions { display: flex; align-items: center; gap: 16px; }
        
        .btn { padding: 12px 24px; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; border: none; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .btn-ghost { background: transparent; color: var(--text); border: 2px solid var(--dark-border); }
        .btn-ghost:hover { border-color: var(--primary); color: var(--primary); }
        .btn-primary { background: var(--gradient-primary); color: white; box-shadow: 0 4px 15px rgba(13, 159, 79, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(13, 159, 79, 0.4); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }

        /* User Menu */
        .user-menu { display: flex; align-items: center; gap: 12px; padding: 8px 16px; background: var(--dark-card); border-radius: 50px; cursor: pointer; border: 1px solid var(--dark-border); position: relative; }
        .user-avatar { width: 36px; height: 36px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
        .user-name { font-weight: 500; font-size: 14px; }
        .user-dropdown { position: absolute; top: calc(100% + 8px); right: 0; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; padding: 8px; min-width: 200px; display: none; z-index: 100; }
        .user-dropdown.show { display: block; }
        .user-dropdown-header { padding: 12px 16px; border-bottom: 1px solid var(--dark-border); margin-bottom: 8px; }
        .user-dropdown-level { font-size: 14px; font-weight: 600; color: var(--primary); }
        .user-dropdown-xp { font-size: 12px; color: var(--text-muted); }
        .user-dropdown-item { padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .user-dropdown-item:hover { background: rgba(255,255,255,0.05); }
        .user-dropdown-item.danger { color: var(--danger); }
        .user-dropdown-item.upgrade { color: var(--accent); font-weight: 600; }

        /* Plan Badges */
        .plan-badge { font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 4px; margin-left: 8px; }
        .plan-badge.pro { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .plan-badge.coach { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }

        /* Header Stats */
        .user-stats-header { display: flex; align-items: center; gap: 12px; margin-right: 8px; }
        .xp-badge { background: rgba(245, 197, 24, 0.15); color: var(--accent); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .racha-badge { background: rgba(239, 68, 68, 0.15); color: #ef4444; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .limit-badge { background: rgba(139, 139, 167, 0.15); color: var(--text-muted); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: none; }
        .limit-badge.limit-reached { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        /* Upgrade Modal */
        .upgrade-modal { max-width: 500px; padding: 0; overflow: hidden; }
        .upgrade-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 32px; text-align: center; }
        .upgrade-header h2 { font-family: 'Bebas Neue', sans-serif; font-size: 32px; margin-bottom: 8px; }
        .upgrade-header p { opacity: 0.9; font-size: 14px; }
        .upgrade-body { padding: 24px; }
        .upgrade-plans { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .upgrade-plan { background: var(--dark); border: 2px solid var(--dark-border); border-radius: 16px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upgrade-plan:hover { border-color: var(--primary); transform: translateY(-4px); }
        .upgrade-plan.recommended { border-color: var(--accent); }
        .upgrade-plan-badge { font-size: 10px; background: var(--accent); color: var(--dark); padding: 2px 8px; border-radius: 4px; margin-bottom: 8px; display: inline-block; }
        .upgrade-plan-name { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .upgrade-plan-price { font-family: 'Bebas Neue', sans-serif; font-size: 36px; color: var(--primary); }
        .upgrade-plan-price span { font-size: 14px; color: var(--text-muted); font-family: 'Outfit', sans-serif; }
        .upgrade-plan-features { text-align: left; margin-top: 16px; font-size: 13px; color: var(--text-muted); }
        .upgrade-plan-features li { margin-bottom: 8px; list-style: none; }
        .upgrade-plan-features li::before { content: '‚úì '; color: var(--primary); font-weight: bold; }
        .upgrade-plan.recommended .upgrade-plan-features li::before { color: var(--accent); }
        .upgrade-footer { text-align: center; font-size: 12px; color: var(--text-muted); }

        /* Leaderboard Modal */
        .leaderboard-modal { max-width: 450px; padding: 24px; }
        .leaderboard-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .leaderboard-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .leaderboard-tab { flex: 1; padding: 10px; text-align: center; background: var(--dark); border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-muted); }
        .leaderboard-tab.active { background: var(--primary); color: white; }
        .leaderboard-list { max-height: 400px; overflow-y: auto; }
        .leaderboard-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--dark); border-radius: 10px; margin-bottom: 8px; }
        .leaderboard-item.top-3 { background: linear-gradient(135deg, rgba(245, 197, 24, 0.1) 0%, rgba(245, 197, 24, 0.05) 100%); border: 1px solid rgba(245, 197, 24, 0.3); }
        .leaderboard-item.me { border: 2px solid var(--primary); }
        .leaderboard-rank { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .leaderboard-rank.gold { color: #ffd700; font-size: 20px; }
        .leaderboard-rank.silver { color: #c0c0c0; font-size: 18px; }
        .leaderboard-rank.bronze { color: #cd7f32; font-size: 16px; }
        .leaderboard-avatar { width: 40px; height: 40px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .leaderboard-info { flex: 1; }
        .leaderboard-name { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 6px; }
        .leaderboard-level { font-size: 12px; color: var(--text-muted); }
        .leaderboard-xp { font-weight: 700; color: var(--accent); font-size: 14px; }

        /* Hero */
        .hero { min-height: 90vh; background: var(--gradient-hero); display: flex; align-items: center; justify-content: center; text-align: center; padding: 140px 24px 80px; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%230d9f4f' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); opacity: 0.5; }
        .hero-content { max-width: 900px; position: relative; z-index: 1; }
        .hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 10px 24px; background: rgba(13, 159, 79, 0.15); border: 1px solid rgba(13, 159, 79, 0.3); border-radius: 50px; font-size: 14px; color: var(--primary-light); margin-bottom: 32px; font-weight: 600; }
        
        .hero-title-main { font-family: 'Bebas Neue', sans-serif; font-size: clamp(42px, 7vw, 68px); line-height: 1.1; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 16px; }
        .tube-logo { display: inline-flex; align-items: center; background: #ff0000; padding: 4px 16px; border-radius: 8px; margin-left: 8px; }
        .tube-text { font-family: 'Roboto', 'Arial', sans-serif; font-weight: 900; font-style: italic; color: white; letter-spacing: -1px; }
        
        .hero-tagline { font-family: 'Bebas Neue', sans-serif; font-size: clamp(18px, 3vw, 26px); color: var(--accent); letter-spacing: 2px; margin-bottom: 20px; }
        .hero-desc { font-size: 18px; color: var(--text-muted); margin-bottom: 32px; max-width: 650px; margin-left: auto; margin-right: auto; line-height: 1.7; }
        .hero-desc strong { color: var(--text); }
        
        .hero-features { display: flex; justify-content: center; gap: 32px; margin-bottom: 40px; flex-wrap: wrap; }
        .hero-feature { display: flex; align-items: center; gap: 8px; font-size: 15px; color: var(--text); }
        .hero-feature-icon { font-size: 20px; }
        
        .hero-buttons { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-bottom: 48px; }
        .btn-lg { padding: 16px 32px; font-size: 16px; }
        
        .hero-stats { display: flex; justify-content: center; gap: 48px; padding-top: 40px; border-top: 1px solid var(--dark-border); flex-wrap: wrap; }
        .hero-stat { text-align: center; }
        .hero-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 42px; color: var(--primary); }
        .hero-stat-label { font-size: 14px; color: var(--text-muted); }
        
        .hero-cta-text { margin-top: 32px; font-size: 15px; color: var(--text-muted); }
        .hero-cta-text a { color: var(--primary); text-decoration: none; font-weight: 600; }
        .hero-cta-text a:hover { text-decoration: underline; }

        /* Biblioteca */
        .biblioteca { max-width: 1400px; margin: 0 auto; padding: 40px 24px; display: grid; grid-template-columns: 280px 1fr; gap: 32px; }
        
        /* Sidebar */
        .filters-sidebar { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 20px; padding: 24px; height: fit-content; position: sticky; top: 105px; max-height: calc(100vh - 130px); overflow-y: auto; }
        .filters-sidebar::-webkit-scrollbar { width: 6px; }
        .filters-sidebar::-webkit-scrollbar-track { background: transparent; }
        .filters-sidebar::-webkit-scrollbar-thumb { background: var(--dark-border); border-radius: 3px; }
        .filters-sidebar::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
        .filters-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--dark-border); }
        .filters-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .filters-badge { background: var(--primary); color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px; display: none; }
        .filters-badge.show { display: inline-block; }
        .filters-clear { color: var(--primary); font-size: 13px; cursor: pointer; }
        .filter-group { margin-bottom: 20px; }
        .filter-label { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; display: block; }
        .filter-select { width: 100%; padding: 12px 16px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; cursor: pointer; }
        .filter-select:focus { outline: none; border-color: var(--primary); }
        .difficulty-pills { display: flex; gap: 8px; }
        .difficulty-pill { flex: 1; padding: 10px; text-align: center; background: var(--dark); border: 2px solid transparent; border-radius: 10px; cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 600; color: var(--text-muted); }
        .difficulty-pill:hover { background: rgba(255,255,255,0.06); color: var(--text); }
        .difficulty-pill.active { border-color: var(--primary); background: rgba(13, 159, 79, 0.15); color: var(--primary); }

        /* Main */
        .biblioteca-main { display: flex; flex-direction: column; gap: 24px; }
        .biblioteca-header { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px; }
        .biblioteca-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; }
        .biblioteca-count { color: var(--text-muted); font-size: 14px; }
        .biblioteca-search { display: flex; align-items: center; gap: 12px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; padding: 12px 20px; width: 320px; }
        .biblioteca-search input { flex: 1; background: none; border: none; color: var(--text); font-size: 14px; outline: none; }
        .biblioteca-search input::placeholder { color: var(--text-muted); }

        /* Cards */
        .ejercicios-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }
        .ejercicio-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 20px; overflow: hidden; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; }
        .ejercicio-card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: var(--shadow-glow); }
        .ejercicio-thumbnail { position: relative; aspect-ratio: 16/9; overflow: hidden; background: var(--dark); }
        .ejercicio-thumbnail img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s; }
        .ejercicio-card:hover .ejercicio-thumbnail img { transform: scale(1.05); }
        .ejercicio-duration { position: absolute; bottom: 12px; right: 12px; background: rgba(0,0,0,0.85); padding: 4px 10px; border-radius: 6px; font-size: 13px; font-weight: 600; }
        .ejercicio-difficulty { position: absolute; top: 12px; left: 12px; background: var(--accent); color: var(--dark); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        .ejercicio-lang { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.85); padding: 4px 8px; border-radius: 6px; font-size: 14px; }
        .ejercicio-play { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 4px 20px rgba(13, 159, 79, 0.5); }
        .ejercicio-play::after { content: ''; border-left: 16px solid white; border-top: 10px solid transparent; border-bottom: 10px solid transparent; margin-left: 4px; }
        .ejercicio-card:hover .ejercicio-play { transform: translate(-50%, -50%) scale(1); }
        .ejercicio-body { padding: 20px; }
        .ejercicio-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .ejercicio-meta { display: flex; align-items: center; gap: 8px; color: var(--text-muted); font-size: 13px; margin-bottom: 12px; }
        .ejercicio-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .ejercicio-tag { padding: 4px 12px; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .ejercicio-footer { display: flex; align-items: center; justify-content: space-between; padding-top: 16px; border-top: 1px solid var(--dark-border); }
        .ejercicio-stats { display: flex; gap: 16px; font-size: 13px; color: var(--text-muted); }
        .ejercicio-stat { display: flex; align-items: center; gap: 4px; }
        .ejercicio-actions { display: flex; gap: 8px; }
        .ejercicio-action { width: 36px; height: 36px; background: rgba(255,255,255,0.05); border: none; border-radius: 8px; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 14px; }
        .ejercicio-action:hover { background: var(--primary); color: white; }
        .ejercicio-action.active { background: var(--danger); color: white; }
        .ejercicio-action.in-session { background: var(--primary); color: white; }

        /* States */
        .state-container { grid-column: 1 / -1; text-align: center; padding: 80px 40px; }
        .state-icon { font-size: 64px; margin-bottom: 16px; }
        .state-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
        .state-text { color: var(--text-muted); }
        .loading-spinner { width: 48px; height: 48px; border: 3px solid var(--dark-border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 24px; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--dark-card); border-radius: 24px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 16px; right: 16px; width: 44px; height: 44px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; color: white; font-size: 24px; cursor: pointer; z-index: 10; }
        .modal-close:hover { background: rgba(255,255,255,0.2); }
        .modal-video { aspect-ratio: 16/9; background: black; }
        .modal-video iframe { width: 100%; height: 100%; border: none; }
        .modal-body { padding: 24px; }
        .modal-title { font-size: 24px; font-weight: 700; margin-bottom: 16px; }
        .modal-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
        .modal-tag { padding: 6px 16px; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border-radius: 20px; font-size: 13px; }
        .modal-tag.dif { background: rgba(245, 197, 24, 0.15); color: var(--accent); }
        .modal-info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .modal-info-item { background: rgba(255,255,255,0.03); padding: 16px; border-radius: 12px; text-align: center; }
        .modal-info-icon { font-size: 24px; margin-bottom: 8px; }
        .modal-info-value { font-weight: 700; font-size: 16px; margin-bottom: 4px; }
        .modal-info-label { font-size: 12px; color: var(--text-muted); }
        .modal-description { color: var(--text-muted); line-height: 1.7; margin-bottom: 24px; }
        .modal-footer { display: flex; gap: 12px; flex-wrap: wrap; }
        .modal-footer .btn { flex: 1; min-width: 150px; justify-content: center; }

        /* Auth Modal */
        .auth-modal { max-width: 420px; padding: 40px; }
        .auth-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; text-align: center; margin-bottom: 8px; }
        .auth-subtitle { color: var(--text-muted); text-align: center; margin-bottom: 32px; }
        .auth-tabs { display: flex; gap: 8px; margin-bottom: 24px; }
        .auth-tab { flex: 1; padding: 12px; text-align: center; background: var(--dark); border: 2px solid transparent; border-radius: 10px; cursor: pointer; font-weight: 600; color: var(--text-muted); transition: all 0.2s; }
        .auth-tab.active { border-color: var(--primary); color: var(--primary); background: rgba(13, 159, 79, 0.1); }
        .auth-form { display: flex; flex-direction: column; gap: 16px; }
        .auth-input { width: 100%; padding: 14px 18px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; color: var(--text); font-size: 14px; }
        .auth-input:focus { outline: none; border-color: var(--primary); }
        .auth-input::placeholder { color: var(--text-muted); }
        .auth-error { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 12px 16px; border-radius: 10px; font-size: 13px; display: none; }
        .auth-error.show { display: block; }
        .auth-divider { text-align: center; color: var(--text-muted); font-size: 13px; margin: 16px 0; position: relative; }
        .auth-divider::before, .auth-divider::after { content: ''; position: absolute; top: 50%; width: 40%; height: 1px; background: var(--dark-border); }
        .auth-divider::before { left: 0; }
        .auth-divider::after { right: 0; }

        /* Floating Session Button */
        .session-fab {
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 1500;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 24px;
            background: rgba(22, 22, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid var(--dark-border);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .session-fab:hover { transform: translateY(-4px); border-color: var(--primary); box-shadow: 0 12px 40px rgba(13, 159, 79, 0.3); }
        .session-fab.has-items { border-color: var(--primary); }
        .session-fab-icon { width: 44px; height: 44px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .session-fab-content { display: flex; flex-direction: column; }
        .session-fab-title { font-weight: 600; font-size: 14px; }
        .session-fab-count { font-size: 12px; color: var(--text-muted); }
        .session-fab-badge { position: absolute; top: -8px; right: -8px; width: 28px; height: 28px; background: var(--danger); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; border: 3px solid var(--dark); display: none; }
        .session-fab.has-items .session-fab-badge { display: flex; }
        
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .session-fab.bounce .session-fab-badge { animation: bounce 0.4s ease; }

        /* Session Drawer */
        .session-drawer {
            position: fixed;
            top: 0;
            right: -420px;
            width: 400px;
            max-width: 100%;
            height: 100vh;
            background: var(--dark-card);
            border-left: 1px solid var(--dark-border);
            z-index: 2500;
            display: flex;
            flex-direction: column;
            transition: right 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .session-drawer.open { right: 0; }
        .session-drawer-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 2400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .session-drawer-backdrop.show { opacity: 1; visibility: visible; }
        
        .session-drawer-header {
            padding: 24px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .session-drawer-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .session-drawer-close { width: 40px; height: 40px; background: var(--dark); border: none; border-radius: 10px; color: var(--text-muted); cursor: pointer; font-size: 20px; }
        .session-drawer-close:hover { color: var(--text); background: rgba(255,255,255,0.1); }
        
        .session-drawer-body { flex: 1; overflow-y: auto; padding: 16px; }
        
        .session-empty { text-align: center; padding: 60px 20px; color: var(--text-muted); }
        .session-empty-icon { font-size: 48px; margin-bottom: 12px; }
        .session-empty-text { font-size: 14px; }
        
        .session-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--dark);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.2s;
        }
        .session-item:hover { border-color: var(--primary); }
        .session-item.dragging { opacity: 0.5; cursor: grabbing; }
        .session-item-drag { color: var(--text-muted); font-size: 16px; cursor: grab; }
        .session-item-thumb { width: 60px; height: 40px; border-radius: 6px; object-fit: cover; background: var(--dark-border); }
        .session-item-info { flex: 1; min-width: 0; }
        .session-item-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .session-item-meta { font-size: 11px; color: var(--text-muted); }
        .session-item-remove { width: 28px; height: 28px; background: none; border: none; color: var(--text-muted); cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; }
        .session-item-remove:hover { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        .session-drawer-footer {
            padding: 20px;
            border-top: 1px solid var(--dark-border);
            background: var(--dark);
        }
        .session-stats { display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 14px; }
        .session-stats span { color: var(--text-muted); }
        .session-stats strong { color: var(--primary); }
        .session-actions { display: flex; gap: 12px; }
        .session-actions .btn { flex: 1; justify-content: center; }

        /* Save Session Modal */
        .save-modal { max-width: 450px; padding: 32px; }
        .save-modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 20px; }
        .save-modal .auth-input { margin-bottom: 16px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-row .auth-input { margin-bottom: 16px; }
        
        /* Sessions List in Modal */
        .sessions-list { max-height: 250px; overflow-y: auto; margin-bottom: 16px; }
        .session-list-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .session-list-item:hover { border-color: var(--primary); background: rgba(13, 159, 79, 0.05); }
        .session-list-item-info { flex: 1; }
        .session-list-item-name { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
        .session-list-item-meta { font-size: 12px; color: var(--text-muted); }
        .session-list-item-count { background: var(--primary); color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .session-list-loading { text-align: center; padding: 40px; color: var(--text-muted); }
        .session-list-empty { text-align: center; padding: 40px; color: var(--text-muted); }
        .session-list-empty-icon { font-size: 40px; margin-bottom: 12px; }
        
        .session-divider { text-align: center; color: var(--text-muted); font-size: 13px; margin: 20px 0; position: relative; }
        .session-divider::before, .session-divider::after { content: ''; position: absolute; top: 50%; width: 35%; height: 1px; background: var(--dark-border); }
        .session-divider::before { left: 0; }
        .session-divider::after { right: 0; }
        
        /* View Session Modal */
        .view-session-modal { max-width: 600px; padding: 0; }
        .view-session-header { padding: 24px 24px 16px; border-bottom: 1px solid var(--dark-border); }
        .view-session-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 8px; }
        .view-session-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px; color: var(--text-muted); }
        .view-session-meta span { display: flex; align-items: center; gap: 6px; }
        .view-session-objetivo { padding: 16px 24px; background: rgba(13, 159, 79, 0.1); border-left: 4px solid var(--primary); margin: 0; font-size: 14px; }
        .view-session-objetivo:empty { display: none; }
        .view-session-exercises { padding: 16px 24px; }
        .view-session-exercise { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--dark); border-radius: 12px; margin-bottom: 10px; transition: all 0.2s; }
        .view-session-exercise:hover { background: rgba(255,255,255,0.05); }
        .view-session-exercise-num { width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; flex-shrink: 0; }
        .view-session-exercise-thumb { width: 80px; height: 50px; border-radius: 8px; object-fit: cover; background: var(--dark-border); flex-shrink: 0; }
        .view-session-exercise-info { flex: 1; min-width: 0; }
        .view-session-exercise-title { font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
        .view-session-exercise-meta { font-size: 12px; color: var(--text-muted); }
        .view-session-exercise-link { padding: 8px 16px; background: var(--gradient-primary); color: white; border-radius: 8px; text-decoration: none; font-size: 12px; font-weight: 600; white-space: nowrap; }
        .view-session-exercise-link:hover { opacity: 0.9; }
        .view-session-notas { padding: 16px 24px; background: rgba(255,255,255,0.02); font-size: 14px; color: var(--text-muted); border-top: 1px solid var(--dark-border); }
        .view-session-notas:empty { display: none; }
        .view-session-notas::before { content: 'üìù '; }
        .view-session-footer { padding: 16px 24px; border-top: 1px solid var(--dark-border); display: flex; gap: 12px; flex-wrap: wrap; }
        .view-session-footer .btn { flex: 1; min-width: 100px; justify-content: center; }
        
        /* My Sessions Modal */
        .my-sessions-modal { max-width: 550px; padding: 24px; max-height: 80vh; display: flex; flex-direction: column; }
        .my-sessions-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .my-sessions-list { flex: 1; overflow-y: auto; }
        .my-session-card { background: var(--dark); border: 1px solid var(--dark-border); border-radius: 14px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
        .my-session-card:hover { border-color: var(--primary); transform: translateX(4px); }
        .my-session-card-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px; }
        .my-session-card-name { font-weight: 700; font-size: 16px; }
        .my-session-card-date { font-size: 12px; color: var(--text-muted); background: var(--dark-card); padding: 4px 10px; border-radius: 6px; }
        .my-session-card-meta { display: flex; gap: 16px; font-size: 13px; color: var(--text-muted); margin-bottom: 10px; }
        .my-session-card-objetivo { font-size: 13px; color: var(--text-muted); font-style: italic; }
        .my-session-card-thumbs { display: flex; margin-top: 12px; }
        .my-session-card-thumb { width: 50px; height: 32px; border-radius: 4px; object-fit: cover; border: 2px solid var(--dark); margin-left: -10px; }
        .my-session-card-thumb:first-child { margin-left: 0; }

        /* My Sessions Page */
        .my-sessions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 24px; }
        .my-session-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 16px; padding: 20px; transition: all 0.3s; }
        .my-session-card:hover { border-color: var(--primary); transform: translateY(-4px); }
        .my-session-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .my-session-name { font-weight: 700; font-size: 16px; }
        .my-session-date { font-size: 12px; color: var(--text-muted); }
        .my-session-stats { display: flex; gap: 16px; font-size: 13px; color: var(--text-muted); margin-bottom: 16px; }
        .my-session-exercises { display: flex; gap: 4px; }
        .my-session-thumb { width: 40px; height: 30px; border-radius: 4px; object-fit: cover; border: 2px solid var(--dark-card); margin-left: -8px; }
        .my-session-thumb:first-child { margin-left: 0; }
        .my-session-actions { display: flex; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--dark-border); }
        .my-session-actions .btn { flex: 1; }

        /* Footer */
        .footer { background: var(--dark-card); border-top: 1px solid var(--dark-border); padding: 40px 24px; text-align: center; margin-top: 60px; }
        .footer-text { color: var(--text-muted); font-size: 14px; }

        /* Toast */
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); padding: 14px 24px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; font-size: 14px; z-index: 3000; opacity: 0; transition: all 0.3s; display: flex; align-items: center; gap: 10px; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { border-color: var(--primary); }
        .toast.error { border-color: var(--danger); }
/* Upload Exercise Modal */
.upload-modal { max-width: 600px; padding: 0; max-height: 90vh; display: flex; flex-direction: column; }
.upload-header { padding: 24px; border-bottom: 1px solid var(--dark-border); }
.upload-header h2 { font-family: 'Bebas Neue', sans-serif; font-size: 28px; display: flex; align-items: center; gap: 10px; }
.upload-header p { color: var(--text-muted); font-size: 14px; margin-top: 4px; }
.upload-body { padding: 24px; overflow-y: auto; flex: 1; }
.upload-section { margin-bottom: 24px; }
.upload-section-title { font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.upload-url-input { display: flex; gap: 12px; }
.upload-url-input input { flex: 1; }
.upload-url-input .btn { flex-shrink: 0; }
.upload-preview { background: var(--dark); border-radius: 12px; padding: 16px; margin-top: 16px; display: none; }
.upload-preview.show { display: block; }
.upload-preview-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 8px; object-fit: cover; margin-bottom: 12px; }
.upload-preview-title { font-weight: 600; font-size: 15px; margin-bottom: 8px; }
.upload-preview-meta { font-size: 13px; color: var(--text-muted); display: flex; gap: 16px; }
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.upload-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
.upload-field { display: flex; flex-direction: column; gap: 6px; }
.upload-field label { font-size: 12px; color: var(--text-muted); }
.upload-field input, .upload-field select, .upload-field textarea { padding: 12px 14px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; }
.upload-field input:focus, .upload-field select:focus, .upload-field textarea:focus { outline: none; border-color: var(--primary); }
.upload-field textarea { min-height: 80px; resize: vertical; }
.upload-pizarra { background: linear-gradient(135deg, rgba(245, 197, 24, 0.1) 0%, rgba(245, 197, 24, 0.05) 100%); border: 2px dashed var(--accent); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
.upload-pizarra:hover { background: rgba(245, 197, 24, 0.15); }
.upload-pizarra-icon { font-size: 32px; margin-bottom: 8px; }
.upload-pizarra-text { font-size: 14px; color: var(--accent); font-weight: 600; }
.upload-pizarra-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
.upload-pizarra.has-image { border-style: solid; border-color: var(--primary); }
.upload-pizarra.has-image .upload-pizarra-icon { color: var(--primary); }
.upload-footer { padding: 20px 24px; border-top: 1px solid var(--dark-border); display: flex; gap: 12px; }
.upload-footer .btn { flex: 1; justify-content: center; }
.upload-xp-bonus { background: rgba(245, 197, 24, 0.1); padding: 12px 16px; border-radius: 10px; font-size: 13px; color: var(--accent); display: flex; align-items: center; gap: 8px; margin-top: 16px; }

/* Categories Multiselect */
.categories-select { display: flex; flex-wrap: wrap; gap: 8px; }
.category-chip { padding: 8px 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
.category-chip:hover { border-color: var(--text-muted); }
.category-chip.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.15); color: var(--primary); }
/* Notifications */
.notif-bell { position: relative; cursor: pointer; padding: 8px; margin-right: 8px; }
.notif-bell-icon { font-size: 20px; }
.notif-badge { position: absolute; top: 2px; right: 2px; min-width: 18px; height: 18px; background: var(--danger); border-radius: 50%; font-size: 11px; font-weight: 700; display: flex; align-items: center; justify-content: center; display: none; }
.notif-badge.show { display: flex; }
.notif-dropdown { position: absolute; top: calc(100% + 8px); right: 0; width: 320px; max-height: 400px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 16px; display: none; z-index: 1000; overflow: hidden; }
.notif-dropdown.show { display: block; }
.notif-header { padding: 16px; border-bottom: 1px solid var(--dark-border); display: flex; align-items: center; justify-content: space-between; }
.notif-header-title { font-weight: 700; font-size: 15px; }
.notif-header-action { font-size: 12px; color: var(--primary); cursor: pointer; }
.notif-list { max-height: 320px; overflow-y: auto; }
.notif-item { padding: 14px 16px; border-bottom: 1px solid var(--dark-border); cursor: pointer; transition: background 0.2s; }
.notif-item:hover { background: rgba(255,255,255,0.03); }
.notif-item.unread { background: rgba(13, 159, 79, 0.05); border-left: 3px solid var(--primary); }
.notif-item-title { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
.notif-item-message { font-size: 12px; color: var(--text-muted); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.notif-item-time { font-size: 11px; color: var(--text-muted); margin-top: 6px; }
.notif-empty { padding: 40px 20px; text-align: center; color: var(--text-muted); }
.notif-empty-icon { font-size: 32px; margin-bottom: 8px; }
/* Upload Exercise Modal - Improved */
.upload-modal { max-width: 600px; padding: 0; max-height: 90vh; display: flex; flex-direction: column; }
.upload-header { padding: 24px; border-bottom: 1px solid var(--dark-border); }
.upload-header h2 { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 4px; }
.upload-header p { color: var(--text-muted); font-size: 14px; }
.upload-body { padding: 24px; overflow-y: auto; flex: 1; }
.upload-section { margin-bottom: 24px; }
.upload-section-title { font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.upload-url-input { display: flex; gap: 12px; }
.upload-url-input input { flex: 1; }
.upload-status { margin-top: 10px; font-size: 13px; min-height: 20px; }
.upload-status.loading { color: var(--accent); }
.upload-status.success { color: var(--primary); }
.upload-status.error { color: var(--danger); }

/* Extracted Preview */
.upload-preview { display: flex; gap: 16px; background: var(--dark); border-radius: 12px; padding: 16px; }
.upload-preview-thumb { width: 180px; height: 100px; border-radius: 8px; object-fit: cover; background: var(--dark-border); flex-shrink: 0; }
.upload-preview-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.upload-preview-title { font-weight: 700; font-size: 14px; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.upload-preview-channel { font-size: 13px; color: var(--primary); margin-bottom: 8px; }
.upload-preview-stats { display: flex; flex-wrap: wrap; gap: 12px; font-size: 12px; color: var(--text-muted); }
.upload-preview-stats span { display: flex; align-items: center; gap: 4px; }

/* Credit Notice */
.upload-credit-notice { display: flex; align-items: center; gap: 10px; background: rgba(13, 159, 79, 0.1); border: 1px solid rgba(13, 159, 79, 0.3); border-radius: 10px; padding: 12px 16px; margin-top: 16px; font-size: 13px; color: var(--primary); }
.upload-credit-notice strong { color: var(--text); }

/* Classification Section */
.upload-field { margin-bottom: 16px; }
.upload-field label { display: block; font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 8px; }
.upload-field .upload-hint { font-weight: 400; opacity: 0.7; }
.upload-field input, .upload-field select, .upload-field textarea { width: 100%; padding: 12px 14px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; }
.upload-field input:focus, .upload-field select:focus { outline: none; border-color: var(--primary); }
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.upload-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

/* Categories */
.categories-select { display: flex; flex-wrap: wrap; gap: 8px; }
.category-chip { padding: 8px 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
.category-chip:hover { border-color: var(--text-muted); }
.category-chip.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.15); color: var(--primary); }

/* Pizarra */
.upload-pizarra { background: linear-gradient(135deg, rgba(245, 197, 24, 0.1) 0%, rgba(245, 197, 24, 0.05) 100%); border: 2px dashed var(--accent); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
.upload-pizarra:hover { background: rgba(245, 197, 24, 0.15); }
.upload-pizarra-icon { font-size: 28px; margin-bottom: 6px; }
.upload-pizarra-text { font-size: 14px; color: var(--accent); font-weight: 600; }
.upload-pizarra-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
.upload-pizarra.has-image { border-style: solid; border-color: var(--primary); }

/* XP Bonus */
.upload-xp-bonus { background: rgba(245, 197, 24, 0.1); padding: 12px 16px; border-radius: 10px; font-size: 13px; color: var(--accent); display: flex; align-items: center; gap: 8px; margin-top: 8px; }

/* Footer */
.upload-footer { padding: 20px 24px; border-top: 1px solid var(--dark-border); display: flex; gap: 12px; }
.upload-footer .btn { flex: 1; justify-content: center; }
.upload-footer .btn:disabled { opacity: 0.5; cursor: not-allowed; }
/* Upload Modal - New Design */
.upload-modal { max-width: 650px; padding: 0; max-height: 90vh; display: flex; flex-direction: column; }
.upload-header { padding: 24px; border-bottom: 1px solid var(--dark-border); }
.upload-header h2 { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 4px; }
.upload-header p { color: var(--text-muted); font-size: 14px; }
.upload-body { padding: 24px; overflow-y: auto; flex: 1; }
.upload-section { margin-bottom: 28px; }
.upload-section-title { font-size: 14px; font-weight: 700; color: var(--primary); margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
.upload-section-title .upload-hint { font-weight: 400; color: var(--text-muted); font-size: 12px; }
.upload-bonus { color: var(--accent); font-weight: 600; font-size: 12px; }

/* Source Tabs */
.upload-source-tabs { display: flex; gap: 12px; margin-bottom: 16px; }
.upload-source-tab { flex: 1; padding: 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; color: var(--text-muted); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
.upload-source-tab:hover { border-color: var(--text-muted); }
.upload-source-tab.active { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); color: var(--primary); }

/* URL Input */
.upload-url-input { display: flex; gap: 12px; }
.upload-url-input input { flex: 1; }
.upload-status { margin-top: 10px; font-size: 13px; min-height: 20px; }
.upload-status.loading { color: var(--accent); }
.upload-status.success { color: var(--primary); }
.upload-status.error { color: var(--danger); }

/* Image Upload */
.upload-image-drop { border: 2px dashed var(--dark-border); border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; transition: all 0.3s; background: var(--dark); }
.upload-image-drop:hover { border-color: var(--primary); background: rgba(13, 159, 79, 0.05); }
.upload-image-drop.dragover { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); }
.upload-image-placeholder { display: flex; flex-direction: column; align-items: center; gap: 8px; color: var(--text-muted); }
.upload-image-icon { font-size: 40px; }
.upload-image-hint { font-size: 12px; opacity: 0.7; }
.upload-image-preview { max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: contain; }

/* Extracted Preview */
.upload-preview { display: flex; gap: 16px; background: var(--dark); border-radius: 12px; padding: 16px; }
.upload-preview-thumb { width: 160px; height: 90px; border-radius: 8px; object-fit: cover; background: var(--dark-border); flex-shrink: 0; }
.upload-preview-info { flex: 1; display: flex; flex-direction: column; justify-content: center; min-width: 0; }
.upload-preview-title { font-weight: 700; font-size: 13px; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.upload-preview-channel { font-size: 12px; color: var(--primary); margin-bottom: 8px; }
.upload-preview-stats { display: flex; flex-wrap: wrap; gap: 10px; font-size: 11px; color: var(--text-muted); }

/* Credit Notice */
.upload-credit-notice { display: flex; align-items: center; gap: 10px; background: rgba(13, 159, 79, 0.1); border: 1px solid rgba(13, 159, 79, 0.3); border-radius: 10px; padding: 12px 16px; margin-top: 16px; font-size: 12px; color: var(--primary); }
.upload-credit-notice strong { color: var(--text); }

/* Familia Grid */
.upload-familia-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.upload-familia-option { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 20px 16px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 14px; cursor: pointer; transition: all 0.2s; text-align: center; }
.upload-familia-option:hover { border-color: var(--text-muted); transform: translateY(-2px); }
.upload-familia-option.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); }
.upload-familia-icon { font-size: 28px; }
.upload-familia-name { font-size: 13px; font-weight: 600; }
.upload-familia-extra { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--dark-border); }

/* Temas Grid */
.upload-temas-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.upload-tema-chip { padding: 8px 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
.upload-tema-chip:hover { border-color: var(--text-muted); }
.upload-tema-chip.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.15); color: var(--primary); }

/* Form Fields */
.upload-field { margin-bottom: 16px; }
.upload-field label { display: block; font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 8px; }
.upload-field input, .upload-field select, .upload-field textarea { width: 100%; padding: 12px 14px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; font-family: inherit; }
.upload-field input:focus, .upload-field select:focus, .upload-field textarea:focus { outline: none; border-color: var(--primary); }
.upload-field textarea { resize: vertical; min-height: 80px; }
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.upload-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

/* Pizarra */
.upload-pizarra { background: linear-gradient(135deg, rgba(245, 197, 24, 0.1) 0%, rgba(245, 197, 24, 0.05) 100%); border: 2px dashed var(--accent); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s; }
.upload-pizarra:hover { background: rgba(245, 197, 24, 0.15); transform: translateY(-2px); }
.upload-pizarra.has-image { border-style: solid; border-color: var(--primary); }
.upload-pizarra-icon { font-size: 32px; margin-bottom: 8px; }
.upload-pizarra-text { font-size: 14px; color: var(--accent); font-weight: 600; }
.upload-pizarra-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

/* XP Bonus */
.upload-xp-bonus { background: rgba(245, 197, 24, 0.1); padding: 14px 18px; border-radius: 12px; font-size: 14px; color: var(--accent); display: flex; align-items: center; gap: 10px; margin-top: 16px; }
.upload-xp-bonus strong { color: var(--text); }

/* Footer */
.upload-footer { padding: 20px 24px; border-top: 1px solid var(--dark-border); display: flex; gap: 12px; }
.upload-footer .btn { flex: 1; justify-content: center; }
.upload-footer .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  /* Responsive */
@media (max-width: 1024px) { 
    .biblioteca { grid-template-columns: 1fr; } 
    .filters-sidebar { position: static; max-height: none; } 
}

@media (max-width: 768px) { 
    /* Header */
    .header-inner { padding: 12px 16px; }
    .nav { display: none; } 
    .logo-text { font-size: 16px; }
    .logo-tube { font-size: 12px; padding: 2px 6px; }
    .logo-icon { width: 40px; height: 40px; font-size: 20px; }
    /* Notifications Mobile */
    .notif-dropdown { width: 280px; right: -60px; }
    .notif-item { padding: 12px 14px; }
    /* Upload Modal Mobile */
    .upload-modal { max-width: 100%; max-height: 100vh; border-radius: 0; }
    .upload-header { padding: 16px; }
    .upload-header h2 { font-size: 22px; }
    .upload-body { padding: 16px; }
    .upload-source-tabs { flex-direction: column; }
    .upload-preview { flex-direction: column; }
    .upload-preview-thumb { width: 100%; height: 140px; }
    .upload-familia-grid { grid-template-columns: 1fr; }
    .upload-grid { grid-template-columns: 1fr; }
    .upload-grid-3 { grid-template-columns: 1fr 1fr; }
    .upload-url-input { flex-direction: column; }
    .upload-footer { padding: 16px; flex-direction: column; }
    /* Upload Modal Mobile */
    .upload-modal { max-width: 100%; }
    .upload-header { padding: 16px; }
    .upload-header h2 { font-size: 22px; }
    .upload-body { padding: 16px; }
    .upload-preview { flex-direction: column; }
    .upload-preview-thumb { width: 100%; height: 140px; }
    .upload-grid { grid-template-columns: 1fr; }
    .upload-grid-3 { grid-template-columns: 1fr 1fr; }
    .upload-url-input { flex-direction: column; }
    .upload-footer { padding: 16px; flex-direction: column; }
    /* Header Stats */
    .user-stats-header { gap: 6px; margin-right: 4px; }
    .xp-badge, .racha-badge, .limit-badge { padding: 4px 8px; font-size: 10px; }
    .user-menu { padding: 6px 10px; gap: 8px; }
    .user-avatar { width: 32px; height: 32px; font-size: 12px; }
    .user-name { display: none; }
    .plan-badge { font-size: 8px; padding: 2px 6px; margin-left: 0; }
    .user-dropdown { right: -10px; min-width: 220px; }
    
    /* Hero */
    .hero { padding: 100px 16px 60px; min-height: auto; }
    .hero-badge { font-size: 12px; padding: 8px 16px; }
    .hero-title-main { font-size: 32px; flex-direction: column; gap: 8px; }
    .tube-logo { padding: 2px 10px; }
    .tube-text { font-size: 24px; }
    .hero-tagline { font-size: 14px; letter-spacing: 1px; }
    .hero-desc { font-size: 14px; margin-bottom: 24px; }
    .hero-features { flex-direction: column; gap: 12px; margin-bottom: 24px; }
    .hero-feature { font-size: 13px; }
    .hero-buttons { flex-direction: column; gap: 12px; }
    .btn-lg { padding: 14px 24px; font-size: 14px; width: 100%; justify-content: center; }
    .hero-stats { flex-wrap: wrap; gap: 24px; padding-top: 24px; }
    .hero-stat { flex: 1 1 40%; }
    .hero-stat-value { font-size: 32px; }
    .hero-cta-text { font-size: 13px; }
    
    /* Biblioteca */
    .biblioteca { padding: 24px 16px; gap: 20px; }
    .biblioteca-header { flex-direction: column; align-items: stretch; gap: 12px; }
    .biblioteca-title { font-size: 24px; }
    .biblioteca-search { width: 100%; }
    .ejercicios-grid { grid-template-columns: 1fr; gap: 16px; }
    
    /* Filtros en m√≥vil */
    .filters-sidebar { padding: 16px; border-radius: 16px; }
    .filters-header { margin-bottom: 16px; }
    .filter-group { margin-bottom: 14px; }
    .filter-select { padding: 10px 14px; font-size: 13px; }
    .difficulty-pills { gap: 6px; }
    .difficulty-pill { padding: 8px; font-size: 13px; }
    
    /* Cards */
    .ejercicio-card { border-radius: 16px; }
    .ejercicio-body { padding: 16px; }
    .ejercicio-title { font-size: 15px; }
    .ejercicio-tags { gap: 6px; }
    .ejercicio-tag { font-size: 11px; padding: 3px 10px; }
    
    /* Session FAB */
    .session-fab { right: 16px; bottom: 16px; padding: 12px 16px; }
    .session-fab-icon { width: 40px; height: 40px; font-size: 18px; }
    .session-fab-content { display: none; }
    .session-fab-badge { width: 24px; height: 24px; font-size: 11px; top: -6px; right: -6px; }
    
    /* Session Drawer - Fullscreen en m√≥vil */
    .session-drawer { width: 100%; right: -100%; }
    .session-drawer-header { padding: 16px; }
    .session-drawer-title { font-size: 20px; }
    .session-drawer-body { padding: 12px; }
    .session-item { padding: 10px; gap: 10px; }
    .session-item-thumb { width: 50px; height: 34px; }
    .session-item-title { font-size: 12px; }
    .session-drawer-footer { padding: 16px; }
    
    /* Modals */
    .modal-overlay { padding: 16px; }
    .modal-content { border-radius: 20px; max-height: 85vh; }
    .modal-close { width: 36px; height: 36px; font-size: 20px; top: 12px; right: 12px; }
    
    /* Auth Modal */
    .auth-modal { padding: 24px; }
    .auth-title { font-size: 28px; }
    .auth-tabs { gap: 6px; }
    .auth-tab { padding: 10px; font-size: 13px; }
    .auth-input { padding: 12px 14px; font-size: 14px; }
    
    /* Exercise Modal */
    .modal-body { padding: 16px; }
    .modal-title { font-size: 18px; }
    .modal-tags { gap: 6px; }
    .modal-tag { font-size: 11px; padding: 4px 12px; }
    .modal-info-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .modal-info-item { padding: 12px; }
    .modal-info-icon { font-size: 20px; }
    .modal-info-value { font-size: 14px; }
    .modal-description { font-size: 13px; }
    .modal-footer { flex-direction: column; gap: 10px; }
    .modal-footer .btn { width: 100%; justify-content: center; }
    
    /* Save Session Modal */
    .save-modal { padding: 20px; }
    .save-modal-title { font-size: 24px; }
    .form-row { grid-template-columns: 1fr; gap: 0; }
    
    /* Upgrade Modal */
    .upgrade-modal { max-width: 100%; }
    .upgrade-header { padding: 24px 16px; }
    .upgrade-header h2 { font-size: 26px; }
    .upgrade-body { padding: 16px; }
    .upgrade-plans { grid-template-columns: 1fr; gap: 12px; }
    .upgrade-plan { padding: 16px; }
    .upgrade-plan-price { font-size: 32px; }
    .upgrade-plan-features { font-size: 12px; }
    
    /* Leaderboard Modal */
    .leaderboard-modal { padding: 16px; max-height: 80vh; }
    .leaderboard-title { font-size: 24px; }
    .leaderboard-tabs { gap: 6px; }
    .leaderboard-tab { padding: 8px; font-size: 12px; }
    .leaderboard-item { padding: 10px; gap: 10px; }
    .leaderboard-avatar { width: 36px; height: 36px; font-size: 14px; }
    .leaderboard-name { font-size: 13px; }
    .leaderboard-level { font-size: 11px; }
    .leaderboard-xp { font-size: 13px; }
    
    /* View Session Modal */
    .view-session-modal { max-width: 100%; }
    .view-session-header { padding: 16px; }
    .view-session-title { font-size: 22px; }
    .view-session-meta { gap: 10px; font-size: 12px; }
    .view-session-objetivo { padding: 12px 16px; font-size: 13px; }
    .view-session-exercises { padding: 12px 16px; }
    .view-session-exercise { padding: 10px; gap: 10px; flex-wrap: wrap; }
    .view-session-exercise-thumb { width: 60px; height: 40px; }
    .view-session-exercise-title { font-size: 13px; }
    .view-session-exercise-link { padding: 6px 12px; font-size: 11px; }
    .view-session-footer { padding: 12px 16px; }
    .view-session-footer .btn { padding: 10px 16px; font-size: 13px; }
    
    /* My Sessions Modal */
    .my-sessions-modal { padding: 16px; }
    .my-sessions-header { margin-bottom: 16px; }
    .my-session-card { padding: 14px; }
    .my-session-card-name { font-size: 15px; }
    .my-session-card-meta { gap: 12px; font-size: 12px; }
    
    /* Add to Session Modal */
    .sessions-list { max-height: 200px; }
    .session-list-item { padding: 12px; }
    .session-list-item-name { font-size: 13px; }
    
    /* Footer */
    .footer { padding: 24px 16px; margin-top: 40px; }
    .footer-text { font-size: 12px; }
    
    /* Toast */
    .toast { bottom: 80px; padding: 12px 20px; font-size: 13px; max-width: calc(100% - 32px); }
    /* Upload Modal Mobile */
    .upload-modal { max-width: 100%; }
    .upload-header { padding: 16px; }
    .upload-header h2 { font-size: 22px; }
    .upload-body { padding: 16px; }
    .upload-grid { grid-template-columns: 1fr; }
    .upload-grid-3 { grid-template-columns: 1fr 1fr; }
    .upload-url-input { flex-direction: column; }
    .upload-footer { padding: 16px; flex-direction: column; }
}

/* Extra small devices */
@media (max-width: 360px) {
    .hero-title-main { font-size: 28px; }
    .tube-text { font-size: 20px; }
    .hero-stat-value { font-size: 28px; }
    .ejercicio-card { border-radius: 12px; }
    .btn { padding: 10px 16px; font-size: 13px; }
}
/* Pending Exercises */
.pending-section { margin-bottom: 40px; }
.pending-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
.pending-badge { background: var(--warning); color: var(--dark); padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: 600; }
.pending-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; }
.pending-card { background: var(--dark-card); border: 2px solid var(--warning); border-radius: 16px; overflow: hidden; }
.pending-card.duplicate { border-color: var(--danger); }
.pending-card-header { display: flex; gap: 16px; padding: 16px; }
.pending-card-thumb { width: 160px; height: 90px; border-radius: 8px; object-fit: cover; background: var(--dark); flex-shrink: 0; }
.pending-card-info { flex: 1; min-width: 0; }
.pending-card-title { font-weight: 700; font-size: 15px; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.pending-card-meta { font-size: 12px; color: var(--text-muted); display: flex; flex-wrap: wrap; gap: 8px; }
.pending-card-meta span { display: flex; align-items: center; gap: 4px; }
.pending-card-user { display: flex; align-items: center; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--dark-border); font-size: 13px; }
.pending-card-user-avatar { width: 24px; height: 24px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
.pending-card-body { padding: 0 16px 16px; }
.pending-card-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
.pending-card-tag { padding: 4px 10px; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border-radius: 12px; font-size: 11px; }
.pending-card-url { font-size: 12px; color: var(--text-muted); word-break: break-all; margin-bottom: 12px; padding: 8px; background: var(--dark); border-radius: 8px; }
.pending-card-duplicate { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; padding: 10px; margin-bottom: 12px; font-size: 12px; color: var(--danger); }
.pending-card-actions { display: flex; gap: 8px; }
.pending-card-actions .btn { flex: 1; justify-content: center; font-size: 13px; padding: 10px 16px; }

/* Reject Modal */
.reject-modal { max-width: 450px; padding: 24px; }
.reject-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; margin-bottom: 16px; color: var(--danger); }
.reject-reasons { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
.reject-reason { padding: 12px 16px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 10px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.reject-reason:hover { border-color: var(--danger); background: rgba(239, 68, 68, 0.05); }
.reject-reason.selected { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); }
.reject-custom { margin-top: 12px; }
.reject-custom textarea { width: 100%; padding: 12px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; min-height: 80px; resize: vertical; }

/* Stats Cards */
.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 32px; }
.stat-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; padding: 20px; text-align: center; }
.stat-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 36px; color: var(--primary); }
.stat-card-value.warning { color: var(--warning); }
.stat-card-label { font-size: 13px; color: var(--text-muted); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <div class="logo" onclick="scrollToTop()">
                <div class="logo-icon">‚öΩ</div>
                <div class="logo-text">FUTBOL BASE <span class="logo-tube">TUBE</span></div>
            </div>
            <nav class="nav">
                <span class="nav-link active" onclick="scrollToSection('hero')">Inicio</span>
                <span class="nav-link" onclick="scrollToSection('biblioteca')">Biblioteca</span>
                <span class="nav-link" onclick="showMySessions()">Mis Sesiones</span>
                <span class="nav-link">Planes</span>
            </nav>
            <div class="header-actions" id="headerActions">
                <button class="btn btn-ghost" onclick="showAuthModal('login')">Entrar</button>
                <button class="btn btn-primary" onclick="showAuthModal('register')">üöÄ Registrarse</button>
            </div>
        </div>
    </header>

    <section class="hero" id="hero">
        <div class="hero-content">
            <div class="hero-badge">üåç La comunidad #1 de entrenadores de f√∫tbol</div>
            <h1 class="hero-title-main">
                FUTBOL BASE <span class="tube-logo"><span class="tube-text">TUBE</span></span>
            </h1>
            <p class="hero-tagline">LA MAYOR BIBLIOTECA DE EJERCICIOS DE F√öTBOL DEL PLANETA</p>
            <p class="hero-desc">Miles de videos de entrenamiento <strong>filtrados, organizados y etiquetados</strong> por una comunidad de entrenadores como t√∫. Encuentra el ejercicio perfecto en segundos, no en horas.</p>
            
            <div class="hero-features">
                <div class="hero-feature">
                    <span class="hero-feature-icon">üîç</span>
                    <span>+12 filtros avanzados</span>
                </div>
                <div class="hero-feature">
                    <span class="hero-feature-icon">üë•</span>
                    <span>Creado por entrenadores reales</span>
                </div>
                <div class="hero-feature">
                    <span class="hero-feature-icon">üÜì</span>
                    <span>100% contenido gratuito</span>
                </div>
            </div>
            
            <div class="hero-buttons">
    <button class="btn btn-primary btn-lg" onclick="scrollToSection('biblioteca')">üé¨ Explorar Ejercicios</button>
    <button class="btn btn-ghost btn-lg" id="btnUploadHero" onclick="showUploadModal()">üì§ Subir Ejercicio</button>
</div>
            
            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="hero-stat-value" id="heroTotal">0</div>
                    <div class="hero-stat-label">Ejercicios</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="heroEntrenadores">0</div>
                    <div class="hero-stat-label">Entrenadores</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="heroCategorias">0</div>
                    <div class="hero-stat-label">Categor√≠as</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="heroUsuarios">+2K</div>
                    <div class="hero-stat-label">Usuarios</div>
                </div>
            </div>
            
            <p class="hero-cta-text">¬øTienes un video de entrenamiento? <a href="#" onclick="showAuthModal('register')">Comp√°rtelo con la comunidad ‚Üí</a></p>
        </div>
    </section>

    <section class="biblioteca" id="biblioteca">
        <aside class="filters-sidebar">
            <div class="filters-header">
                <div class="filters-title">üéØ Filtros <span class="filters-badge" id="filtersBadge"></span></div>
                <span class="filters-clear" onclick="clearFilters()">Limpiar</span>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Categor√≠a</label>
                <select class="filter-select" id="filterCategoria"><option value="">Todas</option></select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Dificultad</label>
                <div class="difficulty-pills" id="filterDificultad">
                    <div class="difficulty-pill" data-value="1">1</div>
                    <div class="difficulty-pill" data-value="2">2</div>
                    <div class="difficulty-pill" data-value="3">3</div>
                    <div class="difficulty-pill" data-value="4">4</div>
                    <div class="difficulty-pill" data-value="5">5</div>
                </div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Entrenador</label>
                <select class="filter-select" id="filterEntrenador"><option value="">Todos</option></select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Equipo</label>
                <select class="filter-select" id="filterEquipo"><option value="">Todos</option></select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Idioma</label>
                <select class="filter-select" id="filterIdioma"><option value="">Todos</option></select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Edad</label>
                <select class="filter-select" id="filterEdad"><option value="">Todas</option></select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Duraci√≥n</label>
                <select class="filter-select" id="filterDuracion">
                    <option value="">Todas</option>
                    <option value="0-300">0-5 min</option>
                    <option value="300-600">5-10 min</option>
                    <option value="600-900">10-15 min</option>
                    <option value="900-1800">15-30 min</option>
                    <option value="1800-99999">30+ min</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">N¬∫ Jugadores</label>
                <select class="filter-select" id="filterJugadores"><option value="">Todos</option></select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">N¬∫ Porteros</label>
                <select class="filter-select" id="filterPorteros">
                    <option value="">Todos</option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3+">3+</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Popularidad (Likes)</label>
                <select class="filter-select" id="filterLikes">
                    <option value="">Todos</option>
                    <option value="0-100">0-100</option>
                    <option value="100-500">100-500</option>
                    <option value="500-1000">500-1K</option>
                    <option value="1000-10000">1K-10K</option>
                    <option value="10000-99999999">10K+</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Vistas</label>
                <select class="filter-select" id="filterVistas">
                    <option value="">Todas</option>
                    <option value="0-1000">0-1K</option>
                    <option value="1000-10000">1K-10K</option>
                    <option value="10000-100000">10K-100K</option>
                    <option value="100000-1000000">100K-1M</option>
                    <option value="1000000-99999999">1M+</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">Fuente</label>
                <select class="filter-select" id="filterFuente">
                    <option value="">Todas</option>
                    <option value="youtube">üì∫ YouTube</option>
                    <option value="twitter">ùïè Twitter</option>
                    <option value="instagram">üì∑ Instagram</option>
                </select>
            </div>
        </aside>

        <main class="biblioteca-main">
            <div class="biblioteca-header">
                <div>
                    <h1 class="biblioteca-title">BIBLIOTECA DE EJERCICIOS</h1>
                    <p class="biblioteca-count">Mostrando <span id="exerciseCount">0</span> ejercicios</p>
                </div>
                <div class="biblioteca-search">
                    <span>üîç</span>
                    <input type="text" id="searchInput" placeholder="Buscar ejercicios...">
                </div>
            </div>
            <div class="ejercicios-grid" id="exerciseGrid">
                <div class="state-container">
                    <div class="loading-spinner"></div>
                    <p>Cargando ejercicios...</p>
                </div>
            </div>
        </main>
    </section>

    <footer class="footer">
        <p class="footer-text">¬© 2024 Futbol Base TUBE. Creado por entrenadores, para entrenadores. üåç</p>
    </footer>

    <!-- Floating Session Button -->
    <div class="session-fab" id="sessionFab" onclick="toggleSessionDrawer()">
        <div class="session-fab-icon">üèãÔ∏è</div>
        <div class="session-fab-content">
            <div class="session-fab-title">Mi Sesi√≥n</div>
            <div class="session-fab-count"><span id="fabCount">0</span> ejercicios</div>
        </div>
        <div class="session-fab-badge" id="fabBadge">0</div>
    </div>

    <!-- Session Drawer -->
    <div class="session-drawer-backdrop" id="drawerBackdrop" onclick="toggleSessionDrawer()"></div>
    <div class="session-drawer" id="sessionDrawer">
        <div class="session-drawer-header">
            <div class="session-drawer-title">üèãÔ∏è Mi Sesi√≥n</div>
            <button class="session-drawer-close" onclick="toggleSessionDrawer()">‚úï</button>
        </div>
        <div class="session-drawer-body" id="sessionBody">
            <div class="session-empty">
                <div class="session-empty-icon">üìã</div>
                <div class="session-empty-text">A√±ade ejercicios desde la biblioteca<br>usando el bot√≥n ‚ûï</div>
            </div>
        </div>
        <div class="session-drawer-footer">
            <div class="session-stats">
                <span>Duraci√≥n total:</span>
                <strong id="sessionDuration">0 min</strong>
            </div>
            <div class="session-actions">
                <button class="btn btn-ghost btn-sm" onclick="clearSession()">üóëÔ∏è Vaciar</button>
                <button class="btn btn-primary btn-sm" onclick="saveSession()" id="btnSaveSession">üíæ Guardar</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authOverlay" onclick="closeAuthModal(event)">
        <div class="modal-content auth-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeAuthModal()">√ó</button>
            <h2 class="auth-title" id="authTitle">BIENVENIDO</h2>
            <p class="auth-subtitle" id="authSubtitle">Accede a tu cuenta para guardar sesiones</p>
            <div class="auth-tabs">
                <div class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">Entrar</div>
                <div class="auth-tab" id="tabRegister" onclick="switchAuthTab('register')">Registrarse</div>
            </div>
            <div class="auth-error" id="authError"></div>
            <form class="auth-form" id="authForm" onsubmit="handleAuth(event)">
                <input type="text" class="auth-input" id="authName" placeholder="Tu nombre" style="display:none;">
                <input type="email" class="auth-input" id="authEmail" placeholder="Email" required>
                <input type="password" class="auth-input" id="authPassword" placeholder="Contrase√±a" required>
                <button type="submit" class="btn btn-primary" style="width:100%;" id="authSubmit">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Exercise Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-video" id="modalVideo"></div>
            <div class="modal-body">
                <h2 class="modal-title" id="modalTitle"></h2>
                <div class="modal-tags" id="modalTags"></div>
                <div class="modal-info-grid" id="modalInfo"></div>
                <p class="modal-description" id="modalDesc"></p>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="modalAddSession" onclick="addCurrentToSession()">‚ûï A√±adir a Sesi√≥n</button>
                    <button class="btn btn-ghost" id="modalFavorite" onclick="toggleFavorite()">‚ù§Ô∏è Favorito</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Session Modal -->
    <div class="modal-overlay" id="saveOverlay" onclick="closeSaveModal(event)">
        <div class="modal-content save-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeSaveModal()">√ó</button>
            <h2 class="save-modal-title">üíæ Guardar Sesi√≥n</h2>
            <input type="text" class="auth-input" id="sessionName" placeholder="Nombre de la sesi√≥n (ej: Entrenamiento Lunes)">
            <div class="form-row">
                <input type="date" class="auth-input" id="sessionDate" placeholder="Fecha">
                <select class="auth-input" id="sessionCategoria">
                    <option value="">Categor√≠a edad</option>
                    <option value="Prebenjam√≠n">Prebenjam√≠n (5-7)</option>
                    <option value="Benjam√≠n">Benjam√≠n (8-9)</option>
                    <option value="Alev√≠n">Alev√≠n (10-11)</option>
                    <option value="Infantil">Infantil (12-13)</option>
                    <option value="Cadete">Cadete (14-15)</option>
                    <option value="Juvenil">Juvenil (16-18)</option>
                    <option value="Senior">Senior (19+)</option>
                    <option value="Profesional">Profesional</option>
                </select>
            </div>
            <input type="text" class="auth-input" id="sessionObjetivo" placeholder="Objetivo (ej: Mejorar pase y control)">
            <textarea class="auth-input" id="sessionNotas" placeholder="Notas adicionales (ej: Llevar petos rojos)" style="min-height:80px;resize:vertical;"></textarea>
            <button class="btn btn-primary" style="width:100%;" onclick="confirmSaveSession()">üíæ Guardar Sesi√≥n</button>
        </div>
    </div>

    <!-- Add to Session Modal -->
    <div class="modal-overlay" id="addToSessionOverlay" onclick="closeAddToSessionModal(event)">
        <div class="modal-content save-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeAddToSessionModal()">√ó</button>
            <h2 class="save-modal-title">‚ûï A√±adir a Sesi√≥n</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 14px;">Selecciona la sesi√≥n donde quieres a√±adir este ejercicio:</p>
            <div class="sessions-list" id="sessionsListModal">
                <div class="session-list-loading">Cargando sesiones...</div>
            </div>
            <div class="session-divider">
                <span>o crea una nueva</span>
            </div>
            <button class="btn btn-ghost" style="width:100%;" onclick="createNewSessionFromModal()">‚ûï Crear nueva sesi√≥n</button>
        </div>
    </div>

    <!-- View Session Modal -->
    <div class="modal-overlay" id="viewSessionOverlay" onclick="closeViewSessionModal(event)">
        <div class="modal-content view-session-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeViewSessionModal()">√ó</button>
            <div class="view-session-header">
                <h2 class="view-session-title" id="viewSessionTitle">Nombre de sesi√≥n</h2>
                <div class="view-session-meta" id="viewSessionMeta"></div>
            </div>
            <div class="view-session-objetivo" id="viewSessionObjetivo"></div>
            <div class="view-session-exercises" id="viewSessionExercises"></div>
            <div class="view-session-notas" id="viewSessionNotas"></div>
            <div class="view-session-footer">
                <button class="btn btn-primary" onclick="copySessionLink()">üîó Copiar Link</button>
                <button class="btn btn-ghost" onclick="editCurrentSession()">‚úèÔ∏è Editar</button>
                <button class="btn btn-danger btn-sm" onclick="deleteCurrentSession()">üóëÔ∏è Eliminar</button>
            </div>
        </div>
    </div>

    <!-- My Sessions Page Modal -->
    <div class="modal-overlay" id="mySessionsOverlay" onclick="closeMySessionsModal(event)">
        <div class="modal-content my-sessions-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeMySessionsModal()">√ó</button>
            <div class="my-sessions-header">
                <h2 class="save-modal-title">üìã Mis Sesiones</h2>
                <button class="btn btn-primary btn-sm" onclick="closeMySessionsModal();saveSession();">‚ûï Nueva</button>
            </div>
            <div class="my-sessions-list" id="mySessionsList">
                <div class="session-list-loading">Cargando sesiones...</div>
            </div>
        </div>
    </div>
<!-- Upload Exercise Modal -->
<div class="modal-overlay" id="uploadOverlay" onclick="closeUploadModal(event)">
    <div class="modal-content upload-modal" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeUploadModal()">√ó</button>
        
        <div class="upload-header">
            <h2>üì§ SUBIR EJERCICIO</h2>
            <p>Comparte contenido de entrenamiento con la comunidad</p>
        </div>
        
        <div class="upload-body">
            
            <!-- PASO 1: Fuente del contenido -->
            <div class="upload-section">
                <div class="upload-section-title">1Ô∏è‚É£ Fuente del Contenido *</div>
                <div class="upload-source-tabs">
                    <button class="upload-source-tab active" onclick="setUploadSource('video')">üì∫ URL de Video</button>
                    <button class="upload-source-tab" onclick="setUploadSource('imagen')">üñºÔ∏è Subir Imagen</button>
                </div>
                
                <!-- Opci√≥n Video -->
                <div class="upload-source-content" id="uploadSourceVideo">
                    <div class="upload-url-input">
                        <input type="text" class="auth-input" id="uploadUrl" placeholder="https://youtube.com/watch?v=... o twitter.com/...">
                        <button class="btn btn-primary" onclick="extractVideoInfo()">Extraer</button>
                    </div>
                    <div class="upload-status" id="uploadStatus"></div>
                </div>
                
                <!-- Opci√≥n Imagen -->
                <div class="upload-source-content" id="uploadSourceImagen" style="display:none;">
                    <div class="upload-image-drop" id="uploadImageDrop" onclick="document.getElementById('uploadImageInput').click()">
                        <input type="file" id="uploadImageInput" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
                        <div class="upload-image-placeholder" id="uploadImagePlaceholder">
                            <span class="upload-image-icon">üì∑</span>
                            <span>Haz clic o arrastra una imagen</span>
                            <span class="upload-image-hint">JPG, PNG - M√°x 5MB</span>
                        </div>
                        <img id="uploadImagePreview" class="upload-image-preview" style="display:none;">
                    </div>
                </div>
            </div>
            
            <!-- Datos extra√≠dos del video (solo si es video) -->
            <div class="upload-section upload-extracted" id="uploadExtracted" style="display:none;">
                <div class="upload-section-title">üì∫ Datos del Video (autom√°tico)</div>
                <div class="upload-preview">
                    <img class="upload-preview-thumb" id="uploadThumb" src="">
                    <div class="upload-preview-info">
                        <div class="upload-preview-title" id="uploadPreviewTitle"></div>
                        <div class="upload-preview-channel" id="uploadPreviewChannel"></div>
                        <div class="upload-preview-stats">
                            <span id="uploadPreviewViews">üëÅÔ∏è 0</span>
                            <span id="uploadPreviewLikes">üëç 0</span>
                            <span id="uploadPreviewDuration">‚è±Ô∏è 0:00</span>
                            <span id="uploadPreviewLang">üåê</span>
                        </div>
                    </div>
                </div>
                <div class="upload-credit-notice">
                    <span>‚úÖ</span>
                    <span>El contenido ser√° atribuido a <strong id="uploadCreditChannel">-</strong> con enlace al video original</span>
                </div>
            </div>
            
            <!-- PASO 2: Familia (obligatorio) -->
            <div class="upload-section" id="uploadFamiliaSection" style="display:none;">
                <div class="upload-section-title">2Ô∏è‚É£ Familia del Contenido *</div>
                <div class="upload-familia-grid">
                    <div class="upload-familia-option" onclick="selectFamilia('futbol_base')">
                        <span class="upload-familia-icon">‚öΩ</span>
                        <span class="upload-familia-name">F√∫tbol Base</span>
                    </div>
                    <div class="upload-familia-option" onclick="selectFamilia('profesional')">
                        <span class="upload-familia-icon">üèüÔ∏è</span>
                        <span class="upload-familia-name">Equipo/Entrenador Profesional</span>
                    </div>
                    <div class="upload-familia-option" onclick="selectFamilia('entrevista')">
                        <span class="upload-familia-icon">üé§</span>
                        <span class="upload-familia-name">Entrevista</span>
                    </div>
                    <div class="upload-familia-option" onclick="selectFamilia('analisis')">
                        <span class="upload-familia-icon">üìä</span>
                        <span class="upload-familia-name">An√°lisis T√°ctico</span>
                    </div>
                </div>
                
                <!-- Campos extra seg√∫n familia -->
                <div class="upload-familia-extra" id="familiaExtraProfesional" style="display:none;">
                    <div class="upload-grid">
                        <div class="upload-field">
                            <label>Entrenador</label>
                            <select id="uploadEntrenador">
                                <option value="">Seleccionar...</option>
                                <option value="Pep Guardiola">Pep Guardiola</option>
                                <option value="J√ºrgen Klopp">J√ºrgen Klopp</option>
                                <option value="Carlo Ancelotti">Carlo Ancelotti</option>
                                <option value="Diego Simeone">Diego Simeone</option>
                                <option value="Xavi Hern√°ndez">Xavi Hern√°ndez</option>
                                <option value="Mikel Arteta">Mikel Arteta</option>
                                <option value="Luis Enrique">Luis Enrique</option>
                                <option value="Unai Emery">Unai Emery</option>
                                <option value="Julian Nagelsmann">Julian Nagelsmann</option>
                                <option value="Thomas Tuchel">Thomas Tuchel</option>
                                <option value="Hansi Flick">Hansi Flick</option>
                                <option value="Zinedine Zidane">Zinedine Zidane</option>
                                <option value="Mauricio Pochettino">Mauricio Pochettino</option>
                                <option value="Erik ten Hag">Erik ten Hag</option>
                                <option value="Roberto De Zerbi">Roberto De Zerbi</option>
                                <option value="Xabi Alonso">Xabi Alonso</option>
                                <option value="Marcelo Bielsa">Marcelo Bielsa</option>
                                <option value="Arne Slot">Arne Slot</option>
                                <option value="Ruben Amorim">Ruben Amorim</option>
                                <option value="Vincent Kompany">Vincent Kompany</option>
                                <option value="_otro">Otro...</option>
                            </select>
                        </div>
                        <div class="upload-field">
                            <label>Equipo</label>
                            <select id="uploadEquipo">
                                <option value="">Seleccionar...</option>
                                <optgroup label="üá™üá∏ Espa√±a">
                                    <option value="FC Barcelona">FC Barcelona</option>
                                    <option value="Real Madrid">Real Madrid</option>
                                    <option value="Atl√©tico Madrid">Atl√©tico Madrid</option>
                                    <option value="Athletic Bilbao">Athletic Bilbao</option>
                                    <option value="Real Sociedad">Real Sociedad</option>
                                    <option value="Sevilla FC">Sevilla FC</option>
                                    <option value="Valencia CF">Valencia CF</option>
                                    <option value="Villarreal CF">Villarreal CF</option>
                                    <option value="Real Betis">Real Betis</option>
                                </optgroup>
                                <optgroup label="üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Inglaterra">
                                    <option value="Manchester City">Manchester City</option>
                                    <option value="Liverpool">Liverpool</option>
                                    <option value="Arsenal">Arsenal</option>
                                    <option value="Chelsea">Chelsea</option>
                                    <option value="Manchester United">Manchester United</option>
                                    <option value="Tottenham">Tottenham</option>
                                    <option value="Aston Villa">Aston Villa</option>
                                    <option value="Brighton">Brighton</option>
                                    <option value="Newcastle">Newcastle</option>
                                </optgroup>
                                <optgroup label="üá©üá™ Alemania">
                                    <option value="Bayern Munich">Bayern Munich</option>
                                    <option value="Borussia Dortmund">Borussia Dortmund</option>
                                    <option value="RB Leipzig">RB Leipzig</option>
                                    <option value="Bayer Leverkusen">Bayer Leverkusen</option>
                                </optgroup>
                                <optgroup label="üáÆüáπ Italia">
                                    <option value="Juventus">Juventus</option>
                                    <option value="AC Milan">AC Milan</option>
                                    <option value="Inter Milan">Inter Milan</option>
                                    <option value="Napoli">Napoli</option>
                                    <option value="AS Roma">AS Roma</option>
                                    <option value="Atalanta">Atalanta</option>
                                </optgroup>
                                <optgroup label="üá´üá∑ Francia">
                                    <option value="PSG">PSG</option>
                                    <option value="Olympique Lyon">Olympique Lyon</option>
                                    <option value="Olympique Marsella">Olympique Marsella</option>
                                    <option value="AS Monaco">AS Monaco</option>
                                </optgroup>
                                <optgroup label="üåç Selecciones">
                                    <option value="Espa√±a">Espa√±a</option>
                                    <option value="Alemania">Alemania</option>
                                    <option value="Francia">Francia</option>
                                    <option value="Inglaterra">Inglaterra</option>
                                    <option value="Italia">Italia</option>
                                    <option value="Argentina">Argentina</option>
                                    <option value="Brasil">Brasil</option>
                                    <option value="Portugal">Portugal</option>
                                </optgroup>
                                <option value="_otro">Otro...</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="upload-familia-extra" id="familiaExtraAnalisis" style="display:none;">
                    <div class="upload-field">
                        <label>Sistema de Juego</label>
                        <select id="uploadSistema">
                            <option value="">Seleccionar sistema...</option>
                            <optgroup label="4 Defensas">
                                <option value="4-4-2">4-4-2</option>
                                <option value="4-4-2 Rombo">4-4-2 Rombo</option>
                                <option value="4-3-3">4-3-3</option>
                                <option value="4-2-3-1">4-2-3-1</option>
                                <option value="4-1-4-1">4-1-4-1</option>
                                <option value="4-3-1-2">4-3-1-2</option>
                                <option value="4-1-2-1-2">4-1-2-1-2</option>
                            </optgroup>
                            <optgroup label="3 Defensas">
                                <option value="3-5-2">3-5-2</option>
                                <option value="3-4-3">3-4-3</option>
                                <option value="3-4-2-1">3-4-2-1</option>
                                <option value="3-1-4-2">3-1-4-2</option>
                            </optgroup>
                            <optgroup label="5 Defensas">
                                <option value="5-3-2">5-3-2</option>
                                <option value="5-4-1">5-4-1</option>
                                <option value="5-2-3">5-2-3</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- PASO 3: Descripci√≥n del usuario -->
            <div class="upload-section" id="uploadDescSection" style="display:none;">
                <div class="upload-section-title">3Ô∏è‚É£ Tu Aportaci√≥n</div>
                <div class="upload-field">
                    <label>Describe el ejercicio con tus palabras <span class="upload-bonus">(+10 XP extra)</span></label>
                    <textarea id="uploadDescripcion" placeholder="Ej: Ejercicio de posesi√≥n donde se trabaja la salida de bal√≥n con presi√≥n alta del rival. Ideal para trabajar la toma de decisiones..." rows="3"></textarea>
                </div>
            </div>
            
            <!-- PASO 4: Temas trabajados -->
            <div class="upload-section" id="uploadTemasSection" style="display:none;">
                <div class="upload-section-title">4Ô∏è‚É£ Temas Trabajados * <span class="upload-hint">(selecciona 1-5)</span></div>
                <div class="upload-temas-grid" id="uploadTemas"></div>
            </div>
            
            <!-- PASO 5: Detalles adicionales -->
            <div class="upload-section" id="uploadDetallesSection" style="display:none;">
                <div class="upload-section-title">5Ô∏è‚É£ Detalles Adicionales</div>
                <div class="upload-grid">
                    <div class="upload-field">
                        <label>Dificultad *</label>
                        <select id="uploadDificultad">
                            <option value="">Seleccionar</option>
                            <option value="1">1 - Muy f√°cil</option>
                            <option value="2">2 - F√°cil</option>
                            <option value="3">3 - Intermedio</option>
                            <option value="4">4 - Dif√≠cil</option>
                            <option value="5">5 - Muy dif√≠cil</option>
                        </select>
                    </div>
                    <div class="upload-field">
                        <label>Edad recomendada</label>
                        <select id="uploadEdad">
                            <option value="">Seleccionar</option>
                            <option value="Prebenjam√≠n">Prebenjam√≠n (5-7)</option>
                            <option value="Benjam√≠n">Benjam√≠n (8-9)</option>
                            <option value="Alev√≠n">Alev√≠n (10-11)</option>
                            <option value="Infantil">Infantil (12-13)</option>
                            <option value="Cadete">Cadete (14-15)</option>
                            <option value="Juvenil">Juvenil (16-18)</option>
                            <option value="Senior">Senior (19+)</option>
                            <option value="Profesional">Profesional</option>
                        </select>
                    </div>
                </div>
                <div class="upload-grid-3">
                    <div class="upload-field">
                        <label>N¬∫ Jugadores</label>
                        <select id="uploadJugadores">
                            <option value="">-</option>
                            <option value="2-4">2-4</option>
                            <option value="5-8">5-8</option>
                            <option value="9-12">9-12</option>
                            <option value="13-16">13-16</option>
                            <option value="17-20">17-20</option>
                            <option value="20+">20+</option>
                        </select>
                    </div>
                    <div class="upload-field">
                        <label>N¬∫ Porteros</label>
                        <select id="uploadPorteros">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3+</option>
                        </select>
                    </div>
                    <div class="upload-field">
                        <label>Dimensiones</label>
                        <select id="uploadDimensiones">
                            <option value="">-</option>
                            <option value="10x10m">10x10m</option>
                            <option value="15x15m">15x15m</option>
                            <option value="20x20m">20x20m</option>
                            <option value="30x30m">30x30m</option>
                            <option value="Medio campo">Medio campo</option>
                            <option value="Campo completo">Campo completo</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Pizarra T√°ctica -->
            <div class="upload-section" id="uploadPizarraSection" style="display:none;">
                <div class="upload-field">
                    <label>üé® Imagen de Pizarra T√°ctica (opcional)</label>
                    <div class="upload-pizarra" id="uploadPizarraBox" onclick="openPizarra()">
                        <div class="upload-pizarra-icon">üé®</div>
                        <div class="upload-pizarra-text">Crear imagen con Pizarra T√°ctica</div>
                        <div class="upload-pizarra-hint">+50 XP extra si incluyes imagen</div>
                    </div>
                </div>
                
                <div class="upload-xp-bonus" id="uploadXpBonus">
                    <span>‚≠ê</span>
                    <span>Ganar√°s <strong id="uploadXpTotal">+50 XP</strong> cuando se apruebe</span>
                </div>
            </div>
        </div>
        
        <div class="upload-footer">
            <button class="btn btn-ghost" onclick="closeUploadModal()">Cancelar</button>
            <button class="btn btn-primary" id="btnSubmitExercise" onclick="submitExercise()" disabled>üì§ Enviar Ejercicio</button>
        </div>
    </div>
</div>
    <!-- Leaderboard Modal -->
    <div class="modal-overlay" id="leaderboardOverlay" onclick="closeLeaderboardModal(event)">
        <div class="modal-content leaderboard-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeLeaderboardModal()">√ó</button>
            <h2 class="leaderboard-title">üèÜ Ranking</h2>
            <div class="leaderboard-tabs">
                <div class="leaderboard-tab active" onclick="loadLeaderboard('mes')">Este Mes</div>
                <div class="leaderboard-tab" onclick="loadLeaderboard('total')">Total</div>
            </div>
            <div class="leaderboard-list" id="leaderboardList">
                <div class="session-list-loading">Cargando ranking...</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
    var SUPABASE_URL = 'https://ltwczsyfutrshhezkyoo.supabase.co';
    var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx0d2N6c3lmdXRyc2hoZXpreW9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MTA2MTEsImV4cCI6MjA4MjQ4NjYxMX0.jb_Th1iqaTm7LHonlp6mBYJnMr-WhmA0D0b4BxLO9UA';

    // Stripe Price IDs (configurar en Stripe Dashboard)
    var STRIPE_PRICES = {
        pro: 'price_PRO_MONTHLY_ID',
        coach: 'price_COACH_MONTHLY_ID'
    };

    var db = null;
    var currentUser = null;
    var userProfile = null;
    var userLimits = null;
    var exercises = [];
    var filteredExercises = [];
    var selectedDificultad = null;
    var currentExercise = null;
    var mySession = [];
    var favorites = [];
    var authMode = 'login';

    var LANG_FLAGS = { 'es': 'üá™üá∏', 'en': 'üá¨üáß', 'pt': 'üáµüáπ', 'it': 'üáÆüáπ', 'de': 'üá©üá™', 'fr': 'üá´üá∑', 'nl': 'üá≥üá±', 'other': 'üåê' };
    var LANG_NAMES = { 'es': 'Espa√±ol', 'en': 'Ingl√©s', 'pt': 'Portugu√©s', 'it': 'Italiano', 'de': 'Alem√°n', 'fr': 'Franc√©s', 'nl': 'Holand√©s', 'other': 'Otro' };

    document.addEventListener('DOMContentLoaded', function() {
        if (typeof supabase !== 'undefined') {
            db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            checkAuth();
            loadExercises();
            checkSharedSession();
        } else {
            showError('Error cargando Supabase');
        }
        initFilters();
        loadSessionFromStorage();
    });

    // ==================== AUTH ====================
    function checkAuth() {
        db.auth.getSession().then(function(result) {
            if (result.data.session) {
                currentUser = result.data.session.user;
                loadUserProfile();
                loadFavorites();
            }
        });

        db.auth.onAuthStateChange(function(event, session) {
            if (session) {
                currentUser = session.user;
                loadUserProfile();
                loadFavorites();
            } else {
                currentUser = null;
                userProfile = null;
                userLimits = null;
                updateUIForGuest();
            }
        });
    }

    function loadUserProfile() {
        db.from('perfiles').select('*').eq('id', currentUser.id).single()
            .then(function(result) {
                if (result.data) {
                    userProfile = result.data;
                    checkAndResetMonthlyLimits();
                    updateUIForUser();
                    updateRacha();
                }
            });
    }

    function checkAndResetMonthlyLimits() {
        var mesActual = new Date().toISOString().slice(0, 7);
        if (userProfile.mes_actual !== mesActual) {
            db.from('perfiles').update({
                ejercicios_vistos_mes: 0,
                mes_actual: mesActual
            }).eq('id', currentUser.id).then(function() {
                userProfile.ejercicios_vistos_mes = 0;
                userProfile.mes_actual = mesActual;
            });
        }
        loadPlanLimits();
    }

    function loadPlanLimits() {
        db.from('limites_plan').select('*').eq('plan', userProfile.plan).single()
            .then(function(result) {
                if (result.data) {
                    userLimits = result.data;
                    updateLimitsUI();
                }
            });
    }

    function updateRacha() {
        db.rpc('actualizar_racha', { p_usuario_id: currentUser.id })
            .then(function(result) {
                if (result.data) {
                    userProfile.racha_dias = result.data;
                }
            });
    }

    function updateLimitsUI() {
        var limitBadge = document.getElementById('limitBadge');
        if (limitBadge && userLimits) {
            if (userLimits.ejercicios_mes === -1) {
                limitBadge.style.display = 'none';
            } else {
                limitBadge.innerHTML = 'üëÅÔ∏è ' + userProfile.ejercicios_vistos_mes + '/' + userLimits.ejercicios_mes;
                limitBadge.style.display = 'inline-flex';
                if (userProfile.ejercicios_vistos_mes >= userLimits.ejercicios_mes) {
                    limitBadge.classList.add('limit-reached');
                }
            }
        }
    }

    function canViewExercise() {
        if (!currentUser) return true; // Guests can view (will prompt login)
        if (!userLimits) return true;
        if (userLimits.ejercicios_mes === -1) return true; // Unlimited
        return userProfile.ejercicios_vistos_mes < userLimits.ejercicios_mes;
    }

    function incrementExerciseView() {
        if (!currentUser || !userLimits) return;
        if (userLimits.ejercicios_mes === -1) return; // Unlimited
        
        userProfile.ejercicios_vistos_mes++;
        db.from('perfiles').update({
            ejercicios_vistos_mes: userProfile.ejercicios_vistos_mes
        }).eq('id', currentUser.id);
        updateLimitsUI();
    }

    function updateUIForUser() {
    var name = userProfile?.nombre || currentUser.user_metadata?.nombre || currentUser.email.split('@')[0];
    var initial = name.charAt(0).toUpperCase();
    var plan = userProfile?.plan || 'free';
    var xp = userProfile?.xp || 0;
    var nivel = userProfile?.nivel || 1;
    var titulo = userProfile?.titulo || 'Juvenil';
    var racha = userProfile?.racha_dias || 0;
    
    var planBadge = '';
    if (plan === 'pro') planBadge = '<span class="plan-badge pro">PRO</span>';
    if (plan === 'coach') planBadge = '<span class="plan-badge coach">COACH</span>';
    
    document.getElementById('headerActions').innerHTML = 
        '<div class="user-stats-header">' +
            '<span class="xp-badge" title="Nivel ' + nivel + ' - ' + titulo + '">‚≠ê ' + formatNumber(xp) + ' XP</span>' +
            (racha > 1 ? '<span class="racha-badge" title="Racha de ' + racha + ' d√≠as">üî• ' + racha + '</span>' : '') +
            '<span class="limit-badge" id="limitBadge"></span>' +
        '</div>' +
        '<div class="notif-bell" onclick="toggleNotifications(event)">' +
            '<span class="notif-bell-icon">üîî</span>' +
            '<span class="notif-badge" id="notifBadge">0</span>' +
            '<div class="notif-dropdown" id="notifDropdown">' +
                '<div class="notif-header">' +
                    '<span class="notif-header-title">Notificaciones</span>' +
                    '<span class="notif-header-action" onclick="markAllRead(event)">Marcar le√≠das</span>' +
                '</div>' +
                '<div class="notif-list" id="notifList">' +
                    '<div class="notif-empty"><div class="notif-empty-icon">üîî</div>No tienes notificaciones</div>' +
                '</div>' +
            '</div>' +
        '</div>' +
        '<div class="user-menu" onclick="toggleUserMenu(event)">' +
            '<div class="user-avatar">' + initial + '</div>' +
            '<span class="user-name">' + name + '</span>' +
            planBadge +
            '<div class="user-dropdown" id="userDropdown">' +
                '<div class="user-dropdown-header">' +
                    '<div class="user-dropdown-level">Nivel ' + nivel + ' - ' + titulo + '</div>' +
                    '<div class="user-dropdown-xp">' + formatNumber(xp) + ' XP</div>' +
                '</div>' +
                '<div class="user-dropdown-item" onclick="showMySessions()">üìã Mis Sesiones</div>' +
                '<div class="user-dropdown-item" onclick="showFavorites()">‚ù§Ô∏è Favoritos</div>' +
                '<div class="user-dropdown-item" onclick="showLeaderboard()">üèÜ Ranking</div>' +
                '<div class="user-dropdown-item" onclick="showMyProfile()">üë§ Mi Perfil</div>' +
                (plan === 'free' ? '<div class="user-dropdown-item upgrade" onclick="showUpgradeModal()">‚≠ê Mejorar Plan</div>' : '') +
                '<div class="user-dropdown-item danger" onclick="logout()">üö™ Salir</div>' +
            '</div>' +
        '</div>';
    
    updateLimitsUI();
    loadNotifications();
}
    function updateUIForGuest() {
        document.getElementById('headerActions').innerHTML = 
            '<button class="btn btn-ghost" onclick="showAuthModal(\'login\')">Entrar</button>' +
            '<button class="btn btn-primary" onclick="showAuthModal(\'register\')">üöÄ Registrarse</button>';
    }

    function toggleUserMenu(e) {
        e.stopPropagation();
        var dropdown = document.getElementById('userDropdown');
        dropdown.classList.toggle('show');
        document.addEventListener('click', function closeDropdown() {
            dropdown.classList.remove('show');
            document.removeEventListener('click', closeDropdown);
        });
    }

    function showAuthModal(mode) {
        authMode = mode;
        switchAuthTab(mode);
        document.getElementById('authOverlay').classList.add('active');
    }

    function closeAuthModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('authOverlay').classList.remove('active');
        document.getElementById('authError').classList.remove('show');
    }

    function switchAuthTab(mode) {
        authMode = mode;
        document.getElementById('tabLogin').classList.toggle('active', mode === 'login');
        document.getElementById('tabRegister').classList.toggle('active', mode === 'register');
        document.getElementById('authName').style.display = mode === 'register' ? 'block' : 'none';
        document.getElementById('authSubmit').textContent = mode === 'login' ? 'Entrar' : 'Crear Cuenta';
        document.getElementById('authTitle').textContent = mode === 'login' ? 'BIENVENIDO' : '√öNETE';
        document.getElementById('authSubtitle').textContent = mode === 'login' ? 'Accede a tu cuenta' : 'Crea tu cuenta gratis';
    }

    function handleAuth(e) {
        e.preventDefault();
        var email = document.getElementById('authEmail').value;
        var password = document.getElementById('authPassword').value;
        var name = document.getElementById('authName').value;

        if (authMode === 'login') {
            db.auth.signInWithPassword({ email: email, password: password })
                .then(function(result) {
                    if (result.error) {
                        showAuthError(result.error.message);
                    } else {
                        closeAuthModal();
                        showToast('¬°Bienvenido de vuelta!', 'success');
                    }
                });
        } else {
            db.auth.signUp({ 
                email: email, 
                password: password,
                options: { data: { nombre: name } }
            }).then(function(result) {
                if (result.error) {
                    showAuthError(result.error.message);
                } else {
                    closeAuthModal();
                    showToast('¬°Cuenta creada! Revisa tu email para confirmar.', 'success');
                }
            });
        }
    }

    function showAuthError(msg) {
        var el = document.getElementById('authError');
        el.textContent = msg;
        el.classList.add('show');
    }

    function logout() {
        db.auth.signOut().then(function() {
            showToast('Sesi√≥n cerrada', 'success');
        });
    }

    // ==================== EXERCISES ====================
    function loadExercises() {
        db.from('ejercicios')
            .select('*')
            .eq('estado', 'publicado')
            .order('created_at', { ascending: false })
            .then(function(result) {
                if (result.error) {
                    showError('Error: ' + result.error.message);
                    return;
                }
                exercises = result.data || [];
                filteredExercises = exercises;
                populateFilters();
                updateStats();
                renderExercises();
            });
    }

    function showError(msg) {
        document.getElementById('exerciseGrid').innerHTML = '<div class="state-container"><div class="state-icon">‚ùå</div><div class="state-title">Error de conexi√≥n</div><p class="state-text">' + msg + '</p></div>';
    }

    function populateFilters() {
        var categorias = {}, entrenadores = {}, equipos = {}, idiomas = {}, edades = {}, jugadores = {};
        exercises.forEach(function(ex) {
            (ex.categorias || []).forEach(function(c) { categorias[c] = (categorias[c] || 0) + 1; });
            if (ex.entrenador) entrenadores[ex.entrenador] = (entrenadores[ex.entrenador] || 0) + 1;
            if (ex.equipo) equipos[ex.equipo] = (equipos[ex.equipo] || 0) + 1;
            if (ex.idioma) idiomas[ex.idioma] = (idiomas[ex.idioma] || 0) + 1;
            if (ex.edad) edades[ex.edad] = (edades[ex.edad] || 0) + 1;
            if (ex.jugadores) jugadores[ex.jugadores] = (jugadores[ex.jugadores] || 0) + 1;
        });
        fillSelect('filterCategoria', categorias, 'Todas');
        fillSelect('filterEntrenador', entrenadores, 'Todos');
        fillSelect('filterEquipo', equipos, 'Todos');
        fillSelectIdioma('filterIdioma', idiomas);
        fillSelect('filterEdad', edades, 'Todas');
        fillSelect('filterJugadores', jugadores, 'Todos');
    }

    function fillSelect(id, data, defaultText) {
        var select = document.getElementById(id);
        select.innerHTML = '<option value="">' + defaultText + '</option>';
        Object.keys(data).sort().forEach(function(key) {
            select.innerHTML += '<option value="' + key + '">' + key + ' (' + data[key] + ')</option>';
        });
    }

    function fillSelectIdioma(id, data) {
        var select = document.getElementById(id);
        select.innerHTML = '<option value="">Todos</option>';
        Object.keys(data).sort().forEach(function(key) {
            select.innerHTML += '<option value="' + key + '">' + (LANG_FLAGS[key] || 'üåê') + ' ' + (LANG_NAMES[key] || key) + ' (' + data[key] + ')</option>';
        });
    }

    function updateStats() {
        document.getElementById('heroTotal').textContent = exercises.length;
        var ent = {}, cat = {};
        exercises.forEach(function(ex) {
            if (ex.entrenador) ent[ex.entrenador] = true;
            (ex.categorias || []).forEach(function(c) { cat[c] = true; });
        });
        document.getElementById('heroEntrenadores').textContent = Object.keys(ent).length;
        document.getElementById('heroCategorias').textContent = Object.keys(cat).length;
    }

    function renderExercises() {
        var grid = document.getElementById('exerciseGrid');
        document.getElementById('exerciseCount').textContent = filteredExercises.length;

        if (!filteredExercises.length) {
            grid.innerHTML = '<div class="state-container"><div class="state-icon">üîç</div><div class="state-title">No hay ejercicios</div><p class="state-text">Prueba con otros filtros</p></div>';
            return;
        }

        var sourceIcons = { youtube: 'üì∫', twitter: 'ùïè', instagram: 'üì∑' };
        var html = '';
        
        filteredExercises.forEach(function(ex) {
            var cats = ex.categorias || [];
            var tagsHtml = cats.slice(0, 2).map(function(c) { return '<span class="ejercicio-tag">' + c + '</span>'; }).join('');
            var thumb = ex.thumbnail_url || 'https://via.placeholder.com/400x225/16162a/8b8ba7?text=Video';
            var langFlag = LANG_FLAGS[ex.idioma] || 'üåê';
            var sourceIcon = sourceIcons[ex.source] || 'üì∫';
            var inSession = mySession.some(function(s) { return s.id === ex.id; });
            var isFav = favorites.indexOf(ex.id) !== -1;

            html += 
                '<div class="ejercicio-card" onclick="openModal(\'' + ex.id + '\')">' +
                    '<div class="ejercicio-thumbnail">' +
                        '<img src="' + thumb + '" alt="" onerror="this.style.display=\'none\'">' +
                        (ex.dificultad ? '<div class="ejercicio-difficulty">Dif: ' + ex.dificultad + '</div>' : '') +
                        (ex.duracion ? '<div class="ejercicio-duration">' + ex.duracion + '</div>' : '') +
                        '<div class="ejercicio-lang">' + langFlag + '</div>' +
                        '<div class="ejercicio-play"></div>' +
                    '</div>' +
                    '<div class="ejercicio-body">' +
                        '<h3 class="ejercicio-title">' + ex.titulo_ejercicio + '</h3>' +
                        '<div class="ejercicio-meta"><span>' + sourceIcon + ' ' + (ex.entrenador || ex.canal || '-') + '</span></div>' +
                        '<div class="ejercicio-tags">' + tagsHtml + '</div>' +
                        '<div class="ejercicio-footer">' +
                            '<div class="ejercicio-stats">' +
                                '<span class="ejercicio-stat">üëÅÔ∏è ' + formatNumber(ex.vistas || 0) + '</span>' +
                                '<span class="ejercicio-stat">üëç ' + formatNumber(ex.likes || 0) + '</span>' +
                            '</div>' +
                            '<div class="ejercicio-actions">' +
                                '<button class="ejercicio-action' + (isFav ? ' active' : '') + '" onclick="event.stopPropagation();toggleFavoriteCard(\'' + ex.id + '\',this)">‚ù§Ô∏è</button>' +
                                '<button class="ejercicio-action' + (inSession ? ' in-session' : '') + '" onclick="event.stopPropagation();addToSession(\'' + ex.id + '\',this)">‚ûï</button>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
        });
        grid.innerHTML = html;
    }

    function formatNumber(n) {
        if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
        if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
        return n.toString();
    }

    // ==================== FILTERS ====================
    function initFilters() {
        var searchTimer;
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(applyFilters, 300);
        });

        ['filterCategoria', 'filterEntrenador', 'filterEquipo', 'filterIdioma', 'filterEdad', 'filterDuracion', 'filterJugadores', 'filterPorteros', 'filterLikes', 'filterVistas', 'filterFuente'].forEach(function(id) {
            document.getElementById(id).addEventListener('change', applyFilters);
        });

        document.querySelectorAll('.difficulty-pill').forEach(function(pill) {
            pill.onclick = function() {
                var value = this.getAttribute('data-value');
                if (selectedDificultad === value) {
                    selectedDificultad = null;
                    this.classList.remove('active');
                } else {
                    document.querySelectorAll('.difficulty-pill').forEach(function(p) { p.classList.remove('active'); });
                    selectedDificultad = value;
                    this.classList.add('active');
                }
                applyFilters();
            };
        });
    }

    function applyFilters() {
        var search = document.getElementById('searchInput').value.toLowerCase().trim();
        var categoria = document.getElementById('filterCategoria').value;
        var entrenador = document.getElementById('filterEntrenador').value;
        var equipo = document.getElementById('filterEquipo').value;
        var idioma = document.getElementById('filterIdioma').value;
        var edad = document.getElementById('filterEdad').value;
        var duracion = document.getElementById('filterDuracion').value;
        var jugadores = document.getElementById('filterJugadores').value;
        var porteros = document.getElementById('filterPorteros').value;
        var likes = document.getElementById('filterLikes').value;
        var vistas = document.getElementById('filterVistas').value;
        var fuente = document.getElementById('filterFuente').value;

        // Count active filters
        var activeCount = 0;
        if (search) activeCount++;
        if (categoria) activeCount++;
        if (selectedDificultad) activeCount++;
        if (entrenador) activeCount++;
        if (equipo) activeCount++;
        if (idioma) activeCount++;
        if (edad) activeCount++;
        if (duracion) activeCount++;
        if (jugadores) activeCount++;
        if (porteros) activeCount++;
        if (likes) activeCount++;
        if (vistas) activeCount++;
        if (fuente) activeCount++;
        
        var badge = document.getElementById('filtersBadge');
        if (activeCount > 0) {
            badge.textContent = activeCount + ' activos';
            badge.classList.add('show');
        } else {
            badge.classList.remove('show');
        }

        filteredExercises = exercises.filter(function(ex) {
            // B√∫squeda texto
            if (search) {
                var text = ((ex.titulo_ejercicio || '') + ' ' + (ex.entrenador || '') + ' ' + (ex.equipo || '') + ' ' + (ex.categorias || []).join(' ')).toLowerCase();
                if (text.indexOf(search) === -1) return false;
            }
            // Categor√≠a
            if (categoria && (!ex.categorias || ex.categorias.indexOf(categoria) === -1)) return false;
            // Dificultad
            if (selectedDificultad && ex.dificultad != selectedDificultad) return false;
            // Entrenador
            if (entrenador && ex.entrenador !== entrenador) return false;
            // Equipo
            if (equipo && ex.equipo !== equipo) return false;
            // Idioma
            if (idioma && ex.idioma !== idioma) return false;
            // Edad
            if (edad && ex.edad !== edad) return false;
            // Duraci√≥n
            if (duracion) {
                var parts = duracion.split('-');
                var dur = ex.duracion_segundos || 0;
                if (dur < parseInt(parts[0]) || dur > parseInt(parts[1])) return false;
            }
            // Jugadores
            if (jugadores && ex.jugadores !== jugadores) return false;
            // Porteros
            if (porteros) {
                var numPorteros = ex.num_porteros || 0;
                if (porteros === '3+') {
                    if (numPorteros < 3) return false;
                } else {
                    if (numPorteros != parseInt(porteros)) return false;
                }
            }
            // Likes
            if (likes) {
                var parts = likes.split('-');
                var l = ex.likes || 0;
                if (l < parseInt(parts[0]) || l > parseInt(parts[1])) return false;
            }
            // Vistas
            if (vistas) {
                var parts = vistas.split('-');
                var v = ex.vistas || 0;
                if (v < parseInt(parts[0]) || v > parseInt(parts[1])) return false;
            }
            // Fuente
            if (fuente && ex.source !== fuente) return false;
            
            return true;
        });
        renderExercises();
    }

    function clearFilters() {
        document.getElementById('searchInput').value = '';
        ['filterCategoria', 'filterEntrenador', 'filterEquipo', 'filterIdioma', 'filterEdad', 'filterDuracion', 'filterJugadores', 'filterPorteros', 'filterLikes', 'filterVistas', 'filterFuente'].forEach(function(id) {
            document.getElementById(id).value = '';
        });
        selectedDificultad = null;
        document.querySelectorAll('.difficulty-pill').forEach(function(p) { p.classList.remove('active'); });
        document.getElementById('filtersBadge').classList.remove('show');
        filteredExercises = exercises;
        renderExercises();
    }

    // ==================== MODAL ====================
    function openModal(id) {
        var ex = exercises.find(function(e) { return e.id === id; });
        if (!ex) return;
        
        // Check limits for logged in users
        if (currentUser && !canViewExercise()) {
            showUpgradeModal();
            return;
        }
        
        currentExercise = ex;
        
        // Increment view count for logged users
        if (currentUser) {
            incrementExerciseView();
        }

        var thumb = ex.thumbnail_url || 'https://img.youtube.com/vi/' + (ex.video_id || '') + '/maxresdefault.jpg';
        var platformIcon = '‚ñ∂', platformName = 'YouTube', platformColor = '#ff0000';
        if (ex.source === 'twitter') { platformIcon = 'ùïè'; platformName = 'Twitter'; platformColor = '#1da1f2'; }
        else if (ex.source === 'instagram') { platformIcon = 'üì∑'; platformName = 'Instagram'; platformColor = '#e1306c'; }
        
        var videoHtml = '<div style="position:relative;width:100%;height:100%;background:var(--dark);cursor:pointer;" onclick="window.open(\'' + ex.video_url + '\', \'_blank\')">' +
            '<img src="' + thumb + '" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display=\'none\'">' +
            '<div style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);display:flex;flex-direction:column;align-items:center;justify-content:center;">' +
                '<div style="width:80px;height:80px;background:' + platformColor + ';border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;color:white;box-shadow:0 4px 20px rgba(0,0,0,0.5);margin-bottom:16px;"><span style="margin-left:4px;">‚ñ∂</span></div>' +
                '<span style="background:rgba(0,0,0,0.7);padding:8px 20px;border-radius:20px;font-size:14px;font-weight:600;">' + platformIcon + ' Ver en ' + platformName + '</span>' +
            '</div></div>';
        
        document.getElementById('modalVideo').innerHTML = videoHtml;
        document.getElementById('modalTitle').textContent = ex.titulo_ejercicio;

        var tagsHtml = (ex.categorias || []).map(function(c) { return '<span class="modal-tag">' + c + '</span>'; }).join('');
        if (ex.dificultad) tagsHtml += '<span class="modal-tag dif">Dificultad: ' + ex.dificultad + '/5</span>';
        document.getElementById('modalTags').innerHTML = tagsHtml;

        var info = '';
        if (ex.jugadores) info += '<div class="modal-info-item"><div class="modal-info-icon">üë•</div><div class="modal-info-value">' + ex.jugadores + '</div><div class="modal-info-label">Jugadores</div></div>';
        if (ex.num_porteros) info += '<div class="modal-info-item"><div class="modal-info-icon">üß§</div><div class="modal-info-value">' + ex.num_porteros + '</div><div class="modal-info-label">Porteros</div></div>';
        if (ex.dimensiones) info += '<div class="modal-info-item"><div class="modal-info-icon">üìê</div><div class="modal-info-value">' + ex.dimensiones + '</div><div class="modal-info-label">Dimensiones</div></div>';
        if (ex.duracion) info += '<div class="modal-info-item"><div class="modal-info-icon">‚è±Ô∏è</div><div class="modal-info-value">' + ex.duracion + '</div><div class="modal-info-label">Duraci√≥n</div></div>';
        if (ex.edad) info += '<div class="modal-info-item"><div class="modal-info-icon">üë∂</div><div class="modal-info-value">' + ex.edad + '</div><div class="modal-info-label">Edad</div></div>';
        if (ex.entrenador) info += '<div class="modal-info-item"><div class="modal-info-icon">üë§</div><div class="modal-info-value">' + ex.entrenador + '</div><div class="modal-info-label">Entrenador</div></div>';
        document.getElementById('modalInfo').innerHTML = info;
        document.getElementById('modalDesc').textContent = ex.descripcion || 'Sin descripci√≥n disponible.';

        // Update buttons
        var inSession = mySession.some(function(s) { return s.id === ex.id; });
        document.getElementById('modalAddSession').innerHTML = inSession ? '‚úì En Mi Sesi√≥n' : '‚ûï A√±adir a Mi Sesi√≥n';
        
        var isFav = favorites.indexOf(ex.id) !== -1;
        document.getElementById('modalFavorite').innerHTML = isFav ? '‚ù§Ô∏è Favorito' : 'ü§ç Favorito';
        document.getElementById('modalFavorite').classList.toggle('active', isFav);

        document.getElementById('modalOverlay').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('modalOverlay').classList.remove('active');
        document.body.style.overflow = '';
        currentExercise = null;
    }

    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { closeModal(); closeAuthModal(); closeSaveModal(); } });

    // ==================== SESSION ====================
    function loadSessionFromStorage() {
        try {
            var saved = localStorage.getItem('fbt_session');
            if (saved) {
                mySession = JSON.parse(saved);
                updateSessionUI();
            }
        } catch(e) {}
    }

    function saveSessionToStorage() {
        try {
            localStorage.setItem('fbt_session', JSON.stringify(mySession));
        } catch(e) {}
    }

    function addToSession(id, btn) {
        var ex = exercises.find(function(e) { return e.id === id; });
        if (!ex) return;

        // If logged in, show session selection modal
        if (currentUser) {
            showAddToSessionModal(id);
            return;
        }

        // If not logged in, use temporary session
        var exists = mySession.some(function(s) { return s.id === id; });
        if (exists) {
            mySession = mySession.filter(function(s) { return s.id !== id; });
            if (btn) btn.classList.remove('in-session');
            showToast('Ejercicio eliminado de la sesi√≥n', 'success');
        } else {
            mySession.push({
                id: ex.id,
                titulo: ex.titulo_ejercicio,
                duracion: ex.duracion,
                duracion_seg: ex.duracion_segundos || 0,
                thumb: ex.thumbnail_url,
                video_url: ex.video_url
            });
            if (btn) btn.classList.add('in-session');
            showToast('A√±adido. Inicia sesi√≥n para guardar.', 'success');
            
            // Bounce animation
            var fab = document.getElementById('sessionFab');
            fab.classList.add('bounce');
            setTimeout(function() { fab.classList.remove('bounce'); }, 400);
        }
        
        updateSessionUI();
        saveSessionToStorage();
    }

    function addCurrentToSession() {
        if (!currentExercise) return;
        
        if (currentUser) {
            closeModal();
            showAddToSessionModal(currentExercise.id);
        } else {
            addToSession(currentExercise.id, null);
            var inSession = mySession.some(function(s) { return s.id === currentExercise.id; });
            document.getElementById('modalAddSession').innerHTML = inSession ? '‚úì En Mi Sesi√≥n' : '‚ûï A√±adir a Sesi√≥n';
        }
    }

    function removeFromSession(id) {
        mySession = mySession.filter(function(s) { return s.id !== id; });
        updateSessionUI();
        saveSessionToStorage();
        renderExercises();
    }

    function updateSessionUI() {
        var count = mySession.length;
        var totalSeg = mySession.reduce(function(sum, s) { return sum + (s.duracion_seg || 0); }, 0);
        var totalMin = Math.round(totalSeg / 60);

        document.getElementById('fabCount').textContent = count;
        document.getElementById('fabBadge').textContent = count;
        document.getElementById('sessionDuration').textContent = totalMin + ' min';
        
        var fab = document.getElementById('sessionFab');
        fab.classList.toggle('has-items', count > 0);

        var body = document.getElementById('sessionBody');
        if (count === 0) {
            body.innerHTML = '<div class="session-empty"><div class="session-empty-icon">üìã</div><div class="session-empty-text">A√±ade ejercicios desde la biblioteca<br>usando el bot√≥n ‚ûï</div></div>';
        } else {
            var html = '';
            mySession.forEach(function(s, i) {
                html += '<div class="session-item" draggable="true" data-index="' + i + '">' +
                    '<span class="session-item-drag">‚ò∞</span>' +
                    '<img class="session-item-thumb" src="' + (s.thumb || 'https://via.placeholder.com/60x40/16162a/8b8ba7') + '" onerror="this.src=\'https://via.placeholder.com/60x40/16162a/8b8ba7\'">' +
                    '<div class="session-item-info">' +
                        '<div class="session-item-title">' + s.titulo + '</div>' +
                        '<div class="session-item-meta">' + (s.duracion || '--') + '</div>' +
                    '</div>' +
                    '<button class="session-item-remove" onclick="removeFromSession(\'' + s.id + '\')">‚úï</button>' +
                '</div>';
            });
            body.innerHTML = html;
            initDragDrop();
        }
    }

    function initDragDrop() {
        var items = document.querySelectorAll('.session-item');
        items.forEach(function(item) {
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragover', handleDragOver);
            item.addEventListener('drop', handleDrop);
            item.addEventListener('dragend', handleDragEnd);
        });
    }

    var dragSrcEl = null;
    function handleDragStart(e) {
        dragSrcEl = this;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', this.dataset.index);
    }
    function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
    }
    function handleDrop(e) {
        e.preventDefault();
        if (dragSrcEl !== this) {
            var fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
            var toIndex = parseInt(this.dataset.index);
            var item = mySession.splice(fromIndex, 1)[0];
            mySession.splice(toIndex, 0, item);
            updateSessionUI();
            saveSessionToStorage();
        }
    }
    function handleDragEnd() { this.classList.remove('dragging'); }

    function toggleSessionDrawer() {
        var drawer = document.getElementById('sessionDrawer');
        var backdrop = document.getElementById('drawerBackdrop');
        drawer.classList.toggle('open');
        backdrop.classList.toggle('show');
    }

    function clearSession() {
        if (mySession.length === 0) return;
        if (confirm('¬øVaciar toda la sesi√≥n?')) {
            mySession = [];
            updateSessionUI();
            saveSessionToStorage();
            renderExercises();
            showToast('Sesi√≥n vaciada', 'success');
        }
    }

    function saveSession() {
        if (!currentUser) {
            showAuthModal('login');
            showToast('Inicia sesi√≥n para guardar', 'error');
            return;
        }
        if (mySession.length === 0) {
            showToast('A√±ade ejercicios primero', 'error');
            return;
        }
        // Set today's date by default
        document.getElementById('sessionDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('saveOverlay').classList.add('active');
    }

    function closeSaveModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('saveOverlay').classList.remove('active');
    }

    function confirmSaveSession() {
        var name = document.getElementById('sessionName').value.trim();
        if (!name) {
            showToast('Escribe un nombre para la sesi√≥n', 'error');
            return;
        }

        var totalSeg = mySession.reduce(function(sum, s) { return sum + (s.duracion_seg || 0); }, 0);

        db.from('sesiones').insert({
            usuario_id: currentUser.id,
            nombre: name,
            fecha: document.getElementById('sessionDate').value || null,
            categoria_edad: document.getElementById('sessionCategoria').value || null,
            objetivo: document.getElementById('sessionObjetivo').value.trim() || null,
            notas: document.getElementById('sessionNotas').value.trim() || null,
            ejercicios: mySession,
            duracion_total: totalSeg,
            num_ejercicios: mySession.length
        }).then(function(result) {
            if (result.error) {
                showToast('Error: ' + result.error.message, 'error');
            } else {
                closeSaveModal();
                toggleSessionDrawer();
                mySession = [];
                updateSessionUI();
                saveSessionToStorage();
                renderExercises();
                // Reset form
                document.getElementById('sessionName').value = '';
                document.getElementById('sessionDate').value = '';
                document.getElementById('sessionCategoria').value = '';
                document.getElementById('sessionObjetivo').value = '';
                document.getElementById('sessionNotas').value = '';
                showToast('¬°Sesi√≥n guardada!', 'success');
            }
        });
    }

    // ==================== ADD TO EXISTING SESSION ====================
    var exerciseToAdd = null;

    function showAddToSessionModal(exerciseId) {
        if (!currentUser) {
            showAuthModal('login');
            showToast('Inicia sesi√≥n para a√±adir a sesi√≥n', 'error');
            return;
        }
        exerciseToAdd = exercises.find(function(e) { return e.id === exerciseId; });
        if (!exerciseToAdd) return;
        
        loadSessionsForModal();
        document.getElementById('addToSessionOverlay').classList.add('active');
    }

    function closeAddToSessionModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('addToSessionOverlay').classList.remove('active');
        exerciseToAdd = null;
    }

    function loadSessionsForModal() {
        var container = document.getElementById('sessionsListModal');
        container.innerHTML = '<div class="session-list-loading">Cargando sesiones...</div>';
        
        db.from('sesiones')
            .select('*')
            .eq('usuario_id', currentUser.id)
            .order('created_at', { ascending: false })
            .limit(20)
            .then(function(result) {
                if (result.error || !result.data || result.data.length === 0) {
                    container.innerHTML = '<div class="session-list-empty"><div class="session-list-empty-icon">üìã</div><p>No tienes sesiones creadas</p></div>';
                    return;
                }
                
                var html = '';
                result.data.forEach(function(s) {
                    var dateStr = s.fecha ? new Date(s.fecha).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' }) : '';
                    html += '<div class="session-list-item" onclick="addExerciseToSession(\'' + s.id + '\')">' +
                        '<div class="session-list-item-info">' +
                            '<div class="session-list-item-name">' + s.nombre + '</div>' +
                            '<div class="session-list-item-meta">' + (dateStr ? 'üìÖ ' + dateStr + ' ‚Ä¢ ' : '') + (s.categoria_edad || '') + '</div>' +
                        '</div>' +
                        '<div class="session-list-item-count">' + (s.num_ejercicios || 0) + ' ej.</div>' +
                    '</div>';
                });
                container.innerHTML = html;
            });
    }

    function addExerciseToSession(sessionId) {
        if (!exerciseToAdd) return;
        
        db.from('sesiones').select('ejercicios, num_ejercicios, duracion_total').eq('id', sessionId).single()
            .then(function(result) {
                if (result.error) {
                    showToast('Error: ' + result.error.message, 'error');
                    return;
                }
                
                var ejercicios = result.data.ejercicios || [];
                
                // Check if already exists
                var exists = ejercicios.some(function(e) { return e.id === exerciseToAdd.id; });
                if (exists) {
                    showToast('Este ejercicio ya est√° en la sesi√≥n', 'error');
                    return;
                }
                
                // Add exercise
                ejercicios.push({
                    id: exerciseToAdd.id,
                    titulo: exerciseToAdd.titulo_ejercicio,
                    duracion: exerciseToAdd.duracion,
                    duracion_seg: exerciseToAdd.duracion_segundos || 0,
                    thumb: exerciseToAdd.thumbnail_url,
                    video_url: exerciseToAdd.video_url
                });
                
                var newDuration = (result.data.duracion_total || 0) + (exerciseToAdd.duracion_segundos || 0);
                
                db.from('sesiones').update({
                    ejercicios: ejercicios,
                    num_ejercicios: ejercicios.length,
                    duracion_total: newDuration,
                    updated_at: new Date().toISOString()
                }).eq('id', sessionId).then(function(updateResult) {
                    if (updateResult.error) {
                        showToast('Error: ' + updateResult.error.message, 'error');
                    } else {
                        closeAddToSessionModal();
                        showToast('‚úÖ A√±adido a la sesi√≥n', 'success');
                    }
                });
            });
    }

    function createNewSessionFromModal() {
        closeAddToSessionModal();
        // Add to temporary session
        if (exerciseToAdd) {
            mySession.push({
                id: exerciseToAdd.id,
                titulo: exerciseToAdd.titulo_ejercicio,
                duracion: exerciseToAdd.duracion,
                duracion_seg: exerciseToAdd.duracion_segundos || 0,
                thumb: exerciseToAdd.thumbnail_url,
                video_url: exerciseToAdd.video_url
            });
            updateSessionUI();
            saveSessionToStorage();
        }
        saveSession();
    }

    // ==================== MY SESSIONS ====================
    var userSessions = [];
    var currentViewingSession = null;

    function showMySessions() {
        if (!currentUser) {
            showAuthModal('login');
            return;
        }
        loadMySessions();
        document.getElementById('mySessionsOverlay').classList.add('active');
    }

    function closeMySessionsModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('mySessionsOverlay').classList.remove('active');
    }

    function loadMySessions() {
        var container = document.getElementById('mySessionsList');
        container.innerHTML = '<div class="session-list-loading">Cargando sesiones...</div>';
        
        db.from('sesiones')
            .select('*')
            .eq('usuario_id', currentUser.id)
            .order('fecha', { ascending: false })
            .then(function(result) {
                userSessions = result.data || [];
                
                if (userSessions.length === 0) {
                    container.innerHTML = '<div class="session-list-empty"><div class="session-list-empty-icon">üìã</div><p>No tienes sesiones creadas</p><p style="font-size:13px;margin-top:8px;">A√±ade ejercicios y gu√°rdalos en una sesi√≥n</p></div>';
                    return;
                }
                
                var html = '';
                userSessions.forEach(function(s) {
                    var dateStr = s.fecha ? new Date(s.fecha).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' }) : 'Sin fecha';
                    var thumbsHtml = '';
                    var ejercicios = s.ejercicios || [];
                    ejercicios.slice(0, 4).forEach(function(e) {
                        thumbsHtml += '<img class="my-session-card-thumb" src="' + (e.thumb || 'https://via.placeholder.com/50x32/16162a/8b8ba7') + '" onerror="this.src=\'https://via.placeholder.com/50x32/16162a/8b8ba7\'">';
                    });
                    
                    html += '<div class="my-session-card" onclick="viewSession(\'' + s.id + '\')">' +
                        '<div class="my-session-card-header">' +
                            '<div class="my-session-card-name">' + s.nombre + '</div>' +
                            '<div class="my-session-card-date">' + dateStr + '</div>' +
                        '</div>' +
                        '<div class="my-session-card-meta">' +
                            '<span>üìã ' + (s.num_ejercicios || 0) + ' ejercicios</span>' +
                            '<span>‚è±Ô∏è ' + Math.round((s.duracion_total || 0) / 60) + ' min</span>' +
                            (s.categoria_edad ? '<span>üë∂ ' + s.categoria_edad + '</span>' : '') +
                        '</div>' +
                        (s.objetivo ? '<div class="my-session-card-objetivo">üéØ ' + s.objetivo + '</div>' : '') +
                        (thumbsHtml ? '<div class="my-session-card-thumbs">' + thumbsHtml + '</div>' : '') +
                    '</div>';
                });
                container.innerHTML = html;
            });
    }

    // ==================== VIEW SESSION ====================
    function viewSession(sessionId) {
        var session = userSessions.find(function(s) { return s.id === sessionId; });
        if (!session) {
            // Load from DB if not in cache
            db.from('sesiones').select('*').eq('id', sessionId).single().then(function(result) {
                if (result.error || !result.data) {
                    showToast('Sesi√≥n no encontrada', 'error');
                    return;
                }
                renderViewSession(result.data);
            });
            return;
        }
        renderViewSession(session);
    }

    function renderViewSession(session) {
        currentViewingSession = session;
        
        document.getElementById('viewSessionTitle').textContent = session.nombre;
        
        var dateStr = session.fecha ? new Date(session.fecha).toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }) : '';
        var metaHtml = '';
        if (dateStr) metaHtml += '<span>üìÖ ' + dateStr + '</span>';
        if (session.categoria_edad) metaHtml += '<span>üë∂ ' + session.categoria_edad + '</span>';
        metaHtml += '<span>‚è±Ô∏è ' + Math.round((session.duracion_total || 0) / 60) + ' min</span>';
        metaHtml += '<span>üìã ' + (session.num_ejercicios || 0) + ' ejercicios</span>';
        document.getElementById('viewSessionMeta').innerHTML = metaHtml;
        
        document.getElementById('viewSessionObjetivo').textContent = session.objetivo ? 'üéØ ' + session.objetivo : '';
        
        var ejercicios = session.ejercicios || [];
        var exercisesHtml = '';
        ejercicios.forEach(function(e, i) {
            exercisesHtml += '<div class="view-session-exercise">' +
                '<div class="view-session-exercise-num">' + (i + 1) + '</div>' +
                '<img class="view-session-exercise-thumb" src="' + (e.thumb || 'https://via.placeholder.com/80x50/16162a/8b8ba7') + '" onerror="this.src=\'https://via.placeholder.com/80x50/16162a/8b8ba7\'">' +
                '<div class="view-session-exercise-info">' +
                    '<div class="view-session-exercise-title">' + e.titulo + '</div>' +
                    '<div class="view-session-exercise-meta">' + (e.duracion || '--') + '</div>' +
                '</div>' +
                '<a href="' + (e.video_url || '#') + '" target="_blank" class="view-session-exercise-link">‚ñ∂ Ver video</a>' +
            '</div>';
        });
        document.getElementById('viewSessionExercises').innerHTML = exercisesHtml || '<p style="color:var(--text-muted);padding:20px;text-align:center;">No hay ejercicios</p>';
        
        document.getElementById('viewSessionNotas').textContent = session.notas || '';
        
        closeMySessionsModal();
        document.getElementById('viewSessionOverlay').classList.add('active');
    }

    function closeViewSessionModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('viewSessionOverlay').classList.remove('active');
        currentViewingSession = null;
    }

    function copySessionLink() {
        if (!currentViewingSession) return;
        var link = window.location.origin + window.location.pathname + '?sesion=' + currentViewingSession.id;
        navigator.clipboard.writeText(link).then(function() {
            showToast('üîó Link copiado al portapapeles', 'success');
        }).catch(function() {
            // Fallback
            prompt('Copia este link:', link);
        });
    }

    function editCurrentSession() {
        showToast('Pr√≥ximamente: Editar sesi√≥n', 'success');
    }

    function deleteCurrentSession() {
        if (!currentViewingSession) return;
        if (!confirm('¬øEliminar esta sesi√≥n? Esta acci√≥n no se puede deshacer.')) return;
        
        db.from('sesiones').delete().eq('id', currentViewingSession.id).then(function(result) {
            if (result.error) {
                showToast('Error: ' + result.error.message, 'error');
            } else {
                closeViewSessionModal();
                showToast('Sesi√≥n eliminada', 'success');
                // Refresh list if modal is open
                if (document.getElementById('mySessionsOverlay').classList.contains('active')) {
                    loadMySessions();
                }
            }
        });
    }

    // Check URL for shared session
    function checkSharedSession() {
        var params = new URLSearchParams(window.location.search);
        var sessionId = params.get('sesion');
        if (sessionId) {
            db.from('sesiones').select('*').eq('id', sessionId).single().then(function(result) {
                if (result.data) {
                    renderViewSession(result.data);
                }
            });
        }
    }

    // ==================== FAVORITES ====================
    function loadFavorites() {
        if (!currentUser) return;
        db.from('favoritos').select('ejercicio_id').eq('usuario_id', currentUser.id)
            .then(function(result) {
                if (!result.error && result.data) {
                    favorites = result.data.map(function(f) { return f.ejercicio_id; });
                    renderExercises();
                }
            });
    }

    function toggleFavorite() {
        if (!currentUser) {
            showAuthModal('login');
            return;
        }
        if (!currentExercise) return;
        
        // Check if user can use favorites
        if (userLimits && !userLimits.puede_favoritos) {
            showUpgradeModal();
            return;
        }

        var isFav = favorites.indexOf(currentExercise.id) !== -1;
        if (isFav) {
            db.from('favoritos').delete().eq('usuario_id', currentUser.id).eq('ejercicio_id', currentExercise.id)
                .then(function() {
                    favorites = favorites.filter(function(f) { return f !== currentExercise.id; });
                    document.getElementById('modalFavorite').innerHTML = 'ü§ç Favorito';
                    renderExercises();
                    showToast('Eliminado de favoritos', 'success');
                });
        } else {
            db.from('favoritos').insert({ usuario_id: currentUser.id, ejercicio_id: currentExercise.id })
                .then(function() {
                    favorites.push(currentExercise.id);
                    document.getElementById('modalFavorite').innerHTML = '‚ù§Ô∏è Favorito';
                    renderExercises();
                    showToast('A√±adido a favoritos', 'success');
                });
        }
    }

    function toggleFavoriteCard(id, btn) {
        if (!currentUser) {
            showAuthModal('login');
            return;
        }
        
        // Check if user can use favorites
        if (userLimits && !userLimits.puede_favoritos) {
            showUpgradeModal();
            return;
        }

        var isFav = favorites.indexOf(id) !== -1;
        if (isFav) {
            db.from('favoritos').delete().eq('usuario_id', currentUser.id).eq('ejercicio_id', id)
                .then(function() {
                    favorites = favorites.filter(function(f) { return f !== id; });
                    btn.classList.remove('active');
                });
        } else {
            db.from('favoritos').insert({ usuario_id: currentUser.id, ejercicio_id: id })
                .then(function() {
                    favorites.push(id);
                    btn.classList.add('active');
                });
        }
    }

 
    // ==================== UTILS ====================
    function showToast(msg, type) {
        var toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.className = 'toast ' + type + ' show';
        setTimeout(function() { toast.classList.remove('show'); }, 3000);
    }

    function scrollToSection(id) {
        var el = document.getElementById(id);
        if (el) el.scrollIntoView({ behavior: 'smooth' });
    }

    function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

    // ==================== UPGRADE / STRIPE ====================
    function showUpgradeModal() {
        document.getElementById('upgradeOverlay').classList.add('active');
    }

    function closeUpgradeModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('upgradeOverlay').classList.remove('active');
    }

    function selectPlan(plan) {
    if (!currentUser) {
        closeUpgradeModal();
        showAuthModal('register');
        showToast('Reg√≠strate primero para mejorar tu plan', 'error');
        return;
    }
    
    showToast('Redirigiendo a pago...', 'success');
    
    db.from('perfiles').update({ 
        plan: plan,
        subscription_status: 'active'
    }).eq('id', currentUser.id).then(function(result) {
        if (!result.error) {
            if (!userProfile) userProfile = {};
            userProfile.plan = plan;
            closeUpgradeModal();
            loadPlanLimits();
            loadUserProfile();
            showToast('¬°Plan actualizado a ' + plan.toUpperCase() + '! (Demo)', 'success');
        } else {
            showToast('Error: ' + result.error.message, 'error');
        }
    });
}

    // ==================== LEADERBOARD ====================
    function showLeaderboard() {
        document.getElementById('leaderboardOverlay').classList.add('active');
        loadLeaderboard('mes');
    }

    function closeLeaderboardModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('leaderboardOverlay').classList.remove('active');
    }

    function loadLeaderboard(tipo) {
        // Update tabs
        document.querySelectorAll('.leaderboard-tab').forEach(function(tab, i) {
            tab.classList.toggle('active', (tipo === 'mes' && i === 0) || (tipo === 'total' && i === 1));
        });
        
        var container = document.getElementById('leaderboardList');
        container.innerHTML = '<div class="session-list-loading">Cargando ranking...</div>';
        
        db.from('perfiles')
            .select('id, nombre, avatar_url, xp, nivel, titulo, plan')
            .eq('perfil_publico', true)
            .order('xp', { ascending: false })
            .limit(20)
            .then(function(result) {
                if (result.error || !result.data || result.data.length === 0) {
                    container.innerHTML = '<div class="session-list-empty">No hay datos a√∫n</div>';
                    return;
                }
                
                var html = '';
                result.data.forEach(function(user, i) {
                    var rank = i + 1;
                    var rankClass = rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : '';
                    var rankIcon = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : rank;
                    var isMe = currentUser && user.id === currentUser.id;
                    var initial = (user.nombre || 'U').charAt(0).toUpperCase();
                    var planBadge = '';
                    if (user.plan === 'coach') planBadge = ' ‚úÖ';
                    else if (user.plan === 'pro') planBadge = ' ‚≠ê';
                    
                    html += '<div class="leaderboard-item' + (rank <= 3 ? ' top-3' : '') + (isMe ? ' me' : '') + '">' +
                        '<div class="leaderboard-rank ' + rankClass + '">' + rankIcon + '</div>' +
                        '<div class="leaderboard-avatar">' + initial + '</div>' +
                        '<div class="leaderboard-info">' +
                            '<div class="leaderboard-name">' + (user.nombre || 'Usuario') + planBadge + '</div>' +
                            '<div class="leaderboard-level">Nivel ' + user.nivel + ' - ' + user.titulo + '</div>' +
                        '</div>' +
                        '<div class="leaderboard-xp">' + formatNumber(user.xp) + '</div>' +
                    '</div>';
                });
                container.innerHTML = html;
            });
    }

    function showMyProfile() {
        showToast('Pr√≥ximamente: Mi Perfil', 'success');
    }

    function showFavorites() {
        if (!currentUser) {
            showAuthModal('login');
            return;
        }
        if (userLimits && !userLimits.puede_favoritos) {
            showUpgradeModal();
            return;
        }
        showToast('Pr√≥ximamente: Filtrar favoritos', 'success');
    }
 // ==================== UPLOAD EXERCISE ====================
var uploadVideoData = null;
var selectedCategories = [];
var AVAILABLE_CATEGORIES = ['Rondos', 'Posesi√≥n', 'Finalizaci√≥n', 'Pressing', 'Transiciones', 'T√°ctica', 'T√©cnica Individual', 'Porteros', 'F√≠sico', 'Calentamiento', 'Espacios Reducidos', 'Partidos Condicionados', 'Centros', 'Corners', 'Faltas', 'Pase', 'Control', 'Conducci√≥n', 'Regate', 'Defensa', 'Ataque', 'Contraataque'];
var LANG_FLAGS = { 'es': 'üá™üá∏', 'en': 'üá¨üáß', 'pt': 'üáµüáπ', 'it': 'üáÆüáπ', 'de': 'üá©üá™', 'fr': 'üá´üá∑', 'nl': 'üá≥üá±', 'other': 'üåê' };
var LANG_NAMES = { 'es': 'Espa√±ol', 'en': 'Ingl√©s', 'pt': 'Portugu√©s', 'it': 'Italiano', 'de': 'Alem√°n', 'fr': 'Franc√©s', 'nl': 'Holand√©s', 'other': 'Otro' };

// YouTube API Key (p√∫blica, solo lectura)
var YT_API_KEY = localStorage.getItem('yt_key') || '';

function showUploadModal() {
    if (!currentUser) {
        showAuthModal('register');
        showToast('Reg√≠strate para subir ejercicios', 'error');
        return;
    }
    
    if (!userProfile || userProfile.plan !== 'coach') {
        showUpgradeModal();
        showToast('Solo los usuarios Coach pueden subir ejercicios', 'error');
        return;
    }
    
    resetUploadForm();
    populateCategories();
    document.getElementById('uploadOverlay').classList.add('active');
}

function closeUploadModal(e) {
    if (e && e.target !== e.currentTarget) return;
    document.getElementById('uploadOverlay').classList.remove('active');
}

function resetUploadForm() {
    uploadVideoData = null;
    selectedCategories = [];
    document.getElementById('uploadUrl').value = '';
    document.getElementById('uploadTitulo').value = '';
    document.getElementById('uploadDificultad').value = '';
    document.getElementById('uploadEdad').value = '';
    document.getElementById('uploadJugadores').value = '';
    document.getElementById('uploadPorteros').value = '0';
    document.getElementById('uploadDimensiones').value = '';
    document.getElementById('uploadStatus').textContent = '';
    document.getElementById('uploadStatus').className = 'upload-status';
    document.getElementById('uploadExtracted').style.display = 'none';
    document.getElementById('uploadClassify').style.display = 'none';
    document.getElementById('uploadPizarraBox').classList.remove('has-image');
    document.getElementById('btnSubmitExercise').disabled = true;
}

function populateCategories() {
    var container = document.getElementById('uploadCategorias');
    container.innerHTML = AVAILABLE_CATEGORIES.map(function(cat) {
        return '<div class="category-chip" onclick="toggleCategory(this, \'' + cat + '\')">' + cat + '</div>';
    }).join('');
}

function toggleCategory(el, cat) {
    var idx = selectedCategories.indexOf(cat);
    if (idx === -1) {
        if (selectedCategories.length >= 3) {
            showToast('M√°ximo 3 categor√≠as', 'error');
            return;
        }
        selectedCategories.push(cat);
        el.classList.add('selected');
    } else {
        selectedCategories.splice(idx, 1);
        el.classList.remove('selected');
    }
    checkUploadValid();
}

function setUploadStatus(msg, type) {
    var el = document.getElementById('uploadStatus');
    el.textContent = msg;
    el.className = 'upload-status ' + type;
}

function extractVideoInfo() {
    var url = document.getElementById('uploadUrl').value.trim();
    if (!url) {
        setUploadStatus('‚ùå Introduce una URL', 'error');
        return;
    }
    
    var source = null;
    var videoId = null;
    
    // YouTube
    var ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/shorts\/)([^&\?\/]+)/);
    if (ytMatch) {
        source = 'youtube';
        videoId = ytMatch[1];
    }
    
    // Twitter/X
    if (!source && (url.includes('twitter.com') || url.includes('x.com'))) {
        source = 'twitter';
        var tMatch = url.match(/status\/(\d+)/);
        videoId = tMatch ? tMatch[1] : null;
    }
    
    // Instagram
    if (!source && url.includes('instagram.com')) {
        source = 'instagram';
        var igMatch = url.match(/\/(p|reel)\/([^\/\?]+)/);
        videoId = igMatch ? igMatch[2] : null;
    }
    
    if (!source || !videoId) {
        setUploadStatus('‚ùå URL no v√°lida. Usa YouTube, Twitter o Instagram', 'error');
        return;
    }
    
    setUploadStatus('üîÑ Extrayendo datos...', 'loading');
    
    if (source === 'youtube') {
        extractYouTubeData(url, videoId);
    } else if (source === 'twitter') {
        extractTwitterData(url, videoId);
    } else {
        extractInstagramData(url, videoId);
    }
}

function extractYouTubeData(url, videoId) {
    var apiUrl = 'https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=' + videoId + '&key=' + YT_API_KEY;
    
    fetch(apiUrl)
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.error) {
                throw new Error(data.error.message);
            }
            if (!data.items || !data.items.length) {
                throw new Error('Video no encontrado');
            }
            
            var v = data.items[0];
            var snippet = v.snippet;
            var stats = v.statistics;
            var content = v.contentDetails;
            
            // Parse duration
            var durMatch = content.duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            var h = parseInt(durMatch[1] || 0);
            var m = parseInt(durMatch[2] || 0);
            var s = parseInt(durMatch[3] || 0);
            var duracionStr = h > 0 ? h + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0') : m + ':' + String(s).padStart(2,'0');
            var duracionSeg = h * 3600 + m * 60 + s;
            
            // Detect language
            var langCode = snippet.defaultAudioLanguage || snippet.defaultLanguage || '';
            var idioma = langCode.substring(0, 2).toLowerCase();
            if (['es', 'en', 'pt', 'it', 'de', 'fr', 'nl'].indexOf(idioma) === -1) idioma = 'other';
            
            uploadVideoData = {
                url: url,
                source: 'youtube',
                video_id: videoId,
                thumbnail: 'https://img.youtube.com/vi/' + videoId + '/maxresdefault.jpg',
                titulo_video: snippet.title,
                canal: snippet.channelTitle,
                descripcion: (snippet.description || '').substring(0, 500),
                duracion: duracionStr,
                duracion_segundos: duracionSeg,
                vistas: parseInt(stats.viewCount || 0),
                likes: parseInt(stats.likeCount || 0),
                idioma: idioma
            };
            
            showExtractedData();
        })
        .catch(function(err) {
            setUploadStatus('‚ùå ' + err.message, 'error');
        });
}

function extractTwitterData(url, tweetId) {
    fetch('https://publish.twitter.com/oembed?url=' + encodeURIComponent(url))
        .then(function(res) { 
            if (!res.ok) throw new Error('No se pudo cargar el tweet');
            return res.json(); 
        })
        .then(function(data) {
            uploadVideoData = {
                url: url,
                source: 'twitter',
                video_id: tweetId,
                thumbnail: null,
                titulo_video: 'Tweet de @' + data.author_name,
                canal: data.author_name,
                descripcion: '',
                duracion: '--',
                duracion_segundos: 0,
                vistas: 0,
                likes: 0,
                idioma: 'other'
            };
            showExtractedData();
        })
        .catch(function(err) {
            setUploadStatus('‚ùå ' + err.message, 'error');
        });
}

function extractInstagramData(url, igId) {
    fetch('https://api.instagram.com/oembed?url=' + encodeURIComponent(url))
        .then(function(res) { 
            if (!res.ok) throw new Error('No se pudo cargar. ¬øEs privado?');
            return res.json(); 
        })
        .then(function(data) {
            uploadVideoData = {
                url: url,
                source: 'instagram',
                video_id: igId,
                thumbnail: data.thumbnail_url || null,
                titulo_video: data.title || 'Reel de @' + (data.author_name || 'instagram'),
                canal: data.author_name || 'Instagram',
                descripcion: '',
                duracion: '--',
                duracion_segundos: 0,
                vistas: 0,
                likes: 0,
                idioma: 'other'
            };
            showExtractedData();
        })
        .catch(function(err) {
            setUploadStatus('‚ùå ' + err.message, 'error');
        });
}

function showExtractedData() {
    var d = uploadVideoData;
    
    // Show preview
    document.getElementById('uploadThumb').src = d.thumbnail || 'https://via.placeholder.com/180x100/16162a/8b8ba7?text=' + d.source;
    document.getElementById('uploadPreviewTitle').textContent = d.titulo_video;
    document.getElementById('uploadPreviewChannel').textContent = 'üì∫ ' + d.canal;
    document.getElementById('uploadPreviewViews').textContent = 'üëÅÔ∏è ' + formatNumber(d.vistas);
    document.getElementById('uploadPreviewLikes').textContent = 'üëç ' + formatNumber(d.likes);
    document.getElementById('uploadPreviewDuration').textContent = '‚è±Ô∏è ' + d.duracion;
    document.getElementById('uploadPreviewLang').textContent = (LANG_FLAGS[d.idioma] || 'üåê') + ' ' + (LANG_NAMES[d.idioma] || 'Otro');
    document.getElementById('uploadCreditChannel').textContent = d.canal;
    
    // Show sections
    document.getElementById('uploadExtracted').style.display = 'block';
    document.getElementById('uploadClassify').style.display = 'block';
    
    setUploadStatus('‚úÖ Datos extra√≠dos correctamente', 'success');
    checkUploadValid();
}

function checkUploadValid() {
    var valid = uploadVideoData && 
                document.getElementById('uploadTitulo').value.trim() &&
                selectedCategories.length > 0 &&
                document.getElementById('uploadDificultad').value;
    document.getElementById('btnSubmitExercise').disabled = !valid;
}

// Add event listeners for validation
document.addEventListener('DOMContentLoaded', function() {
    var titleInput = document.getElementById('uploadTitulo');
    var difSelect = document.getElementById('uploadDificultad');
    if (titleInput) titleInput.addEventListener('input', checkUploadValid);
    if (difSelect) difSelect.addEventListener('change', checkUploadValid);
});

function openPizarra() {
    window.open('https://pizarra.toplidercoach.com', '_blank');
    showToast('Crea tu imagen en la pizarra y luego vuelve aqu√≠', 'success');
}

function submitExercise() {
    if (!uploadVideoData) {
        showToast('Primero extrae la informaci√≥n del video', 'error');
        return;
    }
    
    var titulo = document.getElementById('uploadTitulo').value.trim();
    if (!titulo) {
        showToast('El t√≠tulo es obligatorio', 'error');
        return;
    }
    
    var dificultad = document.getElementById('uploadDificultad').value;
    if (!dificultad) {
        showToast('Selecciona la dificultad', 'error');
        return;
    }
    
    if (selectedCategories.length === 0) {
        showToast('Selecciona al menos una categor√≠a', 'error');
        return;
    }
    
    var d = uploadVideoData;
    var exercise = {
        // Datos autom√°ticos (del video)
        video_url: d.url,
        video_id: d.video_id,
        source: d.source,
        thumbnail_url: d.thumbnail,
        titulo_video: d.titulo_video,
        canal: d.canal,
        descripcion: d.descripcion,
        duracion: d.duracion,
        duracion_segundos: d.duracion_segundos,
        vistas: d.vistas,
        likes: d.likes,
        idioma: d.idioma,
        // Datos del usuario
        titulo_ejercicio: titulo,
        categorias: selectedCategories,
        dificultad: parseInt(dificultad),
        edad: document.getElementById('uploadEdad').value || null,
        jugadores: document.getElementById('uploadJugadores').value.trim() || null,
        num_porteros: parseInt(document.getElementById('uploadPorteros').value) || 0,
        dimensiones: document.getElementById('uploadDimensiones').value || null,
        tiene_imagen_pizarra: document.getElementById('uploadPizarraBox').classList.contains('has-image'),
        // Metadatos
        subido_por: currentUser.id,
        estado: 'pendiente',
        aprobado: false
    };
    
    db.from('ejercicios').insert(exercise).then(function(result) {
        if (result.error) {
            showToast('Error: ' + result.error.message, 'error');
        } else {
            closeUploadModal();
            showToast('üéâ ¬°Ejercicio enviado! Pendiente de aprobaci√≥n', 'success');
        }
    });
}
// ==================== NOTIFICATIONS ====================
var userNotifications = [];

function loadNotifications() {
    if (!currentUser) return;
    
    db.from('notificaciones')
        .select('*')
        .eq('usuario_id', currentUser.id)
        .order('created_at', { ascending: false })
        .limit(20)
        .then(function(result) {
            if (result.error) {
                console.error('Error notificaciones:', result.error);
                return;
            }
            userNotifications = result.data || [];
            renderNotifications();
        });
}

function renderNotifications() {
    var unreadCount = userNotifications.filter(function(n) { return !n.leida; }).length;
    var badge = document.getElementById('notifBadge');
    var list = document.getElementById('notifList');
    
    if (badge) {
        badge.textContent = unreadCount;
        badge.classList.toggle('show', unreadCount > 0);
    }
    
    if (!list) return;
    
    if (userNotifications.length === 0) {
        list.innerHTML = '<div class="notif-empty"><div class="notif-empty-icon">üîî</div>No tienes notificaciones</div>';
        return;
    }
    
    var html = '';
    userNotifications.forEach(function(n) {
        var timeAgo = getTimeAgo(n.created_at);
        html += '<div class="notif-item' + (n.leida ? '' : ' unread') + '" onclick="openNotification(\'' + n.id + '\')">' +
            '<div class="notif-item-title">' + n.titulo + '</div>' +
            '<div class="notif-item-message">' + n.mensaje + '</div>' +
            '<div class="notif-item-time">' + timeAgo + '</div>' +
        '</div>';
    });
    list.innerHTML = html;
}

function toggleNotifications(e) {
    e.stopPropagation();
    var dropdown = document.getElementById('notifDropdown');
    var isOpen = dropdown.classList.contains('show');
    
    // Cerrar otros dropdowns
    document.getElementById('userDropdown')?.classList.remove('show');
    
    dropdown.classList.toggle('show');
    
    if (!isOpen) {
        loadNotifications();
    }
    
    // Cerrar al hacer clic fuera
    if (!isOpen) {
        setTimeout(function() {
            document.addEventListener('click', closeNotifDropdown);
        }, 10);
    }
}

function closeNotifDropdown() {
    document.getElementById('notifDropdown')?.classList.remove('show');
    document.removeEventListener('click', closeNotifDropdown);
}

function openNotification(id) {
    var notif = userNotifications.find(function(n) { return n.id === id; });
    if (!notif) return;
    
    // Marcar como le√≠da
    if (!notif.leida) {
        db.from('notificaciones').update({ leida: true }).eq('id', id).then(function() {
            notif.leida = true;
            renderNotifications();
        });
    }
    
    // Si es de ejercicio, podr√≠amos abrir el ejercicio
    // Por ahora solo cerramos el dropdown
    closeNotifDropdown();
    showToast(notif.titulo, 'success');
}

function markAllRead(e) {
    e.stopPropagation();
    if (!currentUser || userNotifications.length === 0) return;
    
    db.from('notificaciones')
        .update({ leida: true })
        .eq('usuario_id', currentUser.id)
        .eq('leida', false)
        .then(function() {
            userNotifications.forEach(function(n) { n.leida = true; });
            renderNotifications();
            showToast('Notificaciones marcadas como le√≠das', 'success');
        });
}

function getTimeAgo(dateString) {
    var date = new Date(dateString);
    var now = new Date();
    var diff = Math.floor((now - date) / 1000);
    
    if (diff < 60) return 'Ahora mismo';
    if (diff < 3600) return Math.floor(diff / 60) + ' min';
    if (diff < 86400) return Math.floor(diff / 3600) + ' h';
    if (diff < 604800) return Math.floor(diff / 86400) + ' d';
    return date.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
}
    </script>
 <!-- Reject Modal -->
<div class="modal-overlay" id="rejectOverlay" onclick="closeRejectModal(event)">
    <div class="modal-content reject-modal" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeRejectModal()">√ó</button>
        <h2 class="reject-title">‚ùå Rechazar Ejercicio</h2>
        <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 14px;">Selecciona el motivo del rechazo:</p>
        
        <div class="reject-reasons" id="rejectReasons">
            <div class="reject-reason" onclick="selectRejectReason(this, 'mal_etiquetado')">
                üè∑Ô∏è <strong>Mal etiquetado</strong> - Las categor√≠as o datos no son correctos
            </div>
            <div class="reject-reason" onclick="selectRejectReason(this, 'duplicado')">
                üìã <strong>Duplicado</strong> - Este ejercicio ya existe en la biblioteca
            </div>
            <div class="reject-reason" onclick="selectRejectReason(this, 'calidad')">
                üìâ <strong>Calidad insuficiente</strong> - El video no cumple los est√°ndares
            </div>
            <div class="reject-reason" onclick="selectRejectReason(this, 'pizarra_incorrecta')">
                üé® <strong>Pizarra incorrecta</strong> - Usa una pizarra que no es de TopLiderCoach
            </div>
            <div class="reject-reason" onclick="selectRejectReason(this, 'otro')">
                ‚ùì <strong>Otro motivo</strong> - Especificar abajo
            </div>
        </div>
        
        <div class="reject-custom" id="rejectCustom" style="display:none;">
            <textarea id="rejectCustomText" placeholder="Explica el motivo del rechazo..."></textarea>
        </div>
        
        <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button class="btn btn-ghost" style="flex:1;" onclick="closeRejectModal()">Cancelar</button>
            <button class="btn btn-danger" style="flex:1;" onclick="confirmReject()">‚ùå Rechazar</button>
        </div>
    </div>
</div>   
</body>
</html>
