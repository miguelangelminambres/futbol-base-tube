<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol Base TUBE - La Mayor Biblioteca de Ejercicios de FÃºtbol del Mundo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0d9f4f;
            --primary-dark: #0a7a3d;
            --primary-light: #10b85c;
            --accent: #f5c518;
            --dark: #0f0f1a;
            --dark-card: #16162a;
            --dark-border: #2a2a4a;
            --text: #ffffff;
            --text-muted: #8b8ba7;
            --danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, #0d9f4f 0%, #0a7a3d 100%);
            --gradient-hero: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0d2818 100%);
            --shadow-glow: 0 0 30px rgba(13, 159, 79, 0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--dark); color: var(--text); }
        
        /* Header */
        .header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(15, 15, 26, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--dark-border); }
        .header-inner { max-width: 1400px; margin: 0 auto; padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; cursor: pointer; }
        .logo-icon { width: 48px; height: 48px; background: var(--gradient-primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: var(--shadow-glow); }
        .logo-text { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--text); display: flex; align-items: center; gap: 6px; }
        .logo-tube { background: #ff0000; color: white; padding: 2px 8px; border-radius: 4px; font-size: 18px; font-family: 'Arial', sans-serif; font-weight: 900; font-style: italic; letter-spacing: -0.5px; }
        .nav { display: flex; align-items: center; gap: 8px; }
        .nav-link { padding: 10px 20px; color: var(--text-muted); text-decoration: none; font-weight: 500; border-radius: 8px; transition: all 0.3s; cursor: pointer; }
        .nav-link:hover, .nav-link.active { color: var(--text); background: rgba(255,255,255,0.05); }
        .nav-link.active { color: var(--primary); }
        .header-actions { display: flex; align-items: center; gap: 16px; }
        
        .btn { padding: 12px 24px; border-radius: 10px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; border: none; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .btn-ghost { background: transparent; color: var(--text); border: 2px solid var(--dark-border); }
        .btn-ghost:hover { border-color: var(--primary); color: var(--primary); }
        .btn-primary { background: var(--gradient-primary); color: white; box-shadow: 0 4px 15px rgba(13, 159, 79, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(13, 159, 79, 0.4); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }

        /* User Menu */
        .user-menu { display: flex; align-items: center; gap: 12px; padding: 8px 16px; background: var(--dark-card); border-radius: 50px; cursor: pointer; border: 1px solid var(--dark-border); position: relative; }
        .user-avatar { width: 36px; height: 36px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
        .user-name { font-weight: 500; font-size: 14px; }
        .user-dropdown { position: absolute; top: calc(100% + 8px); right: 0; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; padding: 8px; min-width: 200px; display: none; z-index: 100; }
        .user-dropdown.show { display: block; }
        .user-dropdown-header { padding: 12px 16px; border-bottom: 1px solid var(--dark-border); margin-bottom: 8px; }
        .user-dropdown-level { font-size: 14px; font-weight: 600; color: var(--primary); }
        .user-dropdown-xp { font-size: 12px; color: var(--text-muted); }
        .user-dropdown-item { padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .user-dropdown-item:hover { background: rgba(255,255,255,0.05); }
        .user-dropdown-item.danger { color: var(--danger); }
        .user-dropdown-item.upgrade { color: var(--accent); font-weight: 600; }

        /* Plan Badges */
        .plan-badge { font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 4px; margin-left: 8px; }
        .plan-badge.pro { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .plan-badge.coach { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }

        /* Header Stats */
        .user-stats-header { display: flex; align-items: center; gap: 12px; margin-right: 8px; }
        .xp-badge { background: rgba(245, 197, 24, 0.15); color: var(--accent); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .racha-badge { background: rgba(239, 68, 68, 0.15); color: #ef4444; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .limit-badge { background: rgba(139, 139, 167, 0.15); color: var(--text-muted); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .limit-badge.limit-reached { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        /* Freemium Locks */
        .filter-locked { position: relative; opacity: 0.5; pointer-events: none; }
        .filter-locked::after { content: 'ðŸ”’'; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 14px; }
        .filter-lock-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 15, 26, 0.8); display: flex; align-items: center; justify-content: center; border-radius: 10px; cursor: pointer; z-index: 5; }
        .filter-lock-text { font-size: 12px; color: var(--accent); font-weight: 600; }
        
        .card-locked { position: relative; }
        .card-locked .video-card-thumb::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 15, 26, 0.85); backdrop-filter: blur(8px); }
        .card-lock-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; padding: 20px; text-align: center; }
        .card-lock-icon { font-size: 48px; margin-bottom: 12px; }
        .card-lock-title { font-weight: 700; font-size: 16px; margin-bottom: 8px; }
        .card-lock-text { font-size: 13px; color: var(--text-muted); margin-bottom: 16px; }
        
        .btn-locked { opacity: 0.5; cursor: not-allowed; position: relative; }
        .btn-locked::after { content: 'ðŸ”’'; margin-left: 8px; }

        /* Upgrade Modal */
        .upgrade-modal { max-width: 500px; }
        .upgrade-header { text-align: center; margin-bottom: 24px; }
        .upgrade-icon { font-size: 64px; margin-bottom: 16px; }
        .upgrade-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; margin-bottom: 8px; }
        .upgrade-subtitle { color: var(--text-muted); font-size: 15px; }
        .upgrade-feature-blocked { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 24px; text-align: center; }
        .upgrade-feature-blocked-text { color: #ef4444; font-weight: 600; }
        .upgrade-plans { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }
        .upgrade-plan { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
        .upgrade-plan:hover { border-color: var(--primary); background: rgba(13, 159, 79, 0.05); }
        .upgrade-plan.recommended { border-color: var(--accent); background: rgba(245, 197, 24, 0.05); }
        .upgrade-plan-info { display: flex; align-items: center; gap: 12px; }
        .upgrade-plan-badge { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .upgrade-plan-badge.pro { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .upgrade-plan-badge.coach { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .upgrade-plan-name { font-weight: 700; font-size: 16px; }
        .upgrade-plan-features { font-size: 12px; color: var(--text-muted); }
        .upgrade-plan-price { text-align: right; }
        .upgrade-plan-price-value { font-family: 'Bebas Neue', sans-serif; font-size: 28px; color: var(--primary); }
        .upgrade-plan-price-period { font-size: 12px; color: var(--text-muted); }
        .upgrade-plan-tag { background: var(--accent); color: var(--dark); font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 4px; margin-left: 8px; }
        .upgrade-benefits { margin-bottom: 24px; }
        .upgrade-benefit { display: flex; align-items: center; gap: 10px; padding: 8px 0; font-size: 14px; }
        .upgrade-benefit-icon { color: var(--primary); }
        .upgrade-footer { text-align: center; }
        .upgrade-footer-text { font-size: 12px; color: var(--text-muted); margin-top: 12px; }

        /* XP Lost Alert */
        .xp-lost-alert { background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 197, 24, 0.1)); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 16px; padding: 24px; margin-bottom: 20px; text-align: center; }
        .xp-lost-icon { font-size: 48px; margin-bottom: 12px; }
        .xp-lost-title { font-size: 18px; font-weight: 700; color: #ef4444; margin-bottom: 8px; }
        .xp-lost-amount { font-family: 'Bebas Neue', sans-serif; font-size: 36px; color: #ef4444; }
        .xp-lost-text { color: var(--text-muted); font-size: 14px; margin: 12px 0; }
        .xp-could-have { background: rgba(13, 159, 79, 0.1); border-radius: 8px; padding: 12px; margin-top: 16px; }
        .xp-could-have-text { font-size: 13px; color: var(--text-muted); }
        .xp-could-have-amount { color: var(--primary); font-weight: 700; }

        /* Hero */
        .hero { min-height: 90vh; background: var(--gradient-hero); display: flex; align-items: center; justify-content: center; text-align: center; padding: 140px 24px 80px; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%230d9f4f' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); opacity: 0.5; }
        .hero-content { max-width: 900px; position: relative; z-index: 1; }
        .hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 10px 24px; background: rgba(13, 159, 79, 0.15); border: 1px solid rgba(13, 159, 79, 0.3); border-radius: 50px; font-size: 14px; color: var(--primary-light); margin-bottom: 32px; font-weight: 600; }
        .hero-title-main { font-family: 'Bebas Neue', sans-serif; font-size: clamp(42px, 7vw, 68px); line-height: 1.1; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 16px; }
        .tube-logo { display: inline-flex; align-items: center; background: #ff0000; padding: 4px 16px; border-radius: 8px; margin-left: 8px; }
        .tube-text { font-family: 'Roboto', 'Arial', sans-serif; font-weight: 900; font-style: italic; color: white; letter-spacing: -1px; }
        .hero-tagline { font-family: 'Bebas Neue', sans-serif; font-size: clamp(18px, 3vw, 26px); color: var(--accent); letter-spacing: 2px; margin-bottom: 20px; }
        .hero-desc { font-size: 18px; color: var(--text-muted); margin-bottom: 32px; max-width: 650px; margin-left: auto; margin-right: auto; line-height: 1.7; }
        .hero-desc strong { color: var(--text); }
        .hero-features { display: flex; justify-content: center; gap: 32px; margin-bottom: 40px; flex-wrap: wrap; }
        .hero-feature { display: flex; align-items: center; gap: 8px; font-size: 15px; color: var(--text); }
        .hero-feature-icon { font-size: 20px; }
        .hero-buttons { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-bottom: 48px; }
        .btn-lg { padding: 16px 32px; font-size: 16px; }
        .hero-stats { display: flex; justify-content: center; gap: 48px; padding-top: 40px; border-top: 1px solid var(--dark-border); flex-wrap: wrap; }
        .hero-stat { text-align: center; }
        .hero-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 42px; color: var(--primary); }
        .hero-stat-label { font-size: 14px; color: var(--text-muted); }
        .hero-cta-text { margin-top: 32px; font-size: 15px; color: var(--text-muted); }
        .hero-cta-text a { color: var(--primary); text-decoration: none; font-weight: 600; }

        /* Biblioteca */
        .biblioteca { max-width: 1400px; margin: 0 auto; padding: 40px 24px; display: grid; grid-template-columns: 280px 1fr; gap: 32px; }
        
        /* Sidebar */
        .filters-sidebar { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 20px; padding: 24px; height: fit-content; position: sticky; top: 105px; max-height: calc(100vh - 130px); overflow-y: auto; }
        .filters-sidebar::-webkit-scrollbar { width: 6px; }
        .filters-sidebar::-webkit-scrollbar-track { background: transparent; }
        .filters-sidebar::-webkit-scrollbar-thumb { background: var(--dark-border); border-radius: 3px; }
        .filters-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--dark-border); }
        .filters-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .filters-badge { background: var(--primary); color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px; display: none; }
        .filters-badge.show { display: inline-block; }
        .filters-clear { color: var(--primary); font-size: 13px; cursor: pointer; }
        .filter-group { margin-bottom: 20px; }
        .filter-label { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; display: block; }
        .filter-select { width: 100%; padding: 12px 16px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; cursor: pointer; }
        .filter-select:focus { outline: none; border-color: var(--primary); }
        .difficulty-pills { display: flex; gap: 8px; }
        .difficulty-pill { flex: 1; padding: 10px; text-align: center; background: var(--dark); border: 2px solid transparent; border-radius: 10px; cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 600; color: var(--text-muted); }
        .difficulty-pill:hover { background: rgba(255,255,255,0.06); color: var(--text); }
        .difficulty-pill.active { border-color: var(--primary); background: rgba(13, 159, 79, 0.15); color: var(--primary); }

        /* Main */
        .biblioteca-main { display: flex; flex-direction: column; gap: 24px; }
        .biblioteca-header { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px; }
        .biblioteca-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; }
        .biblioteca-count { color: var(--text-muted); font-size: 14px; }
        .biblioteca-search { display: flex; align-items: center; gap: 12px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; padding: 12px 20px; width: 320px; }
        .biblioteca-search input { flex: 1; background: none; border: none; color: var(--text); font-size: 14px; outline: none; }
        .biblioteca-search input::placeholder { color: var(--text-muted); }

        /* Cards */
        .ejercicios-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }
        .ejercicio-card { background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 20px; overflow: hidden; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; }
        .ejercicio-card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: var(--shadow-glow); }
        .ejercicio-thumbnail { position: relative; aspect-ratio: 16/9; overflow: hidden; background: var(--dark); }
        .ejercicio-thumbnail img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s; }
        .ejercicio-card:hover .ejercicio-thumbnail img { transform: scale(1.05); }
        .ejercicio-duration { position: absolute; bottom: 12px; right: 12px; background: rgba(0,0,0,0.85); padding: 4px 10px; border-radius: 6px; font-size: 13px; font-weight: 600; }
        .ejercicio-difficulty { position: absolute; top: 12px; left: 12px; background: var(--accent); color: var(--dark); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        .ejercicio-familia { position: absolute; bottom: 12px; left: 12px; background: var(--primary); color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; }
        .ejercicio-lang { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.85); padding: 4px 8px; border-radius: 6px; font-size: 14px; }
        .ejercicio-play { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 4px 20px rgba(13, 159, 79, 0.5); }
        .ejercicio-play::after { content: ''; border-left: 16px solid white; border-top: 10px solid transparent; border-bottom: 10px solid transparent; margin-left: 4px; }
        .ejercicio-card:hover .ejercicio-play { transform: translate(-50%, -50%) scale(1); }
        .ejercicio-body { padding: 20px; }
        .ejercicio-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .ejercicio-meta { display: flex; align-items: center; gap: 8px; color: var(--text-muted); font-size: 13px; margin-bottom: 12px; }
        .ejercicio-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .ejercicio-tag { padding: 4px 12px; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .ejercicio-footer { display: flex; align-items: center; justify-content: space-between; padding-top: 16px; border-top: 1px solid var(--dark-border); }
        .ejercicio-stats { display: flex; gap: 16px; font-size: 13px; color: var(--text-muted); }
        .ejercicio-stat { display: flex; align-items: center; gap: 4px; }
        .ejercicio-actions { display: flex; gap: 8px; }
        .ejercicio-action { width: 36px; height: 36px; background: rgba(255,255,255,0.05); border: none; border-radius: 8px; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 14px; }
        .ejercicio-action:hover { background: var(--primary); color: white; }
        .ejercicio-action.active { background: var(--danger); color: white; }
        .ejercicio-action.in-session { background: var(--primary); color: white; }

        /* States */
        .state-container { grid-column: 1 / -1; text-align: center; padding: 80px 40px; }
        .state-icon { font-size: 64px; margin-bottom: 16px; }
        .state-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
        .state-text { color: var(--text-muted); }
        .loading-spinner { width: 48px; height: 48px; border: 3px solid var(--dark-border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 24px; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--dark-card); border-radius: 24px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 16px; right: 16px; width: 44px; height: 44px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; color: white; font-size: 24px; cursor: pointer; z-index: 10; }
        .modal-close:hover { background: rgba(255,255,255,0.2); }
        .modal-video { aspect-ratio: 16/9; background: #0a0a15; border-radius: 12px; overflow: hidden; position: relative; }
        .modal-video iframe { width: 100%; height: 100%; border: none; }
        .modal-thumb-link { display: block; width: 100%; height: 100%; position: relative; }
        .modal-thumb-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s, filter 0.3s; }
        .modal-thumb-link:hover .modal-thumb-img { transform: scale(1.02); filter: brightness(0.8); }
        .modal-play-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; background: rgba(255, 0, 0, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; transition: transform 0.3s, background 0.3s; }
        .modal-thumb-link:hover .modal-play-btn { transform: translate(-50%, -50%) scale(1.1); background: #ff0000; }
        .modal-video-stats { display: flex; align-items: center; gap: 16px; padding: 12px 0; flex-wrap: wrap; }
        .modal-stat { display: flex; align-items: center; gap: 6px; font-size: 14px; color: var(--text-muted); }
        .modal-stat:first-child { color: var(--text); font-weight: 600; }
        .modal-body { padding: 24px; }
        .modal-title { font-size: 24px; font-weight: 700; margin-bottom: 16px; }
        .modal-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
        .modal-tag { padding: 6px 16px; background: rgba(139, 92, 246, 0.15); color: #a78bfa; border-radius: 20px; font-size: 13px; }
        .modal-tag.dif { background: rgba(245, 197, 24, 0.15); color: var(--accent); }
        .modal-info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .modal-info-item { background: rgba(255,255,255,0.03); padding: 16px; border-radius: 12px; text-align: center; }
        .modal-info-icon { font-size: 24px; margin-bottom: 8px; }
        .modal-info-value { font-weight: 700; font-size: 16px; margin-bottom: 4px; }
        .modal-info-label { font-size: 12px; color: var(--text-muted); }
        .modal-description { color: var(--text-muted); line-height: 1.7; margin-bottom: 24px; }
        .modal-footer { display: flex; gap: 12px; flex-wrap: wrap; }
        .modal-footer .btn { flex: 1; min-width: 150px; justify-content: center; }

        /* Auth Modal */
        .auth-modal { max-width: 420px; padding: 40px; }
        .auth-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; text-align: center; margin-bottom: 8px; }
        .auth-subtitle { color: var(--text-muted); text-align: center; margin-bottom: 32px; }
        .auth-tabs { display: flex; gap: 8px; margin-bottom: 24px; }
        .auth-tab { flex: 1; padding: 12px; text-align: center; background: var(--dark); border: 2px solid transparent; border-radius: 10px; cursor: pointer; font-weight: 600; color: var(--text-muted); transition: all 0.2s; }
        .auth-tab.active { border-color: var(--primary); color: var(--primary); background: rgba(13, 159, 79, 0.1); }
        .auth-form { display: flex; flex-direction: column; gap: 16px; }
        .auth-input { width: 100%; padding: 14px 18px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; color: var(--text); font-size: 14px; }
        .auth-input:focus { outline: none; border-color: var(--primary); }
        .auth-input::placeholder { color: var(--text-muted); }
        .auth-error { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 12px 16px; border-radius: 10px; font-size: 13px; display: none; }
        .auth-error.show { display: block; }

        /* Session FAB and Drawer */
        .session-fab { position: fixed; bottom: 32px; right: 32px; z-index: 1500; display: flex; align-items: center; gap: 12px; padding: 16px 24px; background: rgba(22, 22, 42, 0.85); backdrop-filter: blur(20px); border: 1px solid var(--dark-border); border-radius: 50px; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
        .session-fab:hover { transform: translateY(-4px); border-color: var(--primary); box-shadow: 0 12px 40px rgba(13, 159, 79, 0.3); }
        .session-fab.has-items { border-color: var(--primary); }
        .session-fab-icon { width: 44px; height: 44px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .session-fab-content { display: flex; flex-direction: column; }
        .session-fab-title { font-weight: 600; font-size: 14px; }
        .session-fab-count { font-size: 12px; color: var(--text-muted); }
        .session-fab-badge { position: absolute; top: -8px; right: -8px; width: 28px; height: 28px; background: var(--danger); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; border: 3px solid var(--dark); display: none; }
        .session-fab.has-items .session-fab-badge { display: flex; }
        
        .session-drawer { position: fixed; top: 0; right: -420px; width: 400px; max-width: 100%; height: 100vh; background: var(--dark-card); border-left: 1px solid var(--dark-border); z-index: 2500; display: flex; flex-direction: column; transition: right 0.4s cubic-bezier(0.22, 1, 0.36, 1); }
        .session-drawer.open { right: 0; }
        .session-drawer-backdrop { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 2400; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .session-drawer-backdrop.show { opacity: 1; visibility: visible; }
        .session-drawer-header { padding: 24px; border-bottom: 1px solid var(--dark-border); display: flex; align-items: center; justify-content: space-between; }
        .session-drawer-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .session-drawer-close { width: 40px; height: 40px; background: var(--dark); border: none; border-radius: 10px; color: var(--text-muted); cursor: pointer; font-size: 20px; }
        .session-drawer-body { flex: 1; overflow-y: auto; padding: 16px; }
        .session-empty { text-align: center; padding: 60px 20px; color: var(--text-muted); }
        .session-empty-icon { font-size: 48px; margin-bottom: 12px; }
        .session-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 12px; margin-bottom: 12px; cursor: grab; transition: all 0.2s; }
        .session-item:hover { border-color: var(--primary); }
        .session-item-thumb { width: 60px; height: 40px; border-radius: 6px; object-fit: cover; background: var(--dark-border); }
        .session-item-info { flex: 1; min-width: 0; }
        .session-item-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .session-item-meta { font-size: 11px; color: var(--text-muted); }
        .session-item-remove { width: 28px; height: 28px; background: none; border: none; color: var(--text-muted); cursor: pointer; border-radius: 6px; display: flex; align-items: center; justify-content: center; }
        .session-item-remove:hover { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .session-drawer-footer { padding: 20px; border-top: 1px solid var(--dark-border); background: var(--dark); }
        .session-stats { display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 14px; }
        .session-stats span { color: var(--text-muted); }
        .session-stats strong { color: var(--primary); }
        .session-actions { display: flex; gap: 12px; }
        .session-actions .btn { flex: 1; justify-content: center; }

        /* Save/View Session Modals */
        .save-modal { max-width: 450px; padding: 32px; }
        .save-modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 20px; }
        .save-modal .auth-input { margin-bottom: 16px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .sessions-list { max-height: 250px; overflow-y: auto; margin-bottom: 16px; }
        .session-list-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .session-list-item:hover { border-color: var(--primary); }
        .session-list-item-info { flex: 1; }
        .session-list-item-name { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
        .session-list-item-meta { font-size: 12px; color: var(--text-muted); }
        .session-list-item-count { background: var(--primary); color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .session-divider { text-align: center; color: var(--text-muted); font-size: 13px; margin: 20px 0; position: relative; }
        .session-divider::before, .session-divider::after { content: ''; position: absolute; top: 50%; width: 35%; height: 1px; background: var(--dark-border); }
        .session-divider::before { left: 0; }
        .session-divider::after { right: 0; }

        .view-session-modal { max-width: 600px; padding: 0; }
        .view-session-header { padding: 24px 24px 16px; border-bottom: 1px solid var(--dark-border); }
        .view-session-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 8px; }
        .view-session-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px; color: var(--text-muted); }
        .view-session-objetivo { padding: 16px 24px; background: rgba(13, 159, 79, 0.1); border-left: 4px solid var(--primary); font-size: 14px; }
        .view-session-objetivo:empty { display: none; }
        .view-session-exercises { padding: 16px 24px; }
        .view-session-exercise { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--dark); border-radius: 12px; margin-bottom: 10px; }
        .view-session-exercise-num { width: 28px; height: 28px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; flex-shrink: 0; }
        .view-session-exercise-thumb { width: 80px; height: 50px; border-radius: 8px; object-fit: cover; background: var(--dark-border); flex-shrink: 0; }
        .view-session-exercise-info { flex: 1; min-width: 0; }
        .view-session-exercise-title { font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
        .view-session-exercise-meta { font-size: 12px; color: var(--text-muted); }
        .view-session-footer { padding: 16px 24px; border-top: 1px solid var(--dark-border); display: flex; gap: 12px; flex-wrap: wrap; }
        .view-session-footer .btn { flex: 1; min-width: 100px; justify-content: center; }

        .my-sessions-modal { max-width: 550px; padding: 24px; max-height: 80vh; display: flex; flex-direction: column; }
        .my-sessions-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .my-session-card { background: var(--dark); border: 1px solid var(--dark-border); border-radius: 14px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
        .my-session-card:hover { border-color: var(--primary); transform: translateX(4px); }
        .my-session-card-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px; }
        .my-session-card-name { font-weight: 700; font-size: 16px; }
        .my-session-card-date { font-size: 12px; color: var(--text-muted); background: var(--dark-card); padding: 4px 10px; border-radius: 6px; }
        .my-session-card-meta { display: flex; gap: 16px; font-size: 13px; color: var(--text-muted); }

        /* Notifications */
        .notif-bell { position: relative; cursor: pointer; padding: 8px; margin-right: 8px; }
        .notif-badge { position: absolute; top: 2px; right: 2px; min-width: 18px; height: 18px; background: var(--danger); border-radius: 50%; font-size: 11px; font-weight: 700; display: none; align-items: center; justify-content: center; }
        .notif-badge.show { display: flex; }
        .notif-dropdown { position: absolute; top: calc(100% + 8px); right: 0; width: 320px; max-height: 400px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 16px; display: none; z-index: 1000; overflow: hidden; }
        .notif-dropdown.show { display: block; }
        .notif-header { padding: 16px; border-bottom: 1px solid var(--dark-border); display: flex; align-items: center; justify-content: space-between; }
        .notif-header-title { font-weight: 700; font-size: 15px; }
        .notif-header-action { font-size: 12px; color: var(--primary); cursor: pointer; }
        .notif-list { max-height: 320px; overflow-y: auto; }
        .notif-item { padding: 14px 16px; border-bottom: 1px solid var(--dark-border); cursor: pointer; transition: background 0.2s; }
        .notif-item:hover { background: rgba(255,255,255,0.03); }
        .notif-item.unread { background: rgba(13, 159, 79, 0.05); border-left: 3px solid var(--primary); }
        .notif-item-title { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
        .notif-item-message { font-size: 12px; color: var(--text-muted); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .notif-item-time { font-size: 11px; color: var(--text-muted); margin-top: 6px; }
        .notif-empty { padding: 40px 20px; text-align: center; color: var(--text-muted); }

        /* Upload Modal - Clean Version */
        .upload-modal { max-width: 650px; padding: 0; max-height: 90vh; display: flex; flex-direction: column; }
        .upload-header { padding: 24px; border-bottom: 1px solid var(--dark-border); }
        .upload-header h2 { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 4px; }
        .upload-header p { color: var(--text-muted); font-size: 14px; }
        .upload-body { padding: 24px; overflow-y: auto; flex: 1; }
        .upload-section { margin-bottom: 28px; }
        .upload-section-title { font-size: 14px; font-weight: 700; color: var(--primary); margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
        .upload-section-title .upload-hint { font-weight: 400; color: var(--text-muted); font-size: 12px; }
        .upload-bonus { color: var(--accent); font-weight: 600; font-size: 12px; }

        /* Source Tabs */
        .upload-source-tabs { display: flex; gap: 12px; margin-bottom: 16px; }
        .upload-source-tab { flex: 1; padding: 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 12px; color: var(--text-muted); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .upload-source-tab:hover { border-color: var(--text-muted); }
        .upload-source-tab.active { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); color: var(--primary); }

        /* URL Input */
        .upload-url-input { display: flex; gap: 12px; }
        .upload-url-input input { flex: 1; }
        .upload-status { margin-top: 10px; font-size: 13px; min-height: 20px; }
        .upload-status.loading { color: var(--accent); }
        .upload-status.success { color: var(--primary); }
        .upload-status.error { color: var(--danger); }

        /* Image Upload */
        .upload-image-drop { border: 2px dashed var(--dark-border); border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; transition: all 0.3s; background: var(--dark); }
        .upload-image-drop:hover { border-color: var(--primary); background: rgba(13, 159, 79, 0.05); }
        .upload-image-drop.dragover { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); }
        .upload-image-placeholder { display: flex; flex-direction: column; align-items: center; gap: 8px; color: var(--text-muted); }
        .upload-image-icon { font-size: 40px; }
        .upload-image-hint { font-size: 12px; opacity: 0.7; }
        .upload-image-preview { max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: contain; }

        /* Extracted Preview */
        .upload-preview { display: flex; gap: 16px; background: var(--dark); border-radius: 12px; padding: 16px; }
        .upload-preview-thumb { width: 160px; height: 90px; border-radius: 8px; object-fit: cover; background: var(--dark-border); flex-shrink: 0; }
        .upload-preview-info { flex: 1; display: flex; flex-direction: column; justify-content: center; min-width: 0; }
        .upload-preview-title { font-weight: 700; font-size: 13px; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .upload-preview-channel { font-size: 12px; color: var(--primary); margin-bottom: 8px; }
        .upload-preview-stats { display: flex; flex-wrap: wrap; gap: 10px; font-size: 11px; color: var(--text-muted); }

        /* Credit Notice */
        .upload-credit-notice { display: flex; align-items: center; gap: 10px; background: rgba(13, 159, 79, 0.1); border: 1px solid rgba(13, 159, 79, 0.3); border-radius: 10px; padding: 12px 16px; margin-top: 16px; font-size: 12px; color: var(--primary); }
        .upload-credit-notice strong { color: var(--text); }

        /* Familia Grid */
        .upload-familia-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .upload-familia-option { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 20px 16px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 14px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .upload-familia-option:hover { border-color: var(--text-muted); transform: translateY(-2px); }
        .upload-familia-option.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.1); }
        .upload-familia-icon { font-size: 28px; }
        .upload-familia-name { font-size: 13px; font-weight: 600; }
        .upload-familia-extra { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--dark-border); }

        /* Temas Grid */
        .upload-temas-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .upload-tema-chip { padding: 8px 14px; background: var(--dark); border: 2px solid var(--dark-border); border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
        .upload-tema-chip:hover { border-color: var(--text-muted); }
        .upload-tema-chip.selected { border-color: var(--primary); background: rgba(13, 159, 79, 0.15); color: var(--primary); }

        /* Form Fields */
        .upload-field { margin-bottom: 16px; }
        .upload-field label { display: block; font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 8px; }
        .upload-field input, .upload-field select, .upload-field textarea { width: 100%; padding: 12px 14px; background: var(--dark); border: 1px solid var(--dark-border); border-radius: 10px; color: var(--text); font-size: 14px; font-family: inherit; }
        .upload-field input:focus, .upload-field select:focus, .upload-field textarea:focus { outline: none; border-color: var(--primary); }
        .upload-field textarea { resize: vertical; min-height: 80px; }
        .upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .upload-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

        /* Pizarra */
        .upload-pizarra { background: linear-gradient(135deg, rgba(245, 197, 24, 0.1) 0%, rgba(245, 197, 24, 0.05) 100%); border: 2px dashed var(--accent); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upload-pizarra:hover { background: rgba(245, 197, 24, 0.15); transform: translateY(-2px); }
        .upload-pizarra.has-image { border-style: solid; border-color: var(--primary); }
        .upload-pizarra-icon { font-size: 32px; margin-bottom: 8px; }
        .upload-pizarra-text { font-size: 14px; color: var(--accent); font-weight: 600; }
        .upload-pizarra-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

        /* XP Bonus */
        .upload-xp-bonus { background: rgba(245, 197, 24, 0.1); padding: 14px 18px; border-radius: 12px; font-size: 14px; color: var(--accent); display: flex; align-items: center; gap: 10px; margin-top: 16px; }
        .upload-xp-bonus strong { color: var(--text); }

        /* Word Count */
        .upload-word-count { margin-top: 8px; font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 8px; }
        .upload-word-count.valid { color: var(--primary); }
        .upload-word-count.valid #wordCountStatus { color: var(--primary); }

        /* Pizarra Preview */
        .upload-pizarra-preview { max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: contain; }

        /* Upload Footer */
        .upload-footer { padding: 20px 24px; border-top: 1px solid var(--dark-border); display: flex; gap: 12px; }
        .upload-footer .btn { flex: 1; justify-content: center; }
        .upload-footer .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Toast */
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); padding: 14px 24px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 12px; font-size: 14px; z-index: 3000; opacity: 0; transition: all 0.3s; display: flex; align-items: center; gap: 10px; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { border-color: var(--primary); }
        .toast.error { border-color: var(--danger); }

        /* Footer */
        .footer { background: var(--dark-card); border-top: 1px solid var(--dark-border); padding: 40px 24px; text-align: center; margin-top: 60px; }
        .footer-text { color: var(--text-muted); font-size: 14px; }

        /* Responsive */
        @media (max-width: 1024px) { 
            .biblioteca { grid-template-columns: 1fr; } 
            .filters-sidebar { position: static; max-height: none; } 
        }

        @media (max-width: 768px) { 
            .header-inner { padding: 12px 16px; }
            .nav { display: none; } 
            .logo-text { font-size: 16px; }
            .logo-tube { font-size: 12px; padding: 2px 6px; }
            .logo-icon { width: 40px; height: 40px; font-size: 20px; }
            .notif-dropdown { width: 280px; right: -60px; }
            .user-stats-header { gap: 6px; margin-right: 4px; }
            .xp-badge, .racha-badge, .limit-badge { padding: 4px 8px; font-size: 10px; }
            .user-menu { padding: 6px 10px; gap: 8px; }
            .user-avatar { width: 32px; height: 32px; font-size: 12px; }
            .user-name { display: none; }
            .hero { padding: 100px 16px 60px; min-height: auto; }
            .hero-title-main { font-size: 32px; flex-direction: column; gap: 8px; }
            .hero-features { flex-direction: column; gap: 12px; }
            .hero-buttons { flex-direction: column; gap: 12px; }
            .btn-lg { padding: 14px 24px; font-size: 14px; width: 100%; justify-content: center; }
            .biblioteca { padding: 24px 16px; gap: 20px; }
            .biblioteca-header { flex-direction: column; align-items: stretch; }
            .biblioteca-search { width: 100%; }
            .ejercicios-grid { grid-template-columns: 1fr; }
            .session-fab { right: 16px; bottom: 16px; padding: 12px 16px; }
            .session-fab-content { display: none; }
            .session-drawer { width: 100%; right: -100%; }
            .modal-overlay { padding: 16px; }
            .modal-content { border-radius: 20px; max-height: 85vh; }
            .upload-modal { max-width: 100%; max-height: 100vh; border-radius: 0; }
            .upload-header { padding: 16px; }
            .upload-header h2 { font-size: 22px; }
            .upload-body { padding: 16px; }
            .upload-source-tabs { flex-direction: column; }
            .upload-preview { flex-direction: column; }
            .upload-preview-thumb { width: 100%; height: 140px; }
            .upload-familia-grid { grid-template-columns: 1fr; }
            .upload-grid { grid-template-columns: 1fr; }
            .upload-grid-3 { grid-template-columns: 1fr 1fr; }
            .upload-url-input { flex-direction: column; }
            .upload-footer { padding: 16px; flex-direction: column; }
            .form-row { grid-template-columns: 1fr; }
            .footer { padding: 24px 16px; margin-top: 40px; }
            .toast { bottom: 80px; max-width: calc(100% - 32px); }
        }

        /* ==================== GAMIFICACIÃ“N ==================== */
        
        /* Perfil Modal */
        .profile-modal { max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none; }
        .profile-modal::-webkit-scrollbar { display: none; }
        .profile-header { display: flex; gap: 24px; padding-bottom: 24px; border-bottom: 1px solid var(--dark-border); margin-bottom: 24px; }
        .profile-avatar-large { width: 100px; height: 100px; border-radius: 20px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-size: 42px; font-weight: 700; position: relative; }
        .profile-avatar-level { position: absolute; bottom: -8px; right: -8px; width: 36px; height: 36px; background: var(--dark-card); border: 3px solid var(--dark); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .profile-info { flex: 1; }
        .profile-name { font-family: 'Bebas Neue', sans-serif; font-size: 32px; display: flex; align-items: center; gap: 12px; }
        .profile-title { font-size: 16px; color: var(--text-muted); margin-top: 4px; }
        .profile-stats-row { display: flex; gap: 24px; margin-top: 16px; }
        .profile-stat-item { text-align: center; }
        .profile-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 28px; color: var(--primary); }
        .profile-stat-label { font-size: 12px; color: var(--text-muted); }
        
        /* XP Progress */
        .xp-section { margin-bottom: 24px; }
        .xp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .xp-level-info { display: flex; align-items: center; gap: 12px; }
        .xp-level-badge { font-size: 32px; }
        .xp-level-text { font-size: 18px; font-weight: 700; }
        .xp-level-title { font-size: 14px; color: var(--text-muted); }
        .xp-next-level { text-align: right; font-size: 13px; color: var(--text-muted); }
        .xp-next-level strong { color: var(--accent); }
        .xp-progress-bar { height: 12px; background: var(--dark); border-radius: 6px; overflow: hidden; position: relative; }
        .xp-progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%); border-radius: 6px; transition: width 0.5s ease; }
        .xp-progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 10px; font-weight: 700; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
        
        /* XP por mes (caducidad) */
        .xp-months { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px; }
        .xp-month-card { background: var(--dark); border-radius: 12px; padding: 16px; text-align: center; }
        .xp-month-card.expiring { border: 2px solid var(--danger); }
        .xp-month-name { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
        .xp-month-value { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--primary); }
        .xp-month-expiry { font-size: 10px; color: var(--danger); margin-top: 4px; }
        
        /* Racha */
        .racha-section { background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 197, 24, 0.1)); border-radius: 16px; padding: 20px; margin-bottom: 24px; display: flex; align-items: center; gap: 20px; }
        .racha-icon { font-size: 48px; }
        .racha-info { flex: 1; }
        .racha-title { font-size: 14px; color: var(--text-muted); }
        .racha-value { font-family: 'Bebas Neue', sans-serif; font-size: 36px; color: var(--accent); }
        .racha-max { font-size: 12px; color: var(--text-muted); }
        .racha-bonus { background: var(--accent); color: var(--dark); padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        
        /* Badges Grid */
        .badges-section { margin-bottom: 24px; }
        .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 20px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; }
        .badge-item { background: var(--dark); border-radius: 12px; padding: 16px 12px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative; }
        .badge-item:hover { background: rgba(255,255,255,0.05); transform: translateY(-2px); }
        .badge-item.locked { opacity: 0.3; }
        .badge-item.rare { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2)); border: 1px solid rgba(139, 92, 246, 0.3); }
        .badge-icon { font-size: 32px; margin-bottom: 8px; }
        .badge-name { font-size: 11px; color: var(--text-muted); line-height: 1.3; }
        .badge-new { position: absolute; top: -4px; right: -4px; width: 12px; height: 12px; background: var(--danger); border-radius: 50%; }
        
        /* Ranking */
        .ranking-section { margin-bottom: 24px; }
        .ranking-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .ranking-tabs { display: flex; gap: 8px; }
        .ranking-tab { padding: 8px 16px; background: var(--dark); border-radius: 8px; font-size: 13px; cursor: pointer; }
        .ranking-tab.active { background: var(--primary); color: white; }
        .ranking-list { background: var(--dark); border-radius: 12px; overflow: hidden; }
        .ranking-item { display: flex; align-items: center; gap: 16px; padding: 16px; border-bottom: 1px solid var(--dark-border); }
        .ranking-item:last-child { border-bottom: none; }
        .ranking-item.me { background: rgba(13, 159, 79, 0.1); }
        .ranking-position { width: 32px; font-family: 'Bebas Neue', sans-serif; font-size: 20px; text-align: center; }
        .ranking-position.gold { color: #ffd700; }
        .ranking-position.silver { color: #c0c0c0; }
        .ranking-position.bronze { color: #cd7f32; }
        .ranking-avatar { width: 40px; height: 40px; border-radius: 10px; background: var(--dark-card); display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .ranking-info { flex: 1; }
        .ranking-name { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .ranking-title { font-size: 12px; color: var(--text-muted); }
        .ranking-xp { font-family: 'Bebas Neue', sans-serif; font-size: 20px; color: var(--accent); }
        
        /* Liga Badge */
        .liga-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .liga-badge.elite { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .liga-badge.diamante { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .liga-badge.oro { background: rgba(255, 215, 0, 0.2); color: #ffd700; }
        .liga-badge.plata { background: rgba(192, 192, 192, 0.2); color: #c0c0c0; }
        .liga-badge.bronce { background: rgba(205, 127, 50, 0.2); color: #cd7f32; }
        
        /* Challenges */
        .challenges-section { margin-bottom: 24px; }
        .challenge-card { background: var(--dark); border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .challenge-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .challenge-icon { font-size: 24px; }
        .challenge-info { flex: 1; }
        .challenge-title { font-weight: 600; font-size: 14px; }
        .challenge-desc { font-size: 12px; color: var(--text-muted); }
        .challenge-reward { background: var(--accent); color: var(--dark); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .challenge-progress { height: 8px; background: var(--dark-card); border-radius: 4px; overflow: hidden; }
        .challenge-progress-fill { height: 100%; background: var(--primary); transition: width 0.3s; }
        .challenge-progress-text { display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: var(--text-muted); }
        .challenge-completed { background: rgba(13, 159, 79, 0.1); border: 1px solid var(--primary); }
        .challenge-completed .challenge-icon::after { content: 'âœ“'; position: absolute; }
        
        /* Beneficios por nivel */
        .benefits-section { margin-bottom: 24px; }
        .benefit-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--dark-border); }
        .benefit-item:last-child { border-bottom: none; }
        .benefit-icon { font-size: 20px; width: 32px; text-align: center; }
        .benefit-text { flex: 1; font-size: 14px; }
        .benefit-status { font-size: 12px; font-weight: 600; }
        .benefit-status.unlocked { color: var(--primary); }
        .benefit-status.locked { color: var(--text-muted); }
        
        /* Warning de baja */
        .cancel-warning { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 20px; margin-top: 24px; }
        .cancel-warning-title { color: var(--danger); font-weight: 700; font-size: 16px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .cancel-warning-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; }
        .cancel-warning-xp { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--danger); margin: 12px 0; }
        
        /* Recompensas */
        .rewards-section { margin-bottom: 24px; }
        .reward-card { background: linear-gradient(135deg, rgba(245, 197, 24, 0.1), rgba(13, 159, 79, 0.1)); border: 1px solid rgba(245, 197, 24, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 16px; }
        .reward-icon { font-size: 32px; }
        .reward-info { flex: 1; }
        .reward-title { font-weight: 600; }
        .reward-desc { font-size: 12px; color: var(--text-muted); }
        .reward-expiry { font-size: 11px; color: var(--accent); margin-top: 4px; }
        .reward-btn { background: var(--accent); color: var(--dark); padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 13px; cursor: pointer; border: none; }

        /* Evento XP Doble */
        .evento-banner { background: linear-gradient(90deg, #8b5cf6, #3b82f6, #0d9f4f); padding: 12px 24px; text-align: center; position: relative; overflow: hidden; }
        .evento-banner::before { content: ''; position: absolute; top: 0; left: -100%; width: 200%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: shine 2s infinite; }
        @keyframes shine { to { left: 100%; } }
        .evento-text { font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .evento-badge { background: white; color: #8b5cf6; padding: 4px 12px; border-radius: 20px; font-size: 12px; }

        /* SecciÃ³n Comunidad/GamificaciÃ³n Home */
        .comunidad-section { background: linear-gradient(180deg, var(--dark) 0%, rgba(13, 159, 79, 0.05) 50%, var(--dark) 100%); padding: 60px 24px; }
        .comunidad-inner { max-width: 1200px; margin: 0 auto; }
        .comunidad-header { text-align: center; margin-bottom: 40px; }
        .comunidad-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(245, 197, 24, 0.1); border: 1px solid rgba(245, 197, 24, 0.3); padding: 8px 20px; border-radius: 30px; font-size: 14px; color: var(--accent); margin-bottom: 16px; }
        .comunidad-title { font-family: 'Bebas Neue', sans-serif; font-size: 42px; margin-bottom: 12px; }
        .comunidad-title span { color: var(--primary); }
        .comunidad-subtitle { font-size: 16px; color: var(--text-muted); max-width: 600px; margin: 0 auto; }
        
        .comunidad-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; margin-bottom: 32px; }
        
        /* Ranking Card */
        .ranking-card { background: var(--dark-card); border-radius: 20px; padding: 24px; border: 1px solid var(--dark-border); }
        .ranking-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .ranking-card-title { font-family: 'Bebas Neue', sans-serif; font-size: 20px; display: flex; align-items: center; gap: 8px; }
        .ranking-card-link { font-size: 13px; color: var(--primary); cursor: pointer; }
        .ranking-mini-list { display: flex; flex-direction: column; gap: 12px; }
        .ranking-mini-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: var(--dark); border-radius: 12px; transition: all 0.2s; }
        .ranking-mini-item:hover { background: rgba(255,255,255,0.05); }
        .ranking-mini-pos { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .ranking-mini-pos.gold { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; }
        .ranking-mini-pos.silver { background: linear-gradient(135deg, #e8e8e8, #c0c0c0); color: #000; }
        .ranking-mini-pos.bronze { background: linear-gradient(135deg, #cd7f32, #8b4513); color: #fff; }
        .ranking-mini-pos.normal { background: var(--dark-border); color: var(--text-muted); }
        .ranking-mini-avatar { width: 36px; height: 36px; border-radius: 10px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
        .ranking-mini-info { flex: 1; }
        .ranking-mini-name { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 6px; }
        .ranking-mini-level { font-size: 11px; color: var(--text-muted); }
        .ranking-mini-xp { font-family: 'Bebas Neue', sans-serif; font-size: 18px; color: var(--accent); }
        
        /* Challenge Card */
        .challenge-home-card { background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1)); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 20px; padding: 24px; position: relative; overflow: hidden; }
        .challenge-home-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%); }
        .challenge-home-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; position: relative; }
        .challenge-home-icon { font-size: 36px; }
        .challenge-home-title { font-family: 'Bebas Neue', sans-serif; font-size: 20px; }
        .challenge-home-desc { font-size: 14px; color: var(--text-muted); margin-bottom: 16px; position: relative; }
        .challenge-home-reward { display: inline-flex; align-items: center; gap: 6px; background: var(--accent); color: var(--dark); padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 14px; margin-bottom: 16px; position: relative; }
        .challenge-home-progress { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; position: relative; }
        .challenge-home-progress-fill { height: 100%; background: linear-gradient(90deg, #8b5cf6, #3b82f6); border-radius: 4px; }
        .challenge-home-footer { display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: var(--text-muted); position: relative; }
        
        /* Badges Preview Card */
        .badges-home-card { background: var(--dark-card); border-radius: 20px; padding: 24px; border: 1px solid var(--dark-border); }
        .badges-home-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .badges-home-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .badge-home-item { background: var(--dark); border-radius: 12px; padding: 16px 8px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .badge-home-item:hover { background: rgba(255,255,255,0.05); transform: translateY(-2px); }
        .badge-home-item.rare { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2)); border: 1px solid rgba(139, 92, 246, 0.3); }
        .badge-home-icon { font-size: 28px; margin-bottom: 6px; }
        .badge-home-name { font-size: 10px; color: var(--text-muted); line-height: 1.2; }
        
        /* CTA GamificaciÃ³n */
        .comunidad-cta { text-align: center; padding: 32px; background: linear-gradient(135deg, rgba(13, 159, 79, 0.1), rgba(245, 197, 24, 0.1)); border-radius: 20px; border: 1px solid rgba(13, 159, 79, 0.2); }
        .comunidad-cta-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; margin-bottom: 8px; }
        .comunidad-cta-text { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }
        .comunidad-cta-buttons { display: flex; justify-content: center; gap: 16px; }
        
        /* Ligas mini */
        .ligas-preview { display: flex; justify-content: center; gap: 8px; margin-top: 16px; }
        .liga-mini { display: flex; align-items: center; gap: 4px; padding: 6px 12px; border-radius: 20px; font-size: 12px; opacity: 0.7; }
        .liga-mini.active { opacity: 1; box-shadow: 0 0 10px currentColor; }
        .liga-mini.bronce { background: rgba(205, 127, 50, 0.2); color: #cd7f32; }
        .liga-mini.plata { background: rgba(192, 192, 192, 0.2); color: #c0c0c0; }
        .liga-mini.oro { background: rgba(255, 215, 0, 0.2); color: #ffd700; }
        .liga-mini.diamante { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .liga-mini.elite { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }

        @media (max-width: 900px) {
            .comunidad-grid { grid-template-columns: 1fr; }
            .badges-home-grid { grid-template-columns: repeat(4, 1fr); }
        }

        /* ==================== ONBOARDING ==================== */
        .onboarding-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .onboarding-overlay.active { display: flex; opacity: 1; }
        
        .onboarding-modal { background: var(--dark-card); border-radius: 24px; max-width: 600px; width: 95%; max-height: 90vh; overflow: hidden; position: relative; border: 1px solid var(--dark-border); }
        
        .onboarding-progress { display: flex; gap: 6px; padding: 20px 24px 0; }
        .onboarding-progress-dot { flex: 1; height: 4px; background: var(--dark-border); border-radius: 2px; transition: background 0.3s; }
        .onboarding-progress-dot.active { background: var(--primary); }
        .onboarding-progress-dot.completed { background: var(--primary); }
        
        .onboarding-slide { display: none; padding: 32px 24px; text-align: center; animation: slideIn 0.4s ease; }
        .onboarding-slide.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        
        .onboarding-icon { font-size: 72px; margin-bottom: 24px; display: block; }
        .onboarding-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; margin-bottom: 12px; line-height: 1.1; }
        .onboarding-title span { color: var(--primary); }
        .onboarding-text { font-size: 16px; color: var(--text-muted); line-height: 1.6; margin-bottom: 24px; }
        
        .onboarding-features { display: flex; flex-direction: column; gap: 12px; text-align: left; margin: 24px 0; }
        .onboarding-feature { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--dark); border-radius: 12px; }
        .onboarding-feature-icon { font-size: 24px; width: 40px; text-align: center; }
        .onboarding-feature-text { flex: 1; }
        .onboarding-feature-title { font-weight: 600; font-size: 14px; }
        .onboarding-feature-desc { font-size: 12px; color: var(--text-muted); }
        
        .onboarding-levels { display: flex; justify-content: center; gap: 8px; margin: 20px 0; flex-wrap: wrap; }
        .onboarding-level { display: flex; flex-direction: column; align-items: center; padding: 12px 16px; background: var(--dark); border-radius: 12px; min-width: 70px; }
        .onboarding-level-icon { font-size: 24px; margin-bottom: 4px; }
        .onboarding-level-name { font-size: 10px; color: var(--text-muted); }
        .onboarding-level.highlighted { background: linear-gradient(135deg, rgba(13, 159, 79, 0.2), rgba(245, 197, 24, 0.2)); border: 1px solid var(--primary); }
        
        .onboarding-xp-example { background: var(--dark); border-radius: 16px; padding: 20px; margin: 20px 0; }
        .onboarding-xp-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--dark-border); }
        .onboarding-xp-row:last-child { border-bottom: none; }
        .onboarding-xp-action { font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .onboarding-xp-points { font-family: 'Bebas Neue', sans-serif; font-size: 20px; color: var(--primary); }
        
        .onboarding-badges-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 20px 0; }
        .onboarding-badge { background: var(--dark); border-radius: 12px; padding: 12px 8px; text-align: center; }
        .onboarding-badge.rare { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2)); }
        .onboarding-badge-icon { font-size: 28px; }
        .onboarding-badge-name { font-size: 10px; color: var(--text-muted); margin-top: 4px; }
        
        .onboarding-warning { background: rgba(245, 197, 24, 0.1); border: 1px solid rgba(245, 197, 24, 0.3); border-radius: 12px; padding: 16px; margin: 20px 0; text-align: left; }
        .onboarding-warning-title { font-weight: 700; color: var(--accent); display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .onboarding-warning-text { font-size: 13px; color: var(--text-muted); }
        
        .onboarding-footer { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-top: 1px solid var(--dark-border); }
        .onboarding-skip { background: none; border: none; color: var(--text-muted); font-size: 14px; cursor: pointer; }
        .onboarding-skip:hover { color: var(--text); }
        .onboarding-nav { display: flex; gap: 12px; }
        .onboarding-btn { padding: 12px 24px; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; border: none; transition: all 0.2s; }
        .onboarding-btn-back { background: var(--dark); color: var(--text); }
        .onboarding-btn-next { background: var(--gradient-primary); color: white; }
        .onboarding-btn-next:hover { transform: translateY(-2px); }
        .onboarding-btn-start { background: linear-gradient(135deg, #f5c518, #ff9500); color: #000; font-size: 16px; padding: 14px 32px; }
        
        /* Help Button flotante */
        .help-button { position: fixed; bottom: 100px; right: 24px; width: 50px; height: 50px; background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; z-index: 100; transition: all 0.3s; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .help-button:hover { background: var(--primary); border-color: var(--primary); transform: scale(1.1); }

        /* ==================== SECCIÃ“N CREADORES ==================== */
        .creadores-section { background: linear-gradient(180deg, var(--dark) 0%, rgba(255, 0, 0, 0.03) 50%, var(--dark) 100%); padding: 80px 24px; }
        .creadores-inner { max-width: 1100px; margin: 0 auto; }
        
        .creadores-header { text-align: center; margin-bottom: 48px; }
        .creadores-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3); padding: 8px 20px; border-radius: 30px; font-size: 14px; color: #ff4444; margin-bottom: 16px; }
        .creadores-title { font-family: 'Bebas Neue', sans-serif; font-size: 42px; margin-bottom: 16px; line-height: 1.1; }
        .creadores-title span { color: #ff0000; }
        .creadores-subtitle { font-size: 18px; color: var(--text-muted); max-width: 700px; margin: 0 auto; line-height: 1.6; }
        
        .creadores-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 48px; align-items: center; margin-bottom: 48px; }
        
        .creadores-benefits { display: flex; flex-direction: column; gap: 20px; }
        .creador-benefit { display: flex; gap: 16px; padding: 20px; background: var(--dark-card); border-radius: 16px; border: 1px solid var(--dark-border); transition: all 0.3s; }
        .creador-benefit:hover { border-color: var(--primary); transform: translateX(8px); }
        .creador-benefit-icon { width: 56px; height: 56px; background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 100, 100, 0.1)); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; }
        .creador-benefit-content { flex: 1; }
        .creador-benefit-title { font-weight: 700; font-size: 16px; margin-bottom: 6px; }
        .creador-benefit-text { font-size: 14px; color: var(--text-muted); line-height: 1.5; }
        
        .creadores-visual { background: var(--dark-card); border-radius: 24px; padding: 32px; border: 1px solid var(--dark-border); }
        .creadores-flow { display: flex; flex-direction: column; gap: 16px; }
        .creadores-flow-item { display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--dark); border-radius: 12px; }
        .creadores-flow-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .creadores-flow-icon.youtube { background: linear-gradient(135deg, #ff0000, #cc0000); }
        .creadores-flow-icon.tube { background: var(--gradient-primary); }
        .creadores-flow-icon.users { background: linear-gradient(135deg, #3b82f6, #8b5cf6); }
        .creadores-flow-text { flex: 1; }
        .creadores-flow-title { font-weight: 600; font-size: 14px; }
        .creadores-flow-desc { font-size: 12px; color: var(--text-muted); }
        .creadores-flow-arrow { font-size: 24px; color: var(--primary); text-align: center; }
        
        .creadores-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--dark-border); }
        .creador-stat { text-align: center; }
        .creador-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 28px; color: var(--primary); }
        .creador-stat-label { font-size: 11px; color: var(--text-muted); }
        
        .creadores-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 48px; }
        .comparison-card { background: var(--dark-card); border-radius: 20px; padding: 28px; border: 1px solid var(--dark-border); }
        .comparison-card.highlight { background: linear-gradient(135deg, rgba(13, 159, 79, 0.1), rgba(245, 197, 24, 0.05)); border-color: var(--primary); }
        .comparison-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .comparison-icon { font-size: 32px; }
        .comparison-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; }
        .comparison-list { display: flex; flex-direction: column; gap: 12px; }
        .comparison-item { display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .comparison-item.yes { color: var(--primary); }
        .comparison-item.no { color: var(--text-muted); }
        
        .creadores-cta { text-align: center; padding: 40px; background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(13, 159, 79, 0.1)); border-radius: 24px; border: 1px solid rgba(255, 0, 0, 0.2); }
        .creadores-cta-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; margin-bottom: 12px; }
        .creadores-cta-text { font-size: 16px; color: var(--text-muted); margin-bottom: 24px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .creadores-cta-buttons { display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; }
        .btn-youtube { background: #ff0000; color: white; }
        .btn-youtube:hover { background: #cc0000; }
        
        .creadores-quote { text-align: center; margin-top: 48px; padding: 32px; background: var(--dark-card); border-radius: 20px; border-left: 4px solid var(--primary); }
        .creadores-quote-text { font-size: 20px; font-style: italic; color: var(--text); margin-bottom: 16px; line-height: 1.5; }
        .creadores-quote-author { font-size: 14px; color: var(--text-muted); }

        @media (max-width: 900px) {
            .creadores-grid { grid-template-columns: 1fr; }
            .creadores-comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <div class="logo" onclick="scrollToTop()">
                <div class="logo-icon">âš½</div>
                <div class="logo-text">FUTBOL BASE <span class="logo-tube">TUBE</span></div>
            </div>
            <nav class="nav">
                <span class="nav-link active" onclick="scrollToSection('hero')">Inicio</span>
                <span class="nav-link" onclick="scrollToSection('biblioteca')">Biblioteca</span>
                <span class="nav-link" onclick="scrollToSection('creadores')">Creadores</span>
                <span class="nav-link" onclick="showMySessions()">Mis Sesiones</span>
                <span class="nav-link">Planes</span>
            </nav>
            <div class="header-actions" id="headerActions">
                <button class="btn btn-ghost" onclick="showAuthModal('login')">Entrar</button>
                <button class="btn btn-primary" onclick="showAuthModal('register')">ðŸš€ Registrarse</button>
            </div>
        </div>
    </header>

    <section class="hero" id="hero">
        <div class="hero-content">
            <div class="hero-badge">ðŸŒ La comunidad #1 de entrenadores de fÃºtbol</div>
            <h1 class="hero-title-main">
                FUTBOL BASE <span class="tube-logo"><span class="tube-text">TUBE</span></span>
            </h1>
            <p class="hero-tagline">LA MAYOR BIBLIOTECA DE EJERCICIOS DE FÃšTBOL DEL PLANETA</p>
            <p class="hero-desc">Miles de videos de entrenamiento <strong>filtrados, organizados y etiquetados</strong> por una comunidad de entrenadores como tÃº. Encuentra el ejercicio perfecto en segundos, no en horas.</p>
            
            <div class="hero-features">
                <div class="hero-feature"><span class="hero-feature-icon">ðŸ”</span><span>+12 filtros avanzados</span></div>
                <div class="hero-feature"><span class="hero-feature-icon">ðŸ‘¥</span><span>Creado por entrenadores reales</span></div>
                <div class="hero-feature"><span class="hero-feature-icon">ðŸ†“</span><span>100% contenido gratuito</span></div>
            </div>
            
            <div class="hero-buttons">
                <button class="btn btn-primary btn-lg" onclick="scrollToSection('biblioteca')">ðŸŽ¬ Explorar Ejercicios</button>
                <button class="btn btn-ghost btn-lg" id="btnUploadHero" onclick="showUploadModal()">ðŸ“¤ Subir Ejercicio</button>
            </div>
            
            <div class="hero-stats">
                <div class="hero-stat"><div class="hero-stat-value" id="heroTotal">0</div><div class="hero-stat-label">Ejercicios</div></div>
                <div class="hero-stat"><div class="hero-stat-value" id="heroEntrenadores">0</div><div class="hero-stat-label">Entrenadores</div></div>
                <div class="hero-stat"><div class="hero-stat-value" id="heroCategorias">0</div><div class="hero-stat-label">CategorÃ­as</div></div>
                <div class="hero-stat"><div class="hero-stat-value" id="heroUsuarios">+2K</div><div class="hero-stat-label">Usuarios</div></div>
            </div>
            
            <p class="hero-cta-text">Â¿Tienes un video de entrenamiento? <a href="#" onclick="showAuthModal('register')">CompÃ¡rtelo con la comunidad â†’</a></p>
        </div>
    </section>

    <!-- SecciÃ³n Comunidad / GamificaciÃ³n -->
    <section class="comunidad-section" id="comunidad">
        <div class="comunidad-inner">
            <div class="comunidad-header">
                <div class="comunidad-badge">ðŸ† Compite y gana premios reales</div>
                <h2 class="comunidad-title">Ãšnete a la <span>Comunidad #1</span> de Entrenadores</h2>
                <p class="comunidad-subtitle">Sube ejercicios, gana XP, sube de nivel y compite por descuentos y premios cada mes</p>
            </div>
            
            <div class="comunidad-grid">
                <!-- Ranking Mensual -->
                <div class="ranking-card">
                    <div class="ranking-card-header">
                        <div class="ranking-card-title">ðŸ† Top Entrenadores</div>
                        <span class="ranking-card-link" onclick="currentUser ? showProfileModal() : showAuthModal('register')">Ver ranking â†’</span>
                    </div>
                    <div class="ranking-mini-list" id="homeRankingList">
                        <div class="ranking-mini-item">
                            <div class="ranking-mini-pos gold">1</div>
                            <div class="ranking-mini-avatar">?</div>
                            <div class="ranking-mini-info">
                                <div class="ranking-mini-name">Cargando...</div>
                                <div class="ranking-mini-level">-</div>
                            </div>
                            <div class="ranking-mini-xp">- XP</div>
                        </div>
                    </div>
                    <div class="ligas-preview">
                        <div class="liga-mini bronce">ðŸ¥‰ Bronce</div>
                        <div class="liga-mini plata">ðŸ¥ˆ Plata</div>
                        <div class="liga-mini oro">ðŸ¥‡ Oro</div>
                        <div class="liga-mini diamante">ðŸ’Ž Diamante</div>
                        <div class="liga-mini elite">ðŸ‘‘ Ã‰lite</div>
                    </div>
                </div>
                
                <!-- Challenge de la Semana -->
                <div class="challenge-home-card">
                    <div class="challenge-home-header">
                        <div class="challenge-home-icon" id="homeChallengeIcon">ðŸŽ¯</div>
                        <div>
                            <div class="challenge-home-title" id="homeChallengeTitle">Challenge de la Semana</div>
                        </div>
                    </div>
                    <p class="challenge-home-desc" id="homeChallengeDesc">Sube ejercicios y completa el reto semanal para ganar XP extra</p>
                    <div class="challenge-home-reward" id="homeChallengeReward">ðŸŽ +200 XP Bonus</div>
                    <div class="challenge-home-progress">
                        <div class="challenge-home-progress-fill" id="homeChallengeProgress" style="width: 0%"></div>
                    </div>
                    <div class="challenge-home-footer">
                        <span id="homeChallengeCount">0 / 3 completados</span>
                        <span id="homeChallengeDays">7 dÃ­as restantes</span>
                    </div>
                </div>
                
                <!-- Badges Preview -->
                <div class="badges-home-card">
                    <div class="badges-home-header">
                        <div class="ranking-card-title">ðŸ… Badges</div>
                        <span class="ranking-card-link" onclick="currentUser ? showProfileModal() : showAuthModal('register')">Ver todos â†’</span>
                    </div>
                    <div class="badges-home-grid" id="homeBadgesGrid">
                        <div class="badge-home-item"><div class="badge-home-icon">ðŸ†</div><div class="badge-home-name">Primer Ejercicio</div></div>
                        <div class="badge-home-item"><div class="badge-home-icon">ðŸ”¥</div><div class="badge-home-name">En Racha</div></div>
                        <div class="badge-home-item rare"><div class="badge-home-icon">âš¡</div><div class="badge-home-name">Imparable</div></div>
                        <div class="badge-home-item"><div class="badge-home-icon">â¤ï¸</div><div class="badge-home-name">Popular</div></div>
                        <div class="badge-home-item"><div class="badge-home-icon">ðŸ“š</div><div class="badge-home-name">Bibliotecario</div></div>
                        <div class="badge-home-item rare"><div class="badge-home-icon">ðŸŽ¨</div><div class="badge-home-name">Artista TÃ¡ctico</div></div>
                        <div class="badge-home-item rare"><div class="badge-home-icon">ðŸ‘‘</div><div class="badge-home-name">Leyenda</div></div>
                        <div class="badge-home-item"><div class="badge-home-icon">ðŸŒŸ</div><div class="badge-home-name">Top Mensual</div></div>
                    </div>
                </div>
            </div>
            
            <!-- CTA -->
            <div class="comunidad-cta">
                <h3 class="comunidad-cta-title">ðŸš€ Â¿Listo para competir?</h3>
                <p class="comunidad-cta-text">RegÃ­strate gratis, sube tu primer ejercicio y empieza a ganar XP. El Top 3 mensual gana hasta 50% de descuento.</p>
                <div class="comunidad-cta-buttons">
                    <button class="btn btn-primary" onclick="showAuthModal('register')">ðŸŽ® Empezar a Competir</button>
                    <button class="btn btn-ghost" onclick="scrollToSection('planes')">Ver Planes</button>
                </div>
            </div>
        </div>
    </section>

    <!-- SecciÃ³n Para Creadores de Contenido -->
    <section class="creadores-section" id="creadores">
        <div class="creadores-inner">
            <div class="creadores-header">
                <div class="creadores-badge">ðŸ“º Para Creadores de YouTube, Twitter e Instagram</div>
                <h2 class="creadores-title">Democratizamos el <span>FÃºtbol</span></h2>
                <p class="creadores-subtitle">No somos tu competencia, somos tu aliado. Te ayudamos a llegar a miles de entrenadores que buscan contenido de calidad como el tuyo.</p>
            </div>
            
            <div class="creadores-grid">
                <div class="creadores-benefits">
                    <div class="creador-benefit">
                        <div class="creador-benefit-icon">ðŸ‘€</div>
                        <div class="creador-benefit-content">
                            <div class="creador-benefit-title">MÃ¡s visibilidad para tu canal</div>
                            <div class="creador-benefit-text">Tus videos se muestran a una audiencia cualificada: entrenadores de fÃºtbol que buscan exactamente lo que tÃº creas.</div>
                        </div>
                    </div>
                    <div class="creador-benefit">
                        <div class="creador-benefit-icon">ðŸ’°</div>
                        <div class="creador-benefit-content">
                            <div class="creador-benefit-title">TÃº monetizas, nosotros no</div>
                            <div class="creador-benefit-text">Cada visita va directa a YouTube/Twitter. Tus anuncios, tus ingresos. No nos quedamos con nada de tus visualizaciones.</div>
                        </div>
                    </div>
                    <div class="creador-benefit">
                        <div class="creador-benefit-icon">ðŸŽ¯</div>
                        <div class="creador-benefit-content">
                            <div class="creador-benefit-title">Audiencia segmentada</div>
                            <div class="creador-benefit-text">No son views aleatorios. Son entrenadores reales buscando ejercicios por categorÃ­a, edad, dificultad... tu pÃºblico ideal.</div>
                        </div>
                    </div>
                    <div class="creador-benefit">
                        <div class="creador-benefit-icon">ðŸ”—</div>
                        <div class="creador-benefit-content">
                            <div class="creador-benefit-title">Enlace directo a tu canal</div>
                            <div class="creador-benefit-text">Tu nombre, tu canal y tu marca siempre visibles. Generamos suscriptores para ti, no para nosotros.</div>
                        </div>
                    </div>
                </div>
                
                <div class="creadores-visual">
                    <div class="creadores-flow">
                        <div class="creadores-flow-item">
                            <div class="creadores-flow-icon youtube">â–¶</div>
                            <div class="creadores-flow-text">
                                <div class="creadores-flow-title">Tu video en YouTube</div>
                                <div class="creadores-flow-desc">El contenido original permanece en tu canal</div>
                            </div>
                        </div>
                        <div class="creadores-flow-arrow">â†“</div>
                        <div class="creadores-flow-item">
                            <div class="creadores-flow-icon tube">âš½</div>
                            <div class="creadores-flow-text">
                                <div class="creadores-flow-title">Lo organizamos y etiquetamos</div>
                                <div class="creadores-flow-desc">CategorÃ­a, dificultad, edad, entrenador...</div>
                            </div>
                        </div>
                        <div class="creadores-flow-arrow">â†“</div>
                        <div class="creadores-flow-item">
                            <div class="creadores-flow-icon users">ðŸ‘¥</div>
                            <div class="creadores-flow-text">
                                <div class="creadores-flow-title">Miles de entrenadores lo descubren</div>
                                <div class="creadores-flow-desc">Y van a TU canal a ver el video completo</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="creadores-stats">
                        <div class="creador-stat">
                            <div class="creador-stat-value">+2K</div>
                            <div class="creador-stat-label">Entrenadores activos</div>
                        </div>
                        <div class="creador-stat">
                            <div class="creador-stat-value">100%</div>
                            <div class="creador-stat-label">TrÃ¡fico a tu canal</div>
                        </div>
                        <div class="creador-stat">
                            <div class="creador-stat-value">0â‚¬</div>
                            <div class="creador-stat-label">Te cuesta a ti</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Comparativa -->
            <div class="creadores-comparison">
                <div class="comparison-card">
                    <div class="comparison-header">
                        <div class="comparison-icon">âŒ</div>
                        <div class="comparison-title">Lo que NO hacemos</div>
                    </div>
                    <div class="comparison-list">
                        <div class="comparison-item no">âŒ NO resubimos tu contenido</div>
                        <div class="comparison-item no">âŒ NO nos quedamos con tus ingresos</div>
                        <div class="comparison-item no">âŒ NO ocultamos tu marca o canal</div>
                        <div class="comparison-item no">âŒ NO competimos contigo por views</div>
                        <div class="comparison-item no">âŒ NO monetizamos con publicidad</div>
                    </div>
                </div>
                <div class="comparison-card highlight">
                    <div class="comparison-header">
                        <div class="comparison-icon">âœ…</div>
                        <div class="comparison-title">Lo que SÃ hacemos</div>
                    </div>
                    <div class="comparison-list">
                        <div class="comparison-item yes">âœ… Organizamos y etiquetamos tu contenido</div>
                        <div class="comparison-item yes">âœ… Te conectamos con tu pÃºblico ideal</div>
                        <div class="comparison-item yes">âœ… Mostramos tu nombre y canal siempre</div>
                        <div class="comparison-item yes">âœ… Enviamos trÃ¡fico cualificado a YouTube</div>
                        <div class="comparison-item yes">âœ… Monetizamos solo herramientas (filtros, pizarra)</div>
                    </div>
                </div>
            </div>
            
            <!-- CTA para creadores -->
            <div class="creadores-cta">
                <h3 class="creadores-cta-title">ðŸš€ Â¿Tienes un canal de fÃºtbol?</h3>
                <p class="creadores-cta-text">Sube tus videos a nuestra plataforma y deja que miles de entrenadores descubran tu contenido. Es gratis y tÃº ganas.</p>
                <div class="creadores-cta-buttons">
                    <button class="btn btn-youtube" onclick="showUploadModal()">ðŸ“¤ Subir mis Videos</button>
                    <button class="btn btn-ghost" onclick="showAuthModal('register')">Crear Cuenta Gratis</button>
                </div>
            </div>
            
            <!-- Quote -->
            <div class="creadores-quote">
                <p class="creadores-quote-text">"El conocimiento del fÃºtbol no deberÃ­a estar bloqueado detrÃ¡s de muros de pago. Queremos que cada entrenador de barrio tenga acceso a las mismas ideas que los profesionales."</p>
                <p class="creadores-quote-author">â€” La filosofÃ­a de Futbol Base TUBE</p>
            </div>
        </div>
    </section>

    <section class="biblioteca" id="biblioteca">
        <aside class="filters-sidebar">
            <div class="filters-header">
                <div class="filters-title">ðŸŽ¯ Filtros <span class="filters-badge" id="filtersBadge"></span></div>
                <span class="filters-clear" onclick="clearFilters()">Limpiar</span>
            </div>
            <div class="filter-group"><label class="filter-label">ðŸ“‚ Familia</label><select class="filter-select" id="filterFamilia"><option value="">Todas</option><option value="futbol_base">âš½ FÃºtbol Base</option><option value="profesional">ðŸŸï¸ Profesional</option><option value="entrevista">ðŸŽ¤ Entrevista</option><option value="analisis">ðŸ“Š AnÃ¡lisis TÃ¡ctico</option></select></div>
            <div class="filter-group"><label class="filter-label">CategorÃ­a</label><select class="filter-select" id="filterCategoria"><option value="">Todas</option></select></div>
            <div class="filter-group"><label class="filter-label">Dificultad</label><div class="difficulty-pills" id="filterDificultad"><div class="difficulty-pill" data-value="1">1</div><div class="difficulty-pill" data-value="2">2</div><div class="difficulty-pill" data-value="3">3</div><div class="difficulty-pill" data-value="4">4</div><div class="difficulty-pill" data-value="5">5</div></div></div>
            <div class="filter-group"><label class="filter-label">Entrenador</label><select class="filter-select" id="filterEntrenador"><option value="">Todos</option></select></div>
            <div class="filter-group"><label class="filter-label">Equipo</label><select class="filter-select" id="filterEquipo"><option value="">Todos</option></select></div>
            <div class="filter-group"><label class="filter-label">Idioma</label><select class="filter-select" id="filterIdioma"><option value="">Todos</option></select></div>
            <div class="filter-group"><label class="filter-label">Edad</label><select class="filter-select" id="filterEdad"><option value="">Todas</option></select></div>
            <div class="filter-group"><label class="filter-label">DuraciÃ³n</label><select class="filter-select" id="filterDuracion"><option value="">Todas</option><option value="0-300">0-5 min</option><option value="300-600">5-10 min</option><option value="600-900">10-15 min</option><option value="900-1800">15-30 min</option><option value="1800-99999">30+ min</option></select></div>
            <div class="filter-group"><label class="filter-label">NÂº Jugadores</label><select class="filter-select" id="filterJugadores"><option value="">Todos</option></select></div>
            <div class="filter-group"><label class="filter-label">NÂº Porteros</label><select class="filter-select" id="filterPorteros"><option value="">Todos</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3+">3+</option></select></div>
            <div class="filter-group"><label class="filter-label">Popularidad (Likes)</label><select class="filter-select" id="filterLikes"><option value="">Todos</option><option value="0-100">0-100</option><option value="100-500">100-500</option><option value="500-1000">500-1K</option><option value="1000-10000">1K-10K</option><option value="10000-99999999">10K+</option></select></div>
            <div class="filter-group"><label class="filter-label">Vistas</label><select class="filter-select" id="filterVistas"><option value="">Todas</option><option value="0-1000">0-1K</option><option value="1000-10000">1K-10K</option><option value="10000-100000">10K-100K</option><option value="100000-1000000">100K-1M</option><option value="1000000-99999999">1M+</option></select></div>
            <div class="filter-group"><label class="filter-label">Fuente</label><select class="filter-select" id="filterFuente"><option value="">Todas</option><option value="youtube">ðŸ“º YouTube</option><option value="twitter">ð• Twitter</option><option value="instagram">ðŸ“· Instagram</option></select></div>
        </aside>

        <main class="biblioteca-main">
            <div class="biblioteca-header">
                <div><h1 class="biblioteca-title">BIBLIOTECA DE EJERCICIOS</h1><p class="biblioteca-count">Mostrando <span id="exerciseCount">0</span> ejercicios</p></div>
                <div class="biblioteca-search"><span>ðŸ”</span><input type="text" id="searchInput" placeholder="Buscar ejercicios..."></div>
            </div>
            <div class="ejercicios-grid" id="exerciseGrid"><div class="state-container"><div class="loading-spinner"></div><p>Cargando ejercicios...</p></div></div>
        </main>
    </section>

    <footer class="footer"><p class="footer-text">Â© 2024 Futbol Base TUBE. Creado por entrenadores, para entrenadores. ðŸŒ</p></footer>

    <!-- Floating Session Button -->
    <div class="session-fab" id="sessionFab" onclick="toggleSessionDrawer()">
        <div class="session-fab-icon">ðŸ‹ï¸</div>
        <div class="session-fab-content"><div class="session-fab-title">Mi SesiÃ³n</div><div class="session-fab-count"><span id="fabCount">0</span> ejercicios</div></div>
        <div class="session-fab-badge" id="fabBadge">0</div>
    </div>

    <!-- Session Drawer -->
    <div class="session-drawer-backdrop" id="drawerBackdrop" onclick="toggleSessionDrawer()"></div>
    <div class="session-drawer" id="sessionDrawer">
        <div class="session-drawer-header"><div class="session-drawer-title">ðŸ‹ï¸ Mi SesiÃ³n</div><button class="session-drawer-close" onclick="toggleSessionDrawer()">âœ•</button></div>
        <div class="session-drawer-body" id="sessionBody"><div class="session-empty"><div class="session-empty-icon">ðŸ“‹</div><div class="session-empty-text">AÃ±ade ejercicios desde la biblioteca<br>usando el botÃ³n âž•</div></div></div>
        <div class="session-drawer-footer"><div class="session-stats"><span>DuraciÃ³n total:</span><strong id="sessionDuration">0 min</strong></div><div class="session-actions"><button class="btn btn-ghost btn-sm" onclick="clearSession()">ðŸ—‘ï¸ Vaciar</button><button class="btn btn-primary btn-sm" onclick="saveSession()" id="btnSaveSession">ðŸ’¾ Guardar</button></div></div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authOverlay" onclick="closeAuthModal(event)">
        <div class="modal-content auth-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeAuthModal()">Ã—</button>
            <h2 class="auth-title" id="authTitle">BIENVENIDO</h2>
            <p class="auth-subtitle" id="authSubtitle">Accede a tu cuenta para guardar sesiones</p>
            <div class="auth-tabs"><div class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">Entrar</div><div class="auth-tab" id="tabRegister" onclick="switchAuthTab('register')">Registrarse</div></div>
            <div class="auth-error" id="authError"></div>
            <form class="auth-form" id="authForm" onsubmit="handleAuth(event)">
                <input type="text" class="auth-input" id="authName" placeholder="Tu nombre" style="display:none;">
                <input type="email" class="auth-input" id="authEmail" placeholder="Email" required>
                <input type="password" class="auth-input" id="authPassword" placeholder="ContraseÃ±a" required>
                <button type="submit" class="btn btn-primary" style="width:100%;" id="authSubmit">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Exercise Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">Ã—</button>
            <div class="modal-video" id="modalVideo"></div>
            <div class="modal-body">
                <div id="modalVideoStats"></div>
                <h2 class="modal-title" id="modalTitle"></h2>
                <div class="modal-tags" id="modalTags"></div>
                <div class="modal-info-grid" id="modalInfo"></div>
                <p class="modal-description" id="modalDesc"></p>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="modalAddSession" onclick="addCurrentToSession()">âž• AÃ±adir a SesiÃ³n</button>
                    <button class="btn btn-ghost" id="modalFavorite" onclick="toggleFavorite()">â¤ï¸ Favorito</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Session Modal -->
    <div class="modal-overlay" id="saveOverlay" onclick="closeSaveModal(event)">
        <div class="modal-content save-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeSaveModal()">Ã—</button>
            <h2 class="save-modal-title">ðŸ’¾ Guardar SesiÃ³n</h2>
            <input type="text" class="auth-input" id="sessionName" placeholder="Nombre de la sesiÃ³n">
            <div class="form-row"><input type="date" class="auth-input" id="sessionDate"><select class="auth-input" id="sessionCategoria"><option value="">CategorÃ­a edad</option><option value="PrebenjamÃ­n">PrebenjamÃ­n</option><option value="BenjamÃ­n">BenjamÃ­n</option><option value="AlevÃ­n">AlevÃ­n</option><option value="Infantil">Infantil</option><option value="Cadete">Cadete</option><option value="Juvenil">Juvenil</option><option value="Senior">Senior</option></select></div>
            <input type="text" class="auth-input" id="sessionObjetivo" placeholder="Objetivo">
            <textarea class="auth-input" id="sessionNotas" placeholder="Notas adicionales" style="min-height:80px;"></textarea>
            <button class="btn btn-primary" style="width:100%;" onclick="confirmSaveSession()">ðŸ’¾ Guardar SesiÃ³n</button>
        </div>
    </div>

    <!-- Add to Session Modal -->
    <div class="modal-overlay" id="addToSessionOverlay" onclick="closeAddToSessionModal(event)">
        <div class="modal-content save-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeAddToSessionModal()">Ã—</button>
            <h2 class="save-modal-title">âž• AÃ±adir a SesiÃ³n</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 14px;">Selecciona la sesiÃ³n:</p>
            <div class="sessions-list" id="sessionsListModal"><div class="session-list-loading">Cargando...</div></div>
            <div class="session-divider"><span>o crea una nueva</span></div>
            <button class="btn btn-ghost" style="width:100%;" onclick="createNewSessionFromModal()">âž• Crear nueva sesiÃ³n</button>
        </div>
    </div>

    <!-- View Session Modal -->
    <div class="modal-overlay" id="viewSessionOverlay" onclick="closeViewSessionModal(event)">
        <div class="modal-content view-session-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeViewSessionModal()">Ã—</button>
            <div class="view-session-header"><h2 class="view-session-title" id="viewSessionTitle"></h2><div class="view-session-meta" id="viewSessionMeta"></div></div>
            <div class="view-session-objetivo" id="viewSessionObjetivo"></div>
            <div class="view-session-exercises" id="viewSessionExercises"></div>
            <div class="view-session-footer"><button class="btn btn-primary" onclick="copySessionLink()">ðŸ”— Copiar Link</button><button class="btn btn-ghost" onclick="editCurrentSession()">âœï¸ Editar</button><button class="btn btn-danger btn-sm" onclick="deleteCurrentSession()">ðŸ—‘ï¸</button></div>
        </div>
    </div>

    <!-- My Sessions Modal -->
    <div class="modal-overlay" id="mySessionsOverlay" onclick="closeMySessionsModal(event)">
        <div class="modal-content my-sessions-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeMySessionsModal()">Ã—</button>
            <div class="my-sessions-header"><h2 class="save-modal-title">ðŸ“‹ Mis Sesiones</h2><button class="btn btn-primary btn-sm" onclick="closeMySessionsModal();saveSession();">âž• Nueva</button></div>
            <div class="my-sessions-list" id="mySessionsList"><div class="session-list-loading">Cargando...</div></div>
        </div>
    </div>

    <!-- Upload Exercise Modal - NEW -->
    <div class="modal-overlay" id="uploadOverlay" onclick="closeUploadModal(event)">
        <div class="modal-content upload-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeUploadModal()">Ã—</button>
            
            <div class="upload-header">
                <h2>ðŸ“¤ SUBIR EJERCICIO</h2>
                <p>Comparte contenido de entrenamiento con la comunidad</p>
            </div>
            
            <div class="upload-body">
                
                <!-- PASO 1: Fuente del contenido -->
                <div class="upload-section">
                    <div class="upload-section-title">1ï¸âƒ£ Fuente del Contenido *</div>
                    <div class="upload-source-tabs">
                        <button class="upload-source-tab active" onclick="setUploadSource('video')">ðŸ“º URL de Video</button>
                        <button class="upload-source-tab" onclick="setUploadSource('imagen')">ðŸ–¼ï¸ Subir Imagen</button>
                    </div>
                    
                    <!-- OpciÃ³n Video -->
                    <div class="upload-source-content" id="uploadSourceVideo">
                        <div class="upload-url-input">
                            <input type="text" class="auth-input" id="uploadUrl" placeholder="https://youtube.com/watch?v=...">
                            <button class="btn btn-primary" onclick="extractVideoInfo()">Extraer</button>
                        </div>
                        <div class="upload-status" id="uploadStatus"></div>
                    </div>
                    
                    <!-- OpciÃ³n Imagen -->
                    <div class="upload-source-content" id="uploadSourceImagen" style="display:none;">
                        <div class="upload-image-drop" id="uploadImageDrop" onclick="document.getElementById('uploadImageInput').click()">
                            <input type="file" id="uploadImageInput" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
                            <div class="upload-image-placeholder" id="uploadImagePlaceholder">
                                <span class="upload-image-icon">ðŸ“·</span>
                                <span>Haz clic o arrastra una imagen</span>
                                <span class="upload-image-hint">JPG, PNG - MÃ¡x 5MB</span>
                            </div>
                            <img id="uploadImagePreview" class="upload-image-preview" style="display:none;">
                        </div>
                    </div>
                </div>
                
                <!-- Datos extraÃ­dos del video -->
                <div class="upload-section upload-extracted" id="uploadExtracted" style="display:none;">
                    <div class="upload-section-title">ðŸ“º Datos del Video (automÃ¡tico)</div>
                    <div class="upload-preview">
                        <img class="upload-preview-thumb" id="uploadThumb" src="">
                        <div class="upload-preview-info">
                            <div class="upload-preview-title" id="uploadPreviewTitle"></div>
                            <div class="upload-preview-channel" id="uploadPreviewChannel"></div>
                            <div class="upload-preview-stats">
                                <span id="uploadPreviewViews">ðŸ‘ï¸ 0</span>
                                <span id="uploadPreviewLikes">ðŸ‘ 0</span>
                                <span id="uploadPreviewDuration">â±ï¸ 0:00</span>
                                <span id="uploadPreviewLang">ðŸŒ</span>
                            </div>
                        </div>
                    </div>
                    <div class="upload-credit-notice">
                        <span>âœ…</span>
                        <span>El contenido serÃ¡ atribuido a <strong id="uploadCreditChannel">-</strong> con enlace al video original</span>
                    </div>
                </div>
                
                <!-- PASO 2: Familia -->
                <div class="upload-section" id="uploadFamiliaSection" style="display:none;">
                    <div class="upload-section-title">2ï¸âƒ£ Familia del Contenido *</div>
                    <div class="upload-familia-grid">
                        <div class="upload-familia-option" onclick="selectFamilia('futbol_base')"><span class="upload-familia-icon">âš½</span><span class="upload-familia-name">FÃºtbol Base</span></div>
                        <div class="upload-familia-option" onclick="selectFamilia('profesional')"><span class="upload-familia-icon">ðŸŸï¸</span><span class="upload-familia-name">Equipo/Entrenador Profesional</span></div>
                        <div class="upload-familia-option" onclick="selectFamilia('entrevista')"><span class="upload-familia-icon">ðŸŽ¤</span><span class="upload-familia-name">Entrevista</span></div>
                        <div class="upload-familia-option" onclick="selectFamilia('analisis')"><span class="upload-familia-icon">ðŸ“Š</span><span class="upload-familia-name">AnÃ¡lisis TÃ¡ctico</span></div>
                    </div>
                    
                    <!-- Campos extra Profesional -->
                    <div class="upload-familia-extra" id="familiaExtraProfesional" style="display:none;">
                        <div class="upload-grid">
                            <div class="upload-field">
                                <label>Entrenador</label>
                                <select id="uploadEntrenador">
                                    <option value="">Seleccionar...</option>
                                    <option value="Pep Guardiola">Pep Guardiola</option>
                                    <option value="JÃ¼rgen Klopp">JÃ¼rgen Klopp</option>
                                    <option value="Carlo Ancelotti">Carlo Ancelotti</option>
                                    <option value="Diego Simeone">Diego Simeone</option>
                                    <option value="Xavi HernÃ¡ndez">Xavi HernÃ¡ndez</option>
                                    <option value="Mikel Arteta">Mikel Arteta</option>
                                    <option value="Luis Enrique">Luis Enrique</option>
                                    <option value="Unai Emery">Unai Emery</option>
                                    <option value="Julian Nagelsmann">Julian Nagelsmann</option>
                                    <option value="Thomas Tuchel">Thomas Tuchel</option>
                                    <option value="Hansi Flick">Hansi Flick</option>
                                    <option value="Zinedine Zidane">Zinedine Zidane</option>
                                    <option value="Mauricio Pochettino">Mauricio Pochettino</option>
                                    <option value="Erik ten Hag">Erik ten Hag</option>
                                    <option value="Roberto De Zerbi">Roberto De Zerbi</option>
                                    <option value="Xabi Alonso">Xabi Alonso</option>
                                    <option value="Marcelo Bielsa">Marcelo Bielsa</option>
                                    <option value="Arne Slot">Arne Slot</option>
                                    <option value="Ruben Amorim">Ruben Amorim</option>
                                    <option value="Vincent Kompany">Vincent Kompany</option>
                                    <option value="_otro">Otro...</option>
                                </select>
                            </div>
                            <div class="upload-field">
                                <label>Equipo</label>
                                <select id="uploadEquipo">
                                    <option value="">Seleccionar...</option>
                                    <optgroup label="ðŸ‡ªðŸ‡¸ EspaÃ±a"><option value="FC Barcelona">FC Barcelona</option><option value="Real Madrid">Real Madrid</option><option value="AtlÃ©tico Madrid">AtlÃ©tico Madrid</option><option value="Athletic Bilbao">Athletic Bilbao</option><option value="Real Sociedad">Real Sociedad</option><option value="Sevilla FC">Sevilla FC</option><option value="Valencia CF">Valencia CF</option><option value="Villarreal CF">Villarreal CF</option><option value="Real Betis">Real Betis</option></optgroup>
                                    <optgroup label="ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ Inglaterra"><option value="Manchester City">Manchester City</option><option value="Liverpool">Liverpool</option><option value="Arsenal">Arsenal</option><option value="Chelsea">Chelsea</option><option value="Manchester United">Manchester United</option><option value="Tottenham">Tottenham</option><option value="Aston Villa">Aston Villa</option><option value="Brighton">Brighton</option><option value="Newcastle">Newcastle</option></optgroup>
                                    <optgroup label="ðŸ‡©ðŸ‡ª Alemania"><option value="Bayern Munich">Bayern Munich</option><option value="Borussia Dortmund">Borussia Dortmund</option><option value="RB Leipzig">RB Leipzig</option><option value="Bayer Leverkusen">Bayer Leverkusen</option></optgroup>
                                    <optgroup label="ðŸ‡®ðŸ‡¹ Italia"><option value="Juventus">Juventus</option><option value="AC Milan">AC Milan</option><option value="Inter Milan">Inter Milan</option><option value="Napoli">Napoli</option><option value="AS Roma">AS Roma</option><option value="Atalanta">Atalanta</option></optgroup>
                                    <optgroup label="ðŸ‡«ðŸ‡· Francia"><option value="PSG">PSG</option><option value="Olympique Lyon">Olympique Lyon</option><option value="Olympique Marsella">Olympique Marsella</option><option value="AS Monaco">AS Monaco</option></optgroup>
                                    <optgroup label="ðŸŒ Selecciones"><option value="EspaÃ±a">EspaÃ±a</option><option value="Alemania">Alemania</option><option value="Francia">Francia</option><option value="Inglaterra">Inglaterra</option><option value="Italia">Italia</option><option value="Argentina">Argentina</option><option value="Brasil">Brasil</option><option value="Portugal">Portugal</option></optgroup>
                                    <option value="_otro">Otro...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Campos extra AnÃ¡lisis -->
                    <div class="upload-familia-extra" id="familiaExtraAnalisis" style="display:none;">
                        <div class="upload-field">
                            <label>Sistema de Juego</label>
                            <select id="uploadSistema">
                                <option value="">Seleccionar sistema...</option>
                                <optgroup label="4 Defensas"><option value="4-4-2">4-4-2</option><option value="4-4-2 Rombo">4-4-2 Rombo</option><option value="4-3-3">4-3-3</option><option value="4-2-3-1">4-2-3-1</option><option value="4-1-4-1">4-1-4-1</option><option value="4-3-1-2">4-3-1-2</option><option value="4-1-2-1-2">4-1-2-1-2</option></optgroup>
                                <optgroup label="3 Defensas"><option value="3-5-2">3-5-2</option><option value="3-4-3">3-4-3</option><option value="3-4-2-1">3-4-2-1</option><option value="3-1-4-2">3-1-4-2</option></optgroup>
                                <optgroup label="5 Defensas"><option value="5-3-2">5-3-2</option><option value="5-4-1">5-4-1</option><option value="5-2-3">5-2-3</option></optgroup>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- PASO 3: DescripciÃ³n -->
                <div class="upload-section" id="uploadDescSection" style="display:none;">
                    <div class="upload-section-title">3ï¸âƒ£ Tu AportaciÃ³n</div>
                    <div class="upload-field">
                        <label>Describe el ejercicio con tus palabras <span class="upload-bonus">(+10 XP si escribes mÃ­nimo 50 palabras)</span></label>
                        <textarea id="uploadDescripcion" placeholder="Ej: Ejercicio de posesiÃ³n donde se trabaja la salida de balÃ³n con presiÃ³n alta del rival. El objetivo es mejorar la toma de decisiones bajo presiÃ³n y la velocidad de circulaciÃ³n del balÃ³n..." rows="4" oninput="updateWordCount()"></textarea>
                        <div class="upload-word-count" id="uploadWordCount"><span id="wordCountNum">0</span>/50 palabras <span id="wordCountStatus">âŒ</span></div>
                    </div>
                </div>
                
                <!-- PASO 4: Temas trabajados -->
                <div class="upload-section" id="uploadTemasSection" style="display:none;">
                    <div class="upload-section-title">4ï¸âƒ£ Temas Trabajados * <span class="upload-hint">(selecciona 1-5)</span></div>
                    <div class="upload-temas-grid" id="uploadTemas"></div>
                </div>
                
                <!-- PASO 5: Detalles -->
                <div class="upload-section" id="uploadDetallesSection" style="display:none;">
                    <div class="upload-section-title">5ï¸âƒ£ Detalles Adicionales</div>
                    <div class="upload-grid">
                        <div class="upload-field"><label>Dificultad *</label><select id="uploadDificultad"><option value="">Seleccionar</option><option value="1">1 - Muy fÃ¡cil</option><option value="2">2 - FÃ¡cil</option><option value="3">3 - Intermedio</option><option value="4">4 - DifÃ­cil</option><option value="5">5 - Muy difÃ­cil</option></select></div>
                        <div class="upload-field"><label>Idioma del video *</label><select id="uploadIdioma"><option value="">Seleccionar</option><option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option><option value="en">ðŸ‡¬ðŸ‡§ InglÃ©s</option><option value="pt">ðŸ‡µðŸ‡¹ PortuguÃ©s</option><option value="it">ðŸ‡®ðŸ‡¹ Italiano</option><option value="de">ðŸ‡©ðŸ‡ª AlemÃ¡n</option><option value="fr">ðŸ‡«ðŸ‡· FrancÃ©s</option><option value="nl">ðŸ‡³ðŸ‡± HolandÃ©s</option><option value="other">ðŸŒ Otro</option></select></div>
                    </div>
                    <div class="upload-grid">
                        <div class="upload-field"><label>Edad recomendada</label><select id="uploadEdad"><option value="">Seleccionar</option><option value="PrebenjamÃ­n">PrebenjamÃ­n (5-7)</option><option value="BenjamÃ­n">BenjamÃ­n (8-9)</option><option value="AlevÃ­n">AlevÃ­n (10-11)</option><option value="Infantil">Infantil (12-13)</option><option value="Cadete">Cadete (14-15)</option><option value="Juvenil">Juvenil (16-18)</option><option value="Senior">Senior (19+)</option><option value="Profesional">Profesional</option></select></div>
                        <div class="upload-field"><label>NÂº Jugadores</label><select id="uploadJugadores"><option value="">-</option><option value="2-4">2-4</option><option value="5-8">5-8</option><option value="9-12">9-12</option><option value="13-16">13-16</option><option value="17-20">17-20</option><option value="20+">20+</option></select></div>
                    </div>
                    <div class="upload-grid-3">
                        <div class="upload-field"><label>NÂº Porteros</label><select id="uploadPorteros"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3+</option></select></div>
                        <div class="upload-field"><label>Dimensiones</label><select id="uploadDimensiones"><option value="">-</option><option value="10x10m">10x10m</option><option value="15x15m">15x15m</option><option value="20x20m">20x20m</option><option value="30x30m">30x30m</option><option value="Medio campo">Medio campo</option><option value="Campo completo">Campo completo</option></select></div>
                        <div class="upload-field"><label>&nbsp;</label><div></div></div>
                    </div>
                </div>
                
                <!-- Pizarra TÃ¡ctica -->
                <div class="upload-section" id="uploadPizarraSection" style="display:none;">
                    <div class="upload-field">
                        <label>ðŸŽ¨ Imagen de Pizarra TÃ¡ctica (opcional) <span class="upload-bonus">+50 XP extra</span></label>
                        <div class="upload-pizarra" id="uploadPizarraBox" onclick="document.getElementById('uploadPizarraInput').click()">
                            <input type="file" id="uploadPizarraInput" accept="image/*" style="display:none;" onchange="handlePizarraUpload(event)">
                            <div id="pizarraPlaceholder">
                                <div class="upload-pizarra-icon">ðŸŽ¨</div>
                                <div class="upload-pizarra-text">Haz clic para subir imagen de pizarra</div>
                                <div class="upload-pizarra-hint">JPG, PNG - MÃ¡x 5MB</div>
                            </div>
                            <img id="pizarraPreview" class="upload-pizarra-preview" style="display:none;">
                        </div>
                    </div>
                    
                    <div class="upload-xp-bonus" id="uploadXpBonus">
                        <span>â­</span>
                        <span>GanarÃ¡s <strong id="uploadXpTotal">+50 XP</strong> cuando se apruebe</span>
                    </div>
                </div>
            </div>
            
            <div class="upload-footer">
                <button class="btn btn-ghost" onclick="closeUploadModal()">Cancelar</button>
                <button class="btn btn-primary" id="btnSubmitExercise" onclick="submitExercise()" disabled>ðŸ“¤ Enviar Ejercicio</button>
            </div>
        </div>
    </div>

    <!-- Profile/Gamification Modal -->
    <div class="modal-overlay" id="profileOverlay" onclick="closeProfileModal(event)">
        <div class="modal-card profile-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeProfileModal()">Ã—</button>
            
            <!-- Header -->
            <div class="profile-header">
                <div class="profile-avatar-large" id="profileAvatar">
                    M
                    <div class="profile-avatar-level" id="profileLevelIcon">âš½</div>
                </div>
                <div class="profile-info">
                    <h2 class="profile-name">
                        <span id="profileName">Usuario</span>
                        <span class="plan-badge coach" id="profilePlanBadge" style="display:none;">COACH</span>
                    </h2>
                    <div class="profile-title">
                        <span id="profileLevelTitle">Nivel 1 - Canterano</span>
                        <span class="liga-badge bronce" id="profileLiga" style="margin-left:12px;">ðŸ¥‰ Bronce</span>
                    </div>
                    <div class="profile-stats-row">
                        <div class="profile-stat-item">
                            <div class="profile-stat-value" id="profileExercises">0</div>
                            <div class="profile-stat-label">Ejercicios</div>
                        </div>
                        <div class="profile-stat-item">
                            <div class="profile-stat-value" id="profileLikes">0</div>
                            <div class="profile-stat-label">Likes</div>
                        </div>
                        <div class="profile-stat-item">
                            <div class="profile-stat-value" id="profileBadges">0</div>
                            <div class="profile-stat-label">Badges</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- XP Progress -->
            <div class="xp-section">
                <div class="xp-header">
                    <div class="xp-level-info">
                        <span class="xp-level-badge" id="xpLevelBadge">âš½</span>
                        <div>
                            <div class="xp-level-text" id="xpLevelText">Nivel 1</div>
                            <div class="xp-level-title" id="xpLevelSubtitle">Canterano</div>
                        </div>
                    </div>
                    <div class="xp-next-level" id="xpNextLevel">
                        <strong>200 XP</strong> para Juvenil
                    </div>
                </div>
                <div class="xp-progress-bar">
                    <div class="xp-progress-fill" id="xpProgressFill" style="width: 0%"></div>
                    <div class="xp-progress-text" id="xpProgressText">0 / 200 XP</div>
                </div>
                
                <!-- XP por mes con caducidad -->
                <div class="xp-months" id="xpMonths">
                    <div class="xp-month-card">
                        <div class="xp-month-name">Diciembre</div>
                        <div class="xp-month-value">0</div>
                    </div>
                    <div class="xp-month-card">
                        <div class="xp-month-name">Noviembre</div>
                        <div class="xp-month-value">0</div>
                    </div>
                    <div class="xp-month-card expiring">
                        <div class="xp-month-name">Octubre</div>
                        <div class="xp-month-value">0</div>
                        <div class="xp-month-expiry">âš ï¸ Expira pronto</div>
                    </div>
                </div>
            </div>
            
            <!-- Racha -->
            <div class="racha-section">
                <div class="racha-icon">ðŸ”¥</div>
                <div class="racha-info">
                    <div class="racha-title">Racha actual</div>
                    <div class="racha-value" id="rachaValue">0 dÃ­as</div>
                    <div class="racha-max" id="rachaMax">RÃ©cord: 0 dÃ­as</div>
                </div>
                <div class="racha-bonus" id="rachaBonus" style="display:none;">+50 XP Semanal</div>
            </div>
            
            <!-- Challenges Semanales -->
            <div class="challenges-section">
                <h3 class="section-title">ðŸŽ¯ Challenges de la Semana</h3>
                <div id="challengesList">
                    <div class="challenge-card">
                        <div class="challenge-header">
                            <div class="challenge-icon">âš½</div>
                            <div class="challenge-info">
                                <div class="challenge-title">Rey del Rondo</div>
                                <div class="challenge-desc">Sube 3 ejercicios de Rondos</div>
                            </div>
                            <div class="challenge-reward">+200 XP</div>
                        </div>
                        <div class="challenge-progress">
                            <div class="challenge-progress-fill" style="width: 33%"></div>
                        </div>
                        <div class="challenge-progress-text">
                            <span>1 / 3</span>
                            <span>4 dÃ­as restantes</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Badges -->
            <div class="badges-section">
                <h3 class="section-title">ðŸ… Badges (<span id="badgesCount">0</span>/<span id="badgesTotal">25</span>)</h3>
                <div class="badges-grid" id="badgesGrid">
                    <!-- Se llena dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Ranking -->
            <div class="ranking-section">
                <div class="ranking-header">
                    <h3 class="section-title">ðŸ† Ranking Mensual</h3>
                    <div class="ranking-tabs">
                        <div class="ranking-tab active" onclick="switchRankingTab('mensual')">Mensual</div>
                        <div class="ranking-tab" onclick="switchRankingTab('semanal')">Semanal</div>
                    </div>
                </div>
                <div class="ranking-list" id="rankingList">
                    <!-- Se llena dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Recompensas Pendientes -->
            <div class="rewards-section" id="rewardsSection" style="display:none;">
                <h3 class="section-title">ðŸŽ Recompensas Pendientes</h3>
                <div id="rewardsList">
                    <!-- Se llena dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Beneficios por nivel -->
            <div class="benefits-section">
                <h3 class="section-title">ðŸŽ–ï¸ Beneficios por Nivel</h3>
                <div id="benefitsList">
                    <div class="benefit-item">
                        <div class="benefit-icon">ðŸ’¬</div>
                        <div class="benefit-text">Comentar ejercicios</div>
                        <div class="benefit-status locked">Nivel 3</div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">â­</div>
                        <div class="benefit-text">Acceso a Ejercicios Premium</div>
                        <div class="benefit-status locked">Nivel 4</div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ðŸ—³ï¸</div>
                        <div class="benefit-text">Votar Ejercicio de la Semana</div>
                        <div class="benefit-status locked">Nivel 6</div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ðŸ‘‘</div>
                        <div class="benefit-text">50% descuento mensual</div>
                        <div class="benefit-status locked">Nivel 7</div>
                    </div>
                </div>
            </div>
            
            <!-- Warning de baja -->
            <div class="cancel-warning" id="cancelWarning">
                <div class="cancel-warning-title">âš ï¸ Importante sobre tu suscripciÃ³n</div>
                <div class="cancel-warning-text">
                    Si cancelas tu suscripciÃ³n, <strong>perderÃ¡s todo tu progreso</strong>:
                </div>
                <div class="cancel-warning-xp" id="cancelWarningXp">-0 XP perdidos</div>
                <div class="cancel-warning-text">
                    Tus badges, nivel y posiciÃ³n en el ranking se resetearÃ¡n a cero. 
                    TendrÃ¡s que empezar desde el principio.
                </div>
            </div>
        </div>
    </div>

    <!-- Upgrade Modal -->
    <div class="modal-overlay" id="upgradeOverlay" onclick="closeUpgradeModal(event)">
        <div class="modal-card upgrade-modal" onclick="event.stopPropagation()">
            <div class="upgrade-header">
                <div class="upgrade-icon" id="upgradeIcon">ðŸš€</div>
                <h2 class="upgrade-title" id="upgradeTitle">Desbloquea Todo el Potencial</h2>
                <p class="upgrade-subtitle" id="upgradeSubtitle">Accede a todas las funcionalidades premium</p>
            </div>
            
            <div class="upgrade-feature-blocked" id="upgradeFeatureBlocked" style="display:none;">
                <div class="upgrade-feature-blocked-text" id="upgradeBlockedText">Funcionalidad bloqueada</div>
            </div>
            
            <div class="xp-lost-alert" id="xpLostAlert" style="display:none;">
                <div class="xp-lost-icon">ðŸ˜¢</div>
                <div class="xp-lost-title">Â¡Has perdido XP!</div>
                <div class="xp-lost-amount" id="xpLostAmount">+0 XP</div>
                <div class="xp-lost-text">Los usuarios Free no acumulan puntos</div>
                <div class="xp-could-have">
                    <span class="xp-could-have-text">Si fueras </span>
                    <span class="xp-could-have-amount" id="xpCouldHave">Coach habrÃ­as ganado +100 XP</span>
                </div>
            </div>
            
            <div class="upgrade-plans">
                <div class="upgrade-plan" onclick="selectUpgradePlan('pro')">
                    <div class="upgrade-plan-info">
                        <div class="upgrade-plan-badge pro">â­</div>
                        <div>
                            <div class="upgrade-plan-name">Pro</div>
                            <div class="upgrade-plan-features">Ilimitado â€¢ Favoritos â€¢ Filtros avanzados</div>
                        </div>
                    </div>
                    <div class="upgrade-plan-price">
                        <div class="upgrade-plan-price-value">2,99â‚¬</div>
                        <div class="upgrade-plan-price-period">/mes</div>
                    </div>
                </div>
                <div class="upgrade-plan recommended" onclick="selectUpgradePlan('coach')">
                    <div class="upgrade-plan-info">
                        <div class="upgrade-plan-badge coach">ðŸ‘‘</div>
                        <div>
                            <div class="upgrade-plan-name">Coach <span class="upgrade-plan-tag">RECOMENDADO</span></div>
                            <div class="upgrade-plan-features">Todo Pro + Pizarra + XP x2 + Subir ejercicios</div>
                        </div>
                    </div>
                    <div class="upgrade-plan-price">
                        <div class="upgrade-plan-price-value">4,99â‚¬</div>
                        <div class="upgrade-plan-price-period">/mes</div>
                    </div>
                </div>
            </div>
            
            <div class="upgrade-benefits">
                <div class="upgrade-benefit"><span class="upgrade-benefit-icon">âœ…</span> Ejercicios ilimitados al mes</div>
                <div class="upgrade-benefit"><span class="upgrade-benefit-icon">âœ…</span> Guardar sesiones ilimitadas</div>
                <div class="upgrade-benefit"><span class="upgrade-benefit-icon">âœ…</span> Filtros avanzados (entrenador, equipo...)</div>
                <div class="upgrade-benefit"><span class="upgrade-benefit-icon">âœ…</span> Guardar favoritos</div>
                <div class="upgrade-benefit" id="benefitPizarra" style="display:none;"><span class="upgrade-benefit-icon">âœ…</span> Acceso a Pizarra TÃ¡ctica</div>
                <div class="upgrade-benefit" id="benefitXp" style="display:none;"><span class="upgrade-benefit-icon">âœ…</span> Ganar XP al subir ejercicios (x2)</div>
            </div>
            
            <div class="upgrade-footer">
                <button class="btn btn-primary btn-lg" style="width:100%;" onclick="goToCheckout()">ðŸš€ Mejorar mi Plan</button>
                <p class="upgrade-footer-text">Cancela cuando quieras â€¢ Sin compromiso</p>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // ==================== CONFIG ====================
        var SUPABASE_URL = localStorage.getItem('sb_url') || '';
        var SUPABASE_KEY = localStorage.getItem('sb_key') || '';
        var YT_API_KEY = localStorage.getItem('yt_key') || '';
        var db = null;
        var currentUser = null;
        var currentExercise = null;
        var currentSession = [];
        var exercises = [];
        var filters = {};
        var notifications = [];

        // ==================== FREEMIUM STATE ====================
        var userLimits = {
            plan: 'free',
            ejercicios_mes: 10,
            ejercicios_vistos: 0,
            sesiones_guardadas: 1,
            puede_favoritos: false,
            puede_subir: true,
            acceso_pizarra: false,
            filtros_avanzados: false,
            gana_xp: false,
            multiplicador_xp: 0
        };
        var ADVANCED_FILTERS = ['filterEntrenador', 'filterEquipo', 'filterJugadores', 'filterPorteros', 'filterLikes', 'filterVistas'];
        var selectedUpgradePlan = 'coach';

        // ==================== TEMAS TRABAJADOS ====================
        var TEMAS_TRABAJADOS = [
            'Rondos', 'PosesiÃ³n', 'FinalizaciÃ³n', 'Pressing', 'Transiciones', 'Porteros', 'Calentamiento',
            'Pase', 'Control', 'ConducciÃ³n', 'Regate', 'Defensa', 'Ataque',
            'Juego Posicional', 'Salida de BalÃ³n', 'Pressing Alto', 'Gegenpressing',
            'Superioridades', 'Tercer Hombre', 'Juego Entre LÃ­neas', 'Basculaciones',
            'Coberturas y Permutas', 'Desmarques', 'Cambios de OrientaciÃ³n', 'PeriodizaciÃ³n TÃ¡ctica',
            'SSG', 'Trabajo Cognitivo', 'Toma de Decisiones', '1v1 / Duelos', 'Oleadas',
            'Circuitos TÃ©cnicos', 'Estrategia (ABP)', 'Repliegue', 'Amplitud y Profundidad', 'SincronizaciÃ³n de LÃ­neas'
        ];

        var LANG_FLAGS = { 'es': 'ðŸ‡ªðŸ‡¸', 'en': 'ðŸ‡¬ðŸ‡§', 'pt': 'ðŸ‡µðŸ‡¹', 'it': 'ðŸ‡®ðŸ‡¹', 'de': 'ðŸ‡©ðŸ‡ª', 'fr': 'ðŸ‡«ðŸ‡·', 'nl': 'ðŸ‡³ðŸ‡±', 'other': 'ðŸŒ' };
        var LANG_NAMES = { 'es': 'EspaÃ±ol', 'en': 'InglÃ©s', 'pt': 'PortuguÃ©s', 'it': 'Italiano', 'de': 'AlemÃ¡n', 'fr': 'FrancÃ©s', 'nl': 'HolandÃ©s', 'other': 'Otro' };

        // ==================== UPLOAD STATE ====================
        var uploadSource = 'video';
        var uploadData = {};
        var selectedFamilia = null;
        var selectedTemas = [];
        var uploadedImageFile = null;

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', function() {
            if (SUPABASE_URL && SUPABASE_KEY) {
                db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                checkAuth();
                loadExercises();
                loadFilters();
                loadHomeGamification(); // Cargar ranking, challenges y badges en home
            } else {
                showConfigPrompt();
            }
            setupEventListeners();
            initUploadTemas();
        });

        function showConfigPrompt() {
            document.getElementById('exerciseGrid').innerHTML = '<div class="state-container"><div class="state-icon">âš™ï¸</div><div class="state-title">ConfiguraciÃ³n necesaria</div><p class="state-text">Configura Supabase en el <a href="admin.html">panel admin</a></p></div>';
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', debounce(loadExercises, 300));
            document.querySelectorAll('.filter-select').forEach(function(s) { s.addEventListener('change', loadExercises); });
            document.querySelectorAll('.difficulty-pill').forEach(function(p) {
                p.addEventListener('click', function() {
                    var active = this.classList.contains('active');
                    document.querySelectorAll('.difficulty-pill').forEach(function(x) { x.classList.remove('active'); });
                    if (!active) this.classList.add('active');
                    loadExercises();
                });
            });
        }

        function debounce(fn, wait) { var t; return function() { clearTimeout(t); t = setTimeout(fn, wait); }; }

        // ==================== AUTH ====================
        async function checkAuth() {
            if (!db) return;
            var { data: { user } } = await db.auth.getUser();
            if (user) {
                currentUser = user;
                var { data: perfil } = await db.from('perfiles').select('*').eq('id', user.id).single();
                if (perfil) currentUser.perfil = perfil;
                await loadUserLimits();
                updateUIForUser();
                loadNotifications();
                applyFreemiumRestrictions();
                // Actualizar racha diaria
                checkAndUpdateRacha();
            } else {
                // Usuario no logueado = Free con lÃ­mites
                applyFreemiumRestrictions();
            }
        }

        async function loadUserLimits() {
            if (!currentUser) {
                userLimits = { plan: 'free', ejercicios_mes: 10, ejercicios_vistos: 0, sesiones_guardadas: 1, puede_favoritos: false, puede_subir: true, acceso_pizarra: false, filtros_avanzados: false, gana_xp: false, multiplicador_xp: 0 };
                return;
            }
            try {
                var { data, error } = await db.rpc('obtener_limites_usuario', { p_usuario_id: currentUser.id });
                if (data && !error) {
                    userLimits = data;
                } else {
                    // Fallback desde perfil
                    var p = currentUser.perfil || {};
                    var plan = p.plan || 'free';
                    userLimits = {
                        plan: plan,
                        ejercicios_mes: plan === 'free' ? 10 : -1,
                        ejercicios_vistos: p.ejercicios_vistos_mes || 0,
                        sesiones_guardadas: plan === 'free' ? 1 : -1,
                        puede_favoritos: plan !== 'free',
                        puede_subir: true,
                        acceso_pizarra: plan === 'coach',
                        filtros_avanzados: plan !== 'free',
                        gana_xp: plan !== 'free',
                        multiplicador_xp: plan === 'coach' ? 2 : (plan === 'pro' ? 1 : 0)
                    };
                }
            } catch (e) { console.error('Error cargando lÃ­mites:', e); }
        }

        function applyFreemiumRestrictions() {
            // Bloquear filtros avanzados para usuarios Free
            ADVANCED_FILTERS.forEach(function(filterId) {
                var el = document.getElementById(filterId);
                if (!el) return;
                var parent = el.parentElement;
                if (!userLimits.filtros_avanzados) {
                    parent.classList.add('filter-locked');
                    el.disabled = true;
                    el.onclick = function(e) { e.preventDefault(); showUpgradeModal('filtros'); };
                } else {
                    parent.classList.remove('filter-locked');
                    el.disabled = false;
                    el.onclick = null;
                }
            });
            
            // Actualizar badge de lÃ­mite en header
            updateLimitBadge();
        }

        function updateLimitBadge() {
            var badge = document.querySelector('.limit-badge');
            if (!badge) return;
            
            if (userLimits.plan === 'free' && userLimits.ejercicios_mes > 0) {
                badge.style.display = 'inline-block';
                badge.textContent = 'ðŸ“º ' + userLimits.ejercicios_vistos + '/' + userLimits.ejercicios_mes;
                badge.classList.toggle('limit-reached', userLimits.ejercicios_vistos >= userLimits.ejercicios_mes);
            } else {
                badge.style.display = 'none';
            }
        }

        function canViewExercise() {
            if (userLimits.ejercicios_mes === -1) return true; // Ilimitado
            return userLimits.ejercicios_vistos < userLimits.ejercicios_mes;
        }

        async function incrementExerciseView() {
            if (!currentUser || userLimits.ejercicios_mes === -1) return;
            
            userLimits.ejercicios_vistos++;
            updateLimitBadge();
            
            // Actualizar en BD
            if (db) {
                await db.rpc('incrementar_ejercicios_vistos', { p_usuario_id: currentUser.id });
            }
        }

        function updateUIForUser() {
            var u = currentUser;
            var p = u.perfil || {};
            var plan = p.plan || 'free';
            var planBadge = plan === 'coach' ? '<span class="plan-badge coach">COACH</span>' : (plan === 'pro' ? '<span class="plan-badge pro">PRO</span>' : '');
            
            // Badge de lÃ­mite para Free
            var limitBadge = '';
            if (plan === 'free' && userLimits.ejercicios_mes > 0) {
                var isNearLimit = userLimits.ejercicios_vistos >= userLimits.ejercicios_mes - 2;
                var limitClass = userLimits.ejercicios_vistos >= userLimits.ejercicios_mes ? 'limit-reached' : '';
                limitBadge = '<span class="limit-badge ' + limitClass + '" onclick="showUpgradeModal(\'limite\')" style="cursor:pointer;">ðŸ“º ' + userLimits.ejercicios_vistos + '/' + userLimits.ejercicios_mes + '</span>';
            }
            
            // OpciÃ³n de mejorar plan solo para Free
            var upgradeOption = plan === 'free' ? '<div class="user-dropdown-item upgrade" onclick="showUpgradeModal()">ðŸš€ Mejorar Plan</div>' : '';
            
            document.getElementById('headerActions').innerHTML = 
                '<div class="user-stats-header">' +
                    '<span class="xp-badge">â­ ' + (p.xp || 0) + ' XP</span>' +
                    '<span class="racha-badge">ðŸ”¥ ' + (p.racha_dias || 0) + '</span>' +
                    limitBadge +
                '</div>' +
                '<div class="notif-bell" onclick="toggleNotifications()">' +
                    '<span class="notif-bell-icon">ðŸ””</span>' +
                    '<span class="notif-badge" id="notifBadge">0</span>' +
                    '<div class="notif-dropdown" id="notifDropdown">' +
                        '<div class="notif-header"><span class="notif-header-title">Notificaciones</span><span class="notif-header-action" onclick="markAllRead()">Marcar leÃ­das</span></div>' +
                        '<div class="notif-list" id="notifList"></div>' +
                    '</div>' +
                '</div>' +
                '<div class="user-menu" onclick="toggleUserMenu()">' +
                    '<div class="user-avatar">' + (p.nombre || u.email)[0].toUpperCase() + '</div>' +
                    '<span class="user-name">' + (p.nombre || u.email.split('@')[0]) + planBadge + '</span>' +
                    '<div class="user-dropdown" id="userDropdown">' +
                        '<div class="user-dropdown-header"><div class="user-dropdown-level">Nivel ' + (p.nivel || 1) + ' - ' + (p.titulo || 'Novato') + '</div><div class="user-dropdown-xp">' + (p.xp_rolling || p.xp || 0) + ' XP</div></div>' +
                        '<div class="user-dropdown-item" onclick="showProfileModal()">ðŸ† Mi Perfil / XP</div>' +
                        upgradeOption +
                        '<div class="user-dropdown-item" onclick="showMySessions()">ðŸ“‹ Mis Sesiones</div>' +
                        '<div class="user-dropdown-item" onclick="showUploadModal()">ðŸ“¤ Subir Ejercicio</div>' +
                        (plan === 'coach' ? '<div class="user-dropdown-item" onclick="location.href=\'admin.html\'">âš™ï¸ Admin</div>' : '') +
                        '<div class="user-dropdown-item danger" onclick="logout()">ðŸšª Cerrar SesiÃ³n</div>' +
                    '</div>' +
                '</div>';
        }

        function toggleUserMenu() { document.getElementById('userDropdown').classList.toggle('show'); }

        async function logout() {
            await db.auth.signOut();
            currentUser = null;
            location.reload();
        }

        function showAuthModal(tab) {
            document.getElementById('authOverlay').classList.add('active');
            switchAuthTab(tab || 'login');
        }

        function closeAuthModal(e) { if (!e || e.target === e.currentTarget) document.getElementById('authOverlay').classList.remove('active'); }

        function switchAuthTab(tab) {
            document.getElementById('tabLogin').classList.toggle('active', tab === 'login');
            document.getElementById('tabRegister').classList.toggle('active', tab === 'register');
            document.getElementById('authName').style.display = tab === 'register' ? 'block' : 'none';
            document.getElementById('authSubmit').textContent = tab === 'login' ? 'Entrar' : 'Registrarse';
            document.getElementById('authTitle').textContent = tab === 'login' ? 'BIENVENIDO' : 'ÃšNETE';
        }

        async function handleAuth(e) {
            e.preventDefault();
            var email = document.getElementById('authEmail').value;
            var pass = document.getElementById('authPassword').value;
            var name = document.getElementById('authName').value;
            var isRegister = document.getElementById('tabRegister').classList.contains('active');
            
            try {
                if (isRegister) {
                    var { data, error } = await db.auth.signUp({ email: email, password: pass });
                    if (error) throw error;
                    if (data.user) {
                        await db.from('perfiles').insert({ id: data.user.id, nombre: name, plan: 'free', xp: 0, nivel: 1 });
                    }
                    showToast('âœ… Registro exitoso. Revisa tu email.', 'success');
                    // Mostrar onboarding para nuevos usuarios
                    localStorage.removeItem('onboarding_completed');
                    setTimeout(function() { showOnboarding(); }, 500);
                } else {
                    var { data, error } = await db.auth.signInWithPassword({ email: email, password: pass });
                    if (error) throw error;
                    showToast('âœ… Bienvenido!', 'success');
                    // Verificar si debe mostrar onboarding (primer login)
                    checkShowOnboarding();
                }
                closeAuthModal();
                checkAuth();
            } catch (err) {
                document.getElementById('authError').textContent = err.message;
                document.getElementById('authError').classList.add('show');
            }
        }

        // ==================== NOTIFICATIONS ====================
        async function loadNotifications() {
            if (!db || !currentUser) return;
            var { data } = await db.from('notificaciones').select('*').eq('usuario_id', currentUser.id).order('created_at', { ascending: false }).limit(20);
            notifications = data || [];
            renderNotifications();
        }

        function renderNotifications() {
            var unread = notifications.filter(function(n) { return !n.leida; }).length;
            var badge = document.getElementById('notifBadge');
            if (badge) {
                badge.textContent = unread;
                badge.classList.toggle('show', unread > 0);
            }
            var list = document.getElementById('notifList');
            if (!list) return;
            if (!notifications.length) {
                list.innerHTML = '<div class="notif-empty"><div class="notif-empty-icon">ðŸ””</div><p>No hay notificaciones</p></div>';
                return;
            }
            list.innerHTML = notifications.map(function(n) {
                return '<div class="notif-item ' + (n.leida ? '' : 'unread') + '" onclick="openNotification(\'' + n.id + '\')">' +
                    '<div class="notif-item-title">' + n.titulo + '</div>' +
                    '<div class="notif-item-message">' + n.mensaje + '</div>' +
                    '<div class="notif-item-time">' + getTimeAgo(n.created_at) + '</div>' +
                '</div>';
            }).join('');
        }

        function toggleNotifications() {
            document.getElementById('notifDropdown').classList.toggle('show');
            document.getElementById('userDropdown').classList.remove('show');
        }

        async function openNotification(id) {
            await db.from('notificaciones').update({ leida: true }).eq('id', id);
            loadNotifications();
            showToast('NotificaciÃ³n marcada como leÃ­da', 'success');
        }

        async function markAllRead() {
            if (!currentUser) return;
            await db.from('notificaciones').update({ leida: true }).eq('usuario_id', currentUser.id);
            loadNotifications();
        }

        function getTimeAgo(date) {
            var mins = Math.floor((Date.now() - new Date(date)) / 60000);
            if (mins < 60) return mins + ' min';
            if (mins < 1440) return Math.floor(mins / 60) + ' h';
            return Math.floor(mins / 1440) + ' d';
        }

        // ==================== EXERCISES ====================
        async function loadExercises() {
            if (!db) return;
            var grid = document.getElementById('exerciseGrid');
            grid.innerHTML = '<div class="state-container"><div class="loading-spinner"></div><p>Cargando...</p></div>';
            
            var query = db.from('ejercicios').select('*').eq('estado', 'publicado').order('created_at', { ascending: false });
            
            var search = document.getElementById('searchInput').value.trim();
            if (search) query = query.ilike('titulo_ejercicio', '%' + search + '%');
            
            var familia = document.getElementById('filterFamilia').value;
            if (familia) query = query.eq('familia', familia);
            
            var cat = document.getElementById('filterCategoria').value;
            if (cat) query = query.contains('categorias', [cat]);
            
            var dif = document.querySelector('.difficulty-pill.active');
            if (dif) query = query.eq('dificultad', parseInt(dif.dataset.value));
            
            var ent = document.getElementById('filterEntrenador').value;
            if (ent) query = query.eq('entrenador', ent);
            
            var equipo = document.getElementById('filterEquipo').value;
            if (equipo) query = query.eq('equipo', equipo);
            
            var idioma = document.getElementById('filterIdioma').value;
            if (idioma) query = query.eq('idioma', idioma);
            
            var edad = document.getElementById('filterEdad').value;
            if (edad) query = query.eq('edad', edad);
            
            var fuente = document.getElementById('filterFuente').value;
            if (fuente) query = query.eq('source', fuente);
            
            var { data, error } = await query.limit(50);
            
            if (error) { grid.innerHTML = '<div class="state-container"><div class="state-icon">âŒ</div><p>' + error.message + '</p></div>'; return; }
            
            exercises = data || [];
            renderExercises();
            updateStats();
        }

        var FAMILIA_NAMES = { 'futbol_base': 'âš½ Base', 'profesional': 'ðŸŸï¸ Pro', 'entrevista': 'ðŸŽ¤ Entrev.', 'analisis': 'ðŸ“Š AnÃ¡lisis' };

        function renderExercises() {
            var grid = document.getElementById('exerciseGrid');
            if (!exercises.length) {
                grid.innerHTML = '<div class="state-container"><div class="state-icon">ðŸ”</div><div class="state-title">No hay ejercicios</div><p class="state-text">Prueba con otros filtros</p></div>';
                return;
            }
            
            grid.innerHTML = exercises.map(function(ex) {
                var cats = (ex.categorias || []).slice(0, 2).map(function(c) { return '<span class="ejercicio-tag">' + c + '</span>'; }).join('');
                var inSession = currentSession.some(function(s) { return s.id === ex.id; });
                var familiaLabel = ex.familia ? FAMILIA_NAMES[ex.familia] || ex.familia : '';
                return '<div class="ejercicio-card" onclick="openExercise(\'' + ex.id + '\')">' +
                    '<div class="ejercicio-thumbnail">' +
                        '<img src="' + (ex.thumbnail_url || 'https://via.placeholder.com/320x180/16162a/8b8ba7?text=Video') + '" alt="">' +
                        '<div class="ejercicio-play"></div>' +
                        (familiaLabel ? '<div class="ejercicio-familia">' + familiaLabel + '</div>' : '') +
                        (ex.dificultad ? '<div class="ejercicio-difficulty">Dif ' + ex.dificultad + '</div>' : '') +
                        '<div class="ejercicio-lang">' + (LANG_FLAGS[ex.idioma] || 'ðŸŒ') + '</div>' +
                        (ex.duracion ? '<div class="ejercicio-duration">' + ex.duracion + '</div>' : '') +
                    '</div>' +
                    '<div class="ejercicio-body">' +
                        '<h3 class="ejercicio-title">' + (ex.titulo_ejercicio || ex.titulo_video) + '</h3>' +
                        '<p class="ejercicio-meta">' + (ex.entrenador || ex.canal || '-') + (ex.equipo ? ' â€¢ ' + ex.equipo : '') + '</p>' +
                        '<div class="ejercicio-tags">' + cats + '</div>' +
                        '<div class="ejercicio-footer">' +
                            '<div class="ejercicio-stats"><span class="ejercicio-stat">ðŸ‘ï¸ ' + formatNumber(ex.vistas || 0) + '</span><span class="ejercicio-stat">ðŸ‘ ' + formatNumber(ex.likes || 0) + '</span></div>' +
                            '<div class="ejercicio-actions">' +
                                '<button class="ejercicio-action ' + (inSession ? 'in-session' : '') + '" onclick="event.stopPropagation();toggleInSession(\'' + ex.id + '\')">' + (inSession ? 'âœ“' : '+') + '</button>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }).join('');
            
            document.getElementById('exerciseCount').textContent = exercises.length;
        }

        function formatNumber(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return n;
        }

        async function updateStats() {
            if (!db) return;
            var { count } = await db.from('ejercicios').select('*', { count: 'exact', head: true }).eq('estado', 'publicado');
            document.getElementById('heroTotal').textContent = count || 0;
            
            var { data: ents } = await db.from('ejercicios').select('entrenador').eq('estado', 'publicado').not('entrenador', 'is', null);
            var uniqueEnts = [...new Set((ents || []).map(function(e) { return e.entrenador; }).filter(Boolean))];
            document.getElementById('heroEntrenadores').textContent = uniqueEnts.length;
            
            var { data: cats } = await db.from('ejercicios').select('categorias').eq('estado', 'publicado');
            var allCats = (cats || []).flatMap(function(c) { return c.categorias || []; });
            var uniqueCats = [...new Set(allCats)];
            document.getElementById('heroCategorias').textContent = uniqueCats.length;
        }

        async function loadFilters() {
            if (!db) return;
            var { data } = await db.from('ejercicios').select('categorias, entrenador, equipo, idioma, edad, jugadores').eq('estado', 'publicado');
            if (!data) return;
            
            var cats = [...new Set(data.flatMap(function(d) { return d.categorias || []; }))].sort();
            var ents = [...new Set(data.map(function(d) { return d.entrenador; }).filter(Boolean))].sort();
            var equipos = [...new Set(data.map(function(d) { return d.equipo; }).filter(Boolean))].sort();
            var idiomas = [...new Set(data.map(function(d) { return d.idioma; }).filter(Boolean))];
            var edades = [...new Set(data.map(function(d) { return d.edad; }).filter(Boolean))];
            var jugadores = [...new Set(data.map(function(d) { return d.jugadores; }).filter(Boolean))];
            
            populateSelect('filterCategoria', cats);
            populateSelect('filterEntrenador', ents);
            populateSelect('filterEquipo', equipos);
            populateSelect('filterIdioma', idiomas.map(function(i) { return { value: i, label: (LANG_FLAGS[i] || 'ðŸŒ') + ' ' + (LANG_NAMES[i] || i) }; }));
            populateSelect('filterEdad', edades);
            populateSelect('filterJugadores', jugadores);
        }

        function populateSelect(id, options) {
            var sel = document.getElementById(id);
            var first = sel.options[0];
            sel.innerHTML = '';
            sel.appendChild(first);
            options.forEach(function(o) {
                var opt = document.createElement('option');
                if (typeof o === 'object') { opt.value = o.value; opt.textContent = o.label; }
                else { opt.value = o; opt.textContent = o; }
                sel.appendChild(opt);
            });
        }

        function clearFilters() {
            document.querySelectorAll('.filter-select').forEach(function(s) { s.value = ''; });
            document.querySelectorAll('.difficulty-pill').forEach(function(p) { p.classList.remove('active'); });
            document.getElementById('searchInput').value = '';
            loadExercises();
        }

        // ==================== EXERCISE MODAL ====================
        function openExercise(id) {
            currentExercise = exercises.find(function(e) { return e.id === id; });
            if (!currentExercise) return;
            
            // AnÃ³nimo â†’ debe registrarse
            if (!currentUser) {
                showAuthModal('register');
                showToast('ðŸ“ RegÃ­strate gratis para ver ejercicios', 'error');
                return;
            }
            
            // Free â†’ verificar lÃ­mite mensual
            if (!canViewExercise()) {
                showUpgradeModal('limite');
                return;
            }
            
            var ex = currentExercise;
            document.getElementById('modalTitle').textContent = ex.titulo_ejercicio || ex.titulo_video;
            
            var videoHtml = '<a href="' + (ex.video_url || '#') + '" target="_blank" class="modal-thumb-link">' +
                '<img src="' + (ex.thumbnail_url || '') + '" alt="' + (ex.titulo_ejercicio || '') + '" class="modal-thumb-img">' +
                '<div class="modal-play-btn">â–¶</div>' +
            '</a>';
            document.getElementById('modalVideo').innerHTML = videoHtml;
            
            // Info del video (canal, vistas, likes)
            var videoStats = '<div class="modal-video-stats">';
            if (ex.canal) videoStats += '<span class="modal-stat">ðŸ“º ' + ex.canal + '</span>';
            if (ex.vistas) videoStats += '<span class="modal-stat">ðŸ‘ï¸ ' + formatNumber(ex.vistas) + ' vistas</span>';
            if (ex.likes) videoStats += '<span class="modal-stat">â¤ï¸ ' + formatNumber(ex.likes) + '</span>';
            videoStats += '</div>';
            document.getElementById('modalVideoStats').innerHTML = videoStats;
            
            var tags = (ex.categorias || []).map(function(c) { return '<span class="modal-tag">' + c + '</span>'; }).join('');
            if (ex.dificultad) tags += '<span class="modal-tag dif">Dificultad ' + ex.dificultad + '</span>';
            document.getElementById('modalTags').innerHTML = tags;
            
            var info = '';
            if (ex.entrenador) info += '<div class="modal-info-item"><div class="modal-info-icon">ðŸ‘¨â€ðŸ«</div><div class="modal-info-value">' + ex.entrenador + '</div><div class="modal-info-label">Entrenador</div></div>';
            if (ex.equipo) info += '<div class="modal-info-item"><div class="modal-info-icon">ðŸŸï¸</div><div class="modal-info-value">' + ex.equipo + '</div><div class="modal-info-label">Equipo</div></div>';
            if (ex.duracion) info += '<div class="modal-info-item"><div class="modal-info-icon">â±ï¸</div><div class="modal-info-value">' + ex.duracion + '</div><div class="modal-info-label">DuraciÃ³n</div></div>';
            if (ex.jugadores) info += '<div class="modal-info-item"><div class="modal-info-icon">ðŸ‘¥</div><div class="modal-info-value">' + ex.jugadores + '</div><div class="modal-info-label">Jugadores</div></div>';
            if (ex.edad) info += '<div class="modal-info-item"><div class="modal-info-icon">ðŸ“…</div><div class="modal-info-value">' + ex.edad + '</div><div class="modal-info-label">Edad</div></div>';
            document.getElementById('modalInfo').innerHTML = info;
            
            document.getElementById('modalDesc').textContent = ex.descripcion || '';
            document.getElementById('modalOverlay').classList.add('active');
            
            // Incrementar contador de ejercicios vistos
            incrementExerciseView();
        }

        function closeModal(e) { if (!e || e.target === e.currentTarget) { document.getElementById('modalOverlay').classList.remove('active'); document.getElementById('modalVideo').innerHTML = ''; } }

        // ==================== SESSION ====================
        function toggleInSession(id) {
            var ex = exercises.find(function(e) { return e.id === id; });
            if (!ex) return;
            var idx = currentSession.findIndex(function(s) { return s.id === id; });
            if (idx === -1) { currentSession.push(ex); showToast('âž• AÃ±adido a la sesiÃ³n', 'success'); }
            else { currentSession.splice(idx, 1); showToast('âž– Quitado de la sesiÃ³n', 'success'); }
            updateSessionUI();
            renderExercises();
        }

        function addCurrentToSession() {
            if (!currentExercise) return;
            toggleInSession(currentExercise.id);
        }

        function updateSessionUI() {
            var count = currentSession.length;
            document.getElementById('fabCount').textContent = count;
            document.getElementById('fabBadge').textContent = count;
            document.getElementById('sessionFab').classList.toggle('has-items', count > 0);
            
            var dur = currentSession.reduce(function(t, e) { return t + (e.duracion_segundos || 0); }, 0);
            document.getElementById('sessionDuration').textContent = Math.round(dur / 60) + ' min';
            
            var body = document.getElementById('sessionBody');
            if (!count) {
                body.innerHTML = '<div class="session-empty"><div class="session-empty-icon">ðŸ“‹</div><div class="session-empty-text">AÃ±ade ejercicios desde la biblioteca</div></div>';
                return;
            }
            body.innerHTML = currentSession.map(function(ex, i) {
                return '<div class="session-item">' +
                    '<span class="session-item-drag">â˜°</span>' +
                    '<img class="session-item-thumb" src="' + (ex.thumbnail_url || '') + '">' +
                    '<div class="session-item-info"><div class="session-item-title">' + (ex.titulo_ejercicio || ex.titulo_video) + '</div><div class="session-item-meta">' + (ex.duracion || '--') + '</div></div>' +
                    '<button class="session-item-remove" onclick="removeFromSession(' + i + ')">âœ•</button>' +
                '</div>';
            }).join('');
        }

        function removeFromSession(idx) { currentSession.splice(idx, 1); updateSessionUI(); renderExercises(); }
        function clearSession() { currentSession = []; updateSessionUI(); renderExercises(); showToast('ðŸ—‘ï¸ SesiÃ³n vaciada', 'success'); }
        function toggleSessionDrawer() {
            document.getElementById('sessionDrawer').classList.toggle('open');
            document.getElementById('drawerBackdrop').classList.toggle('show');
        }

        function saveSession() {
            if (!currentUser) { showAuthModal('login'); return; }
            if (!currentSession.length) { showToast('AÃ±ade ejercicios primero', 'error'); return; }
            document.getElementById('sessionDate').valueAsDate = new Date();
            document.getElementById('saveOverlay').classList.add('active');
        }

        function closeSaveModal(e) { if (!e || e.target === e.currentTarget) document.getElementById('saveOverlay').classList.remove('active'); }

        async function confirmSaveSession() {
            var name = document.getElementById('sessionName').value.trim();
            if (!name) { showToast('Pon un nombre a la sesiÃ³n', 'error'); return; }
            
            var data = {
                usuario_id: currentUser.id,
                nombre: name,
                fecha: document.getElementById('sessionDate').value,
                categoria_edad: document.getElementById('sessionCategoria').value,
                objetivo: document.getElementById('sessionObjetivo').value,
                notas: document.getElementById('sessionNotas').value,
                ejercicios: currentSession.map(function(e) { return e.id; }),
                ejercicios_data: currentSession.map(function(e) { return { id: e.id, titulo: e.titulo_ejercicio || e.titulo_video, thumbnail: e.thumbnail_url, duracion: e.duracion }; }),
                duracion_total: currentSession.reduce(function(t, e) { return t + (e.duracion_segundos || 0); }, 0)
            };
            
            var { error } = await db.from('sesiones').insert(data);
            if (error) { showToast('Error: ' + error.message, 'error'); return; }
            
            showToast('âœ… SesiÃ³n guardada', 'success');
            closeSaveModal();
            clearSession();
        }

        function showMySessions() {
            if (!currentUser) { showAuthModal('login'); return; }
            document.getElementById('mySessionsOverlay').classList.add('active');
            loadMySessions();
        }

        function closeMySessionsModal(e) { if (!e || e.target === e.currentTarget) document.getElementById('mySessionsOverlay').classList.remove('active'); }

        async function loadMySessions() {
            var list = document.getElementById('mySessionsList');
            list.innerHTML = '<div class="session-list-loading">Cargando...</div>';
            
            var { data } = await db.from('sesiones').select('*').eq('usuario_id', currentUser.id).order('created_at', { ascending: false });
            
            if (!data || !data.length) {
                list.innerHTML = '<div class="session-list-empty"><div class="session-list-empty-icon">ðŸ“‹</div><p>No tienes sesiones guardadas</p></div>';
                return;
            }
            
            list.innerHTML = data.map(function(s) {
                var thumbs = (s.ejercicios_data || []).slice(0, 4).map(function(e) { return '<img class="my-session-card-thumb" src="' + (e.thumbnail || '') + '">'; }).join('');
                return '<div class="my-session-card" onclick="viewSession(\'' + s.id + '\')">' +
                    '<div class="my-session-card-header"><div class="my-session-card-name">' + s.nombre + '</div><div class="my-session-card-date">' + (s.fecha || '') + '</div></div>' +
                    '<div class="my-session-card-meta"><span>ðŸ“‹ ' + (s.ejercicios || []).length + ' ejercicios</span><span>â±ï¸ ' + Math.round((s.duracion_total || 0) / 60) + ' min</span></div>' +
                    (s.objetivo ? '<div class="my-session-card-objetivo">"' + s.objetivo + '"</div>' : '') +
                    '<div class="my-session-card-thumbs">' + thumbs + '</div>' +
                '</div>';
            }).join('');
        }

        var currentViewSession = null;
        async function viewSession(id) {
            var { data } = await db.from('sesiones').select('*').eq('id', id).single();
            if (!data) return;
            currentViewSession = data;
            
            document.getElementById('viewSessionTitle').textContent = data.nombre;
            document.getElementById('viewSessionMeta').innerHTML = '<span>ðŸ“… ' + (data.fecha || '-') + '</span><span>ðŸ‘¶ ' + (data.categoria_edad || '-') + '</span><span>â±ï¸ ' + Math.round((data.duracion_total || 0) / 60) + ' min</span>';
            document.getElementById('viewSessionObjetivo').textContent = data.objetivo || '';
            
            var exs = (data.ejercicios_data || []).map(function(e, i) {
                return '<div class="view-session-exercise">' +
                    '<div class="view-session-exercise-num">' + (i + 1) + '</div>' +
                    '<img class="view-session-exercise-thumb" src="' + (e.thumbnail || '') + '">' +
                    '<div class="view-session-exercise-info"><div class="view-session-exercise-title">' + e.titulo + '</div><div class="view-session-exercise-meta">' + (e.duracion || '--') + '</div></div>' +
                '</div>';
            }).join('');
            document.getElementById('viewSessionExercises').innerHTML = exs;
            
            closeMySessionsModal();
            document.getElementById('viewSessionOverlay').classList.add('active');
        }

        function closeViewSessionModal(e) { if (!e || e.target === e.currentTarget) document.getElementById('viewSessionOverlay').classList.remove('active'); }

        async function deleteCurrentSession() {
            if (!currentViewSession || !confirm('Â¿Eliminar esta sesiÃ³n?')) return;
            await db.from('sesiones').delete().eq('id', currentViewSession.id);
            closeViewSessionModal();
            showToast('ðŸ—‘ï¸ SesiÃ³n eliminada', 'success');
            showMySessions();
        }

        function copySessionLink() {
            navigator.clipboard.writeText(location.origin + '?session=' + currentViewSession.id);
            showToast('ðŸ”— Link copiado', 'success');
        }

        // ==================== UPLOAD ====================
        function initUploadTemas() {
            var container = document.getElementById('uploadTemas');
            if (!container) return;
            container.innerHTML = TEMAS_TRABAJADOS.map(function(t) {
                return '<span class="upload-tema-chip" onclick="toggleTema(this)" data-tema="' + t + '">' + t + '</span>';
            }).join('');
        }

        function toggleTema(el) {
            var tema = el.dataset.tema;
            var idx = selectedTemas.indexOf(tema);
            if (idx === -1 && selectedTemas.length < 5) {
                selectedTemas.push(tema);
                el.classList.add('selected');
            } else if (idx !== -1) {
                selectedTemas.splice(idx, 1);
                el.classList.remove('selected');
            }
            validateUpload();
        }

        function showUploadModal() {
            if (!currentUser) { showAuthModal('login'); return; }
            // Todos pueden subir, Free no gana XP (se muestra despuÃ©s)
            resetUploadForm();
            document.getElementById('uploadOverlay').classList.add('active');
        }

        function closeUploadModal(e) { if (!e || e.target === e.currentTarget) document.getElementById('uploadOverlay').classList.remove('active'); }

        function resetUploadForm() {
            uploadSource = 'video';
            uploadData = {};
            selectedFamilia = null;
            selectedTemas = [];
            uploadedImageFile = null;
            pizarraImageFile = null;
            
            document.getElementById('uploadUrl').value = '';
            document.getElementById('uploadStatus').textContent = '';
            document.getElementById('uploadExtracted').style.display = 'none';
            document.getElementById('uploadFamiliaSection').style.display = 'none';
            document.getElementById('uploadDescSection').style.display = 'none';
            document.getElementById('uploadTemasSection').style.display = 'none';
            document.getElementById('uploadDetallesSection').style.display = 'none';
            document.getElementById('uploadPizarraSection').style.display = 'none';
            
            document.querySelectorAll('.upload-familia-option').forEach(function(o) { o.classList.remove('selected'); });
            document.querySelectorAll('.upload-tema-chip').forEach(function(c) { c.classList.remove('selected'); });
            document.querySelectorAll('.upload-source-tab').forEach(function(t, i) { t.classList.toggle('active', i === 0); });
            
            document.getElementById('uploadSourceVideo').style.display = 'block';
            document.getElementById('uploadSourceImagen').style.display = 'none';
            document.getElementById('uploadImagePreview').style.display = 'none';
            document.getElementById('uploadImagePlaceholder').style.display = 'flex';
            
            // Reset pizarra
            document.getElementById('pizarraPreview').style.display = 'none';
            document.getElementById('pizarraPlaceholder').style.display = 'block';
            document.getElementById('uploadPizarraBox').classList.remove('has-image');
            
            // Reset word count
            document.getElementById('wordCountNum').textContent = '0';
            document.getElementById('wordCountStatus').textContent = 'âŒ';
            document.getElementById('uploadWordCount').classList.remove('valid');
            
            document.getElementById('uploadDescripcion').value = '';
            document.getElementById('uploadDificultad').value = '';
            document.getElementById('uploadIdioma').value = '';
            document.getElementById('uploadEdad').value = '';
            document.getElementById('uploadJugadores').value = '';
            document.getElementById('uploadPorteros').value = '0';
            document.getElementById('uploadDimensiones').value = '';
            
            document.getElementById('btnSubmitExercise').disabled = true;
        }

        function setUploadSource(source) {
            uploadSource = source;
            document.querySelectorAll('.upload-source-tab').forEach(function(t) { t.classList.remove('active'); });
            event.target.classList.add('active');
            
            document.getElementById('uploadSourceVideo').style.display = source === 'video' ? 'block' : 'none';
            document.getElementById('uploadSourceImagen').style.display = source === 'imagen' ? 'block' : 'none';
            
            if (source === 'imagen') {
                document.getElementById('uploadExtracted').style.display = 'none';
                showUploadSteps();
            }
        }

        function handleImageUpload(e) {
            var file = e.target.files[0];
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) { showToast('Imagen demasiado grande (mÃ¡x 5MB)', 'error'); return; }
            
            uploadedImageFile = file;
            var reader = new FileReader();
            reader.onload = function(ev) {
                document.getElementById('uploadImagePreview').src = ev.target.result;
                document.getElementById('uploadImagePreview').style.display = 'block';
                document.getElementById('uploadImagePlaceholder').style.display = 'none';
                showUploadSteps();
            };
            reader.readAsDataURL(file);
        }

        async function extractVideoInfo() {
            var url = document.getElementById('uploadUrl').value.trim();
            if (!url) { showStatus('Introduce una URL', 'error'); return; }
            
            showStatus('ðŸ”„ Extrayendo datos...', 'loading');
            
            // Detect source
            var source = 'youtube';
            var videoId = null;
            
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                source = 'youtube';
                var m = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|shorts\/)([^&\n?#]+)/);
                videoId = m ? m[1] : null;
            } else if (url.includes('twitter.com') || url.includes('x.com')) {
                source = 'twitter';
                var m = url.match(/(?:twitter|x)\.com\/\w+\/status\/(\d+)/);
                videoId = m ? m[1] : null;
            } else if (url.includes('instagram.com')) {
                source = 'instagram';
                var m = url.match(/instagram\.com\/(?:p|reel|reels)\/([A-Za-z0-9_-]+)/);
                videoId = m ? m[1] : null;
            }
            
            if (!videoId) { showStatus('âŒ URL no vÃ¡lida', 'error'); return; }
            
            uploadData = { source: source, videoId: videoId, videoUrl: url };
            
            if (source === 'youtube') {
                await extractYouTubeData(videoId);
            } else if (source === 'twitter') {
                await extractTwitterData(url);
            } else {
                await extractInstagramData(url);
            }
        }

        async function extractYouTubeData(videoId) {
            uploadData.thumb = 'https://img.youtube.com/vi/' + videoId + '/maxresdefault.jpg';
            
            if (!YT_API_KEY) {
                showStatus('âš ï¸ Sin API Key - datos bÃ¡sicos', 'success');
                showExtractedData();
                return;
            }
            
            try {
                var res = await fetch('https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=' + videoId + '&key=' + YT_API_KEY);
                var data = await res.json();
                
                if (data.error) throw new Error(data.error.message);
                if (!data.items || !data.items.length) throw new Error('Video no encontrado');
                
                var v = data.items[0];
                var dur = parseDuration(v.contentDetails.duration);
                var lang = detectLanguage(v.snippet.defaultAudioLanguage || v.snippet.defaultLanguage);
                
                uploadData.titulo = v.snippet.title;
                uploadData.canal = v.snippet.channelTitle;
                uploadData.descripcion = (v.snippet.description || '').substring(0, 500);
                uploadData.duracion = dur.f;
                uploadData.duracionSeg = dur.s;
                uploadData.vistas = parseInt(v.statistics.viewCount || 0);
                uploadData.likes = parseInt(v.statistics.likeCount || 0);
                uploadData.idioma = lang;
                
                showStatus('âœ… Datos extraÃ­dos ' + LANG_FLAGS[lang], 'success');
                showExtractedData();
            } catch (err) {
                showStatus('âŒ ' + err.message, 'error');
            }
        }

        async function extractTwitterData(url) {
            try {
                var res = await fetch('https://publish.twitter.com/oembed?url=' + encodeURIComponent(url) + '&omit_script=true');
                if (!res.ok) throw new Error('No se pudo cargar');
                var data = await res.json();
                
                uploadData.titulo = 'Tweet de ' + data.author_name;
                uploadData.canal = data.author_name;
                uploadData.embedHtml = data.html;
                
                showStatus('âœ… Tweet cargado', 'success');
                showExtractedData();
            } catch (err) {
                showStatus('âŒ ' + err.message, 'error');
            }
        }

        async function extractInstagramData(url) {
            try {
                var res = await fetch('https://api.instagram.com/oembed?url=' + encodeURIComponent(url) + '&omit_script=true');
                if (!res.ok) throw new Error('Post privado o no disponible');
                var data = await res.json();
                
                uploadData.titulo = data.title || 'Post de Instagram';
                uploadData.canal = data.author_name || 'Instagram';
                uploadData.thumb = data.thumbnail_url;
                
                showStatus('âœ… Instagram cargado', 'success');
                showExtractedData();
            } catch (err) {
                showStatus('âŒ ' + err.message, 'error');
                showUploadSteps();
            }
        }

        function parseDuration(iso) {
            var m = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!m) return { f: '0:00', s: 0 };
            var h = parseInt(m[1] || 0), min = parseInt(m[2] || 0), sec = parseInt(m[3] || 0);
            return { f: h > 0 ? h + ':' + String(min).padStart(2, '0') + ':' + String(sec).padStart(2, '0') : min + ':' + String(sec).padStart(2, '0'), s: h * 3600 + min * 60 + sec };
        }

        function detectLanguage(code) {
            if (!code) return 'es';
            var c = code.substring(0, 2).toLowerCase();
            return ['es', 'en', 'pt', 'it', 'de', 'fr', 'nl'].indexOf(c) !== -1 ? c : 'other';
        }

        function showStatus(msg, type) {
            var el = document.getElementById('uploadStatus');
            el.textContent = msg;
            el.className = 'upload-status ' + type;
        }

        function showExtractedData() {
            document.getElementById('uploadThumb').src = uploadData.thumb || '';
            document.getElementById('uploadPreviewTitle').textContent = uploadData.titulo || 'Video';
            document.getElementById('uploadPreviewChannel').textContent = 'ðŸ“º ' + (uploadData.canal || '-');
            document.getElementById('uploadPreviewViews').textContent = 'ðŸ‘ï¸ ' + formatNumber(uploadData.vistas || 0);
            document.getElementById('uploadPreviewLikes').textContent = 'ðŸ‘ ' + formatNumber(uploadData.likes || 0);
            document.getElementById('uploadPreviewDuration').textContent = 'â±ï¸ ' + (uploadData.duracion || '--');
            document.getElementById('uploadPreviewLang').textContent = LANG_FLAGS[uploadData.idioma] || 'ðŸŒ';
            document.getElementById('uploadCreditChannel').textContent = uploadData.canal || '-';
            
            document.getElementById('uploadExtracted').style.display = 'block';
            showUploadSteps();
        }

        function showUploadSteps() {
            document.getElementById('uploadFamiliaSection').style.display = 'block';
            document.getElementById('uploadDescSection').style.display = 'block';
            document.getElementById('uploadTemasSection').style.display = 'block';
            document.getElementById('uploadDetallesSection').style.display = 'block';
            document.getElementById('uploadPizarraSection').style.display = 'block';
            validateUpload();
        }

        function selectFamilia(familia) {
            selectedFamilia = familia;
            document.querySelectorAll('.upload-familia-option').forEach(function(o) { o.classList.remove('selected'); });
            event.currentTarget.classList.add('selected');
            
            document.getElementById('familiaExtraProfesional').style.display = familia === 'profesional' ? 'block' : 'none';
            document.getElementById('familiaExtraAnalisis').style.display = familia === 'analisis' ? 'block' : 'none';
            
            validateUpload();
        }

        // Word count for description
        function updateWordCount() {
            var text = document.getElementById('uploadDescripcion').value.trim();
            var words = text ? text.split(/\s+/).filter(function(w) { return w.length > 0; }).length : 0;
            var countEl = document.getElementById('uploadWordCount');
            var numEl = document.getElementById('wordCountNum');
            var statusEl = document.getElementById('wordCountStatus');
            
            numEl.textContent = words;
            if (words >= 50) {
                countEl.classList.add('valid');
                statusEl.textContent = 'âœ…';
            } else {
                countEl.classList.remove('valid');
                statusEl.textContent = 'âŒ';
            }
            validateUpload();
        }

        // Pizarra image upload
        var pizarraImageFile = null;
        
        function handlePizarraUpload(e) {
            var file = e.target.files[0];
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) { showToast('Imagen demasiado grande (mÃ¡x 5MB)', 'error'); return; }
            
            pizarraImageFile = file;
            var reader = new FileReader();
            reader.onload = function(ev) {
                document.getElementById('pizarraPreview').src = ev.target.result;
                document.getElementById('pizarraPreview').style.display = 'block';
                document.getElementById('pizarraPlaceholder').style.display = 'none';
                document.getElementById('uploadPizarraBox').classList.add('has-image');
                validateUpload();
            };
            reader.readAsDataURL(file);
        }

        function validateUpload() {
            var hasSource = (uploadSource === 'video' && uploadData.videoId) || (uploadSource === 'imagen' && uploadedImageFile);
            var hasFamilia = selectedFamilia !== null;
            var hasTemas = selectedTemas.length > 0;
            var hasDificultad = document.getElementById('uploadDificultad').value !== '';
            var hasIdioma = document.getElementById('uploadIdioma').value !== '';
            
            var valid = hasSource && hasFamilia && hasTemas && hasDificultad && hasIdioma;
            document.getElementById('btnSubmitExercise').disabled = !valid;
            
            // Update XP - descripciÃ³n solo cuenta si tiene 50+ palabras
            var xp = 50;
            var descText = document.getElementById('uploadDescripcion').value.trim();
            var wordCount = descText ? descText.split(/\s+/).filter(function(w) { return w.length > 0; }).length : 0;
            if (wordCount >= 50) xp += 10;
            if (pizarraImageFile) xp += 50;
            document.getElementById('uploadXpTotal').textContent = '+' + xp + ' XP';
        }

        async function submitExercise() {
            if (!currentUser) return;
            
            var descText = document.getElementById('uploadDescripcion').value.trim();
            var wordCount = descText ? descText.split(/\s+/).filter(function(w) { return w.length > 0; }).length : 0;
            
            var data = {
                source: uploadSource === 'video' ? uploadData.source : 'imagen',
                video_id: uploadData.videoId || null,
                video_url: uploadData.videoUrl || null,
                thumbnail_url: uploadData.thumb || null,
                titulo_video: uploadData.titulo || '',
                titulo_ejercicio: uploadData.titulo || descText.substring(0, 100) || 'Ejercicio',
                canal: uploadData.canal || '',
                descripcion: uploadData.descripcion || '',
                descripcion_usuario: wordCount >= 50 ? descText : null,
                duracion: uploadData.duracion || null,
                duracion_segundos: uploadData.duracionSeg || 0,
                vistas: uploadData.vistas || 0,
                likes: uploadData.likes || 0,
                idioma: document.getElementById('uploadIdioma').value,
                familia: selectedFamilia,
                categorias: selectedTemas,
                dificultad: parseInt(document.getElementById('uploadDificultad').value),
                edad: document.getElementById('uploadEdad').value,
                jugadores: document.getElementById('uploadJugadores').value,
                num_porteros: parseInt(document.getElementById('uploadPorteros').value) || 0,
                dimensiones: document.getElementById('uploadDimensiones').value,
                entrenador: document.getElementById('uploadEntrenador') ? document.getElementById('uploadEntrenador').value : null,
                equipo: document.getElementById('uploadEquipo') ? document.getElementById('uploadEquipo').value : null,
                sistema: document.getElementById('uploadSistema') ? document.getElementById('uploadSistema').value : null,
                subido_por: currentUser.id,
                estado: 'pendiente',
                aprobado: false
            };
            
            // Upload thumbnail image if source is imagen
            if (uploadSource === 'imagen' && uploadedImageFile) {
                var fileName = Date.now() + '_thumb_' + uploadedImageFile.name;
                var { data: fileData, error: fileError } = await db.storage.from('ejercicios').upload(fileName, uploadedImageFile);
                if (fileError) { showToast('Error subiendo imagen', 'error'); return; }
                data.thumbnail_url = db.storage.from('ejercicios').getPublicUrl(fileName).data.publicUrl;
            }
            
            // Upload pizarra image if exists
            if (pizarraImageFile) {
                var pizarraName = Date.now() + '_pizarra_' + pizarraImageFile.name;
                var { data: pizData, error: pizError } = await db.storage.from('ejercicios').upload(pizarraName, pizarraImageFile);
                if (pizError) { showToast('Error subiendo pizarra', 'error'); return; }
                data.pizarra_url = db.storage.from('ejercicios').getPublicUrl(pizarraName).data.publicUrl;
            }
            
            var { error } = await db.from('ejercicios').insert(data);
            if (error) { showToast('Error: ' + error.message, 'error'); return; }
            
            showToast('âœ… Ejercicio enviado para revisiÃ³n', 'success');
            closeUploadModal();
            
            // Mostrar mensaje de XP perdido si es Free
            if (userLimits.plan === 'free') {
                setTimeout(function() {
                    showXpLostModal(60); // 50 base + 10 descripciÃ³n
                }, 500);
            }
        }

        // ==================== UPGRADE MODAL ====================
        function showUpgradeModal(reason, extraData) {
            var icon = 'ðŸš€';
            var title = 'Desbloquea Todo el Potencial';
            var subtitle = 'Accede a todas las funcionalidades premium';
            var blockedText = '';
            
            switch(reason) {
                case 'filtros':
                    icon = 'ðŸ”';
                    title = 'Filtros Avanzados Bloqueados';
                    subtitle = 'Los filtros avanzados son exclusivos para usuarios Pro y Coach';
                    blockedText = 'ðŸ”’ Necesitas Pro o Coach para usar filtros avanzados';
                    break;
                case 'limite':
                    icon = 'ðŸ“º';
                    title = 'Has Alcanzado tu LÃ­mite Mensual';
                    subtitle = 'Has visto ' + userLimits.ejercicios_vistos + ' de ' + userLimits.ejercicios_mes + ' ejercicios este mes';
                    blockedText = 'ðŸ”’ Hazte Pro para ver ejercicios ilimitados';
                    break;
                case 'favoritos':
                    icon = 'â¤ï¸';
                    title = 'Favoritos Bloqueados';
                    subtitle = 'Guarda tus ejercicios favoritos con Pro o Coach';
                    blockedText = 'ðŸ”’ Necesitas Pro o Coach para guardar favoritos';
                    break;
                case 'sesiones':
                    icon = 'ðŸ’¾';
                    title = 'LÃ­mite de Sesiones Alcanzado';
                    subtitle = 'Ya tienes 1 sesiÃ³n guardada (mÃ¡ximo para Free)';
                    blockedText = 'ðŸ”’ Hazte Pro para sesiones ilimitadas';
                    break;
                case 'pizarra':
                    icon = 'ðŸŽ¨';
                    title = 'Pizarra TÃ¡ctica Exclusiva';
                    subtitle = 'Crea grÃ¡ficos profesionales de tus ejercicios';
                    blockedText = 'ðŸ”’ La Pizarra TÃ¡ctica es exclusiva para Coach';
                    document.getElementById('benefitPizarra').style.display = 'flex';
                    document.getElementById('benefitXp').style.display = 'flex';
                    break;
                case 'xp':
                    icon = 'â­';
                    title = 'Gana XP por Tus Contribuciones';
                    subtitle = 'Los usuarios Free no acumulan puntos';
                    blockedText = 'ðŸ”’ Hazte Pro o Coach para ganar XP';
                    document.getElementById('benefitXp').style.display = 'flex';
                    break;
            }
            
            document.getElementById('upgradeIcon').textContent = icon;
            document.getElementById('upgradeTitle').textContent = title;
            document.getElementById('upgradeSubtitle').textContent = subtitle;
            
            if (blockedText) {
                document.getElementById('upgradeFeatureBlocked').style.display = 'block';
                document.getElementById('upgradeBlockedText').textContent = blockedText;
            } else {
                document.getElementById('upgradeFeatureBlocked').style.display = 'none';
            }
            
            document.getElementById('xpLostAlert').style.display = 'none';
            document.getElementById('upgradeOverlay').classList.add('active');
        }

        function showXpLostModal(xpLost) {
            var xpCoach = xpLost * 2;
            
            document.getElementById('upgradeIcon').textContent = 'ðŸ˜¢';
            document.getElementById('upgradeTitle').textContent = 'Â¡Ejercicio Aprobado!';
            document.getElementById('upgradeSubtitle').textContent = 'Pero has perdido puntos por ser Free...';
            document.getElementById('upgradeFeatureBlocked').style.display = 'none';
            
            document.getElementById('xpLostAlert').style.display = 'block';
            document.getElementById('xpLostAmount').textContent = '+' + xpLost + ' XP perdidos';
            document.getElementById('xpCouldHave').textContent = 'Coach habrÃ­as ganado +' + xpCoach + ' XP';
            
            document.getElementById('benefitXp').style.display = 'flex';
            document.getElementById('upgradeOverlay').classList.add('active');
        }

        function closeUpgradeModal(e) {
            if (!e || e.target === e.currentTarget) {
                document.getElementById('upgradeOverlay').classList.remove('active');
                document.getElementById('benefitPizarra').style.display = 'none';
                document.getElementById('benefitXp').style.display = 'none';
            }
        }

        function selectUpgradePlan(plan) {
            selectedUpgradePlan = plan;
            document.querySelectorAll('.upgrade-plan').forEach(function(el) {
                el.classList.remove('recommended');
            });
            event.currentTarget.classList.add('recommended');
        }

        function goToCheckout() {
            // TODO: Integrar con Stripe
            showToast('ðŸš§ Sistema de pagos en desarrollo', 'error');
            closeUpgradeModal();
        }

        // ==================== GAMIFICACIÃ“N ====================
        var gamificationData = null;
        var allBadges = [];
        var rankingData = [];

        async function showProfileModal() {
            if (!currentUser) { showAuthModal('login'); return; }
            document.getElementById('profileOverlay').classList.add('active');
            await loadGamificationData();
        }

        function closeProfileModal(e) {
            if (!e || e.target === e.currentTarget) {
                document.getElementById('profileOverlay').classList.remove('active');
            }
        }

        async function loadGamificationData() {
            if (!currentUser || !db) return;
            
            try {
                // Cargar datos de gamificaciÃ³n del usuario
                var { data, error } = await db.rpc('obtener_gamificacion_usuario', { 
                    p_usuario_id: currentUser.id 
                });
                
                if (error) {
                    console.error('Error cargando gamificaciÃ³n:', error);
                    // Usar datos del perfil como fallback
                    data = buildFallbackGamificationData();
                }
                
                gamificationData = data;
                renderGamificationUI();
                
                // Cargar badges disponibles
                await loadAllBadges();
                
                // Cargar ranking
                await loadRanking();
                
                // Cargar challenges
                await loadChallenges();
                
                // Cargar recompensas pendientes
                await loadPendingRewards();
                
            } catch (e) {
                console.error('Error en gamificaciÃ³n:', e);
            }
        }

        function buildFallbackGamificationData() {
            var p = currentUser.perfil || {};
            return {
                xp_total: p.xp || 0,
                xp_rolling: p.xp_rolling || p.xp || 0,
                nivel: p.nivel || 1,
                titulo: p.titulo || 'Canterano',
                nivel_info: { xp_minimo: 0, xp_maximo: 199, icono: 'âš½', puede_comentar: false, acceso_premium: false },
                siguiente_nivel: { nivel: 2, titulo: 'Juvenil', xp_necesario: 200, xp_faltante: 200 - (p.xp || 0) },
                racha: { actual: p.racha_dias || 0, maxima: p.racha_maxima || 0 },
                estadisticas: { ejercicios_subidos: p.ejercicios_subidos || 0, likes_recibidos: p.likes_recibidos || 0 },
                badges: [],
                xp_por_mes: [],
                ranking: { posicion: null, liga: 'Bronce', liga_icono: 'ðŸ¥‰' }
            };
        }

        function renderGamificationUI() {
            var d = gamificationData;
            var p = currentUser.perfil || {};
            
            // Header
            document.getElementById('profileAvatar').textContent = (p.nombre || currentUser.email)[0].toUpperCase();
            document.getElementById('profileLevelIcon').textContent = d.nivel_info?.icono || 'âš½';
            document.getElementById('profileName').textContent = p.nombre || currentUser.email.split('@')[0];
            
            // Plan badge
            var planBadge = document.getElementById('profilePlanBadge');
            if (p.plan === 'coach') {
                planBadge.textContent = 'COACH';
                planBadge.className = 'plan-badge coach';
                planBadge.style.display = 'inline';
            } else if (p.plan === 'pro') {
                planBadge.textContent = 'PRO';
                planBadge.className = 'plan-badge pro';
                planBadge.style.display = 'inline';
            } else {
                planBadge.style.display = 'none';
            }
            
            document.getElementById('profileLevelTitle').textContent = 'Nivel ' + d.nivel + ' - ' + d.titulo;
            
            // Liga
            var liga = d.ranking?.liga || 'Bronce';
            var ligaEl = document.getElementById('profileLiga');
            ligaEl.textContent = (d.ranking?.liga_icono || 'ðŸ¥‰') + ' ' + liga;
            ligaEl.className = 'liga-badge ' + liga.toLowerCase();
            
            // Stats
            document.getElementById('profileExercises').textContent = d.estadisticas?.ejercicios_subidos || 0;
            document.getElementById('profileLikes').textContent = d.estadisticas?.likes_recibidos || 0;
            document.getElementById('profileBadges').textContent = (d.badges || []).length;
            
            // XP Progress
            document.getElementById('xpLevelBadge').textContent = d.nivel_info?.icono || 'âš½';
            document.getElementById('xpLevelText').textContent = 'Nivel ' + d.nivel;
            document.getElementById('xpLevelSubtitle').textContent = d.titulo;
            
            var xpCurrent = d.xp_rolling || 0;
            var xpMin = d.nivel_info?.xp_minimo || 0;
            var xpMax = d.nivel_info?.xp_maximo || d.siguiente_nivel?.xp_necesario || 200;
            var xpProgress = Math.min(100, ((xpCurrent - xpMin) / (xpMax - xpMin)) * 100);
            
            document.getElementById('xpProgressFill').style.width = xpProgress + '%';
            document.getElementById('xpProgressText').textContent = xpCurrent + ' / ' + xpMax + ' XP';
            
            if (d.siguiente_nivel) {
                document.getElementById('xpNextLevel').innerHTML = '<strong>' + d.siguiente_nivel.xp_faltante + ' XP</strong> para ' + d.siguiente_nivel.titulo;
            } else {
                document.getElementById('xpNextLevel').textContent = 'Â¡Nivel mÃ¡ximo alcanzado!';
            }
            
            // XP por mes (caducidad)
            renderXpMonths(d.xp_por_mes || []);
            
            // Racha
            document.getElementById('rachaValue').textContent = (d.racha?.actual || 0) + ' dÃ­as';
            document.getElementById('rachaMax').textContent = 'RÃ©cord: ' + (d.racha?.maxima || 0) + ' dÃ­as';
            
            var rachaActual = d.racha?.actual || 0;
            if (rachaActual >= 7 && rachaActual % 7 < 1) {
                document.getElementById('rachaBonus').style.display = 'block';
            } else {
                document.getElementById('rachaBonus').style.display = 'none';
            }
            
            // Warning de baja
            document.getElementById('cancelWarningXp').textContent = '-' + (d.xp_total || 0) + ' XP perdidos';
            
            // Beneficios
            renderBenefits(d.nivel);
        }

        function renderXpMonths(xpPorMes) {
            var container = document.getElementById('xpMonths');
            var months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            
            // Obtener Ãºltimos 3 meses
            var now = new Date();
            var html = '';
            
            for (var i = 0; i < 3; i++) {
                var d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                var mesKey = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
                var mesNombre = months[d.getMonth()];
                var xpMes = 0;
                
                // Buscar XP de este mes
                if (xpPorMes) {
                    var found = xpPorMes.find(function(m) { return m.mes === mesKey; });
                    if (found) xpMes = found.xp;
                }
                
                var expiring = i === 2; // El tercer mes estÃ¡ por expirar
                
                html += '<div class="xp-month-card' + (expiring ? ' expiring' : '') + '">' +
                    '<div class="xp-month-name">' + mesNombre + '</div>' +
                    '<div class="xp-month-value">' + formatNumber(xpMes) + '</div>' +
                    (expiring && xpMes > 0 ? '<div class="xp-month-expiry">âš ï¸ Expira pronto</div>' : '') +
                '</div>';
            }
            
            container.innerHTML = html;
        }

        function renderBenefits(currentLevel) {
            var benefits = [
                { icon: 'ðŸ’¬', text: 'Comentar ejercicios', level: 3 },
                { icon: 'â­', text: 'Acceso a Ejercicios Premium', level: 4 },
                { icon: 'ðŸ†', text: 'Foro privado de coaches', level: 5 },
                { icon: 'ðŸ—³ï¸', text: 'Votar Ejercicio de la Semana', level: 6 },
                { icon: 'ðŸ›¡ï¸', text: 'Solicitar ser Moderador', level: 6 },
                { icon: 'ðŸ‘‘', text: '50% descuento mensual', level: 7 }
            ];
            
            var html = benefits.map(function(b) {
                var unlocked = currentLevel >= b.level;
                return '<div class="benefit-item">' +
                    '<div class="benefit-icon">' + b.icon + '</div>' +
                    '<div class="benefit-text">' + b.text + '</div>' +
                    '<div class="benefit-status ' + (unlocked ? 'unlocked' : 'locked') + '">' +
                        (unlocked ? 'âœ… Desbloqueado' : 'Nivel ' + b.level) +
                    '</div>' +
                '</div>';
            }).join('');
            
            document.getElementById('benefitsList').innerHTML = html;
        }

        async function loadAllBadges() {
            if (!db) return;
            
            var { data: badges } = await db.from('badges').select('*').order('id');
            allBadges = badges || [];
            
            var userBadges = gamificationData?.badges || [];
            var userBadgeIds = userBadges.map(function(b) { return b.id; });
            
            document.getElementById('badgesCount').textContent = userBadges.length;
            document.getElementById('badgesTotal').textContent = allBadges.length;
            
            var html = allBadges.map(function(badge) {
                var owned = userBadgeIds.includes(badge.id);
                var userBadge = userBadges.find(function(b) { return b.id === badge.id; });
                var isNew = userBadge && !userBadge.notificado;
                
                return '<div class="badge-item' + (!owned ? ' locked' : '') + (badge.es_raro ? ' rare' : '') + '" ' +
                    'onclick="showBadgeDetail(\'' + badge.id + '\')" title="' + badge.descripcion + '">' +
                    (isNew ? '<div class="badge-new"></div>' : '') +
                    '<div class="badge-icon">' + badge.icono + '</div>' +
                    '<div class="badge-name">' + badge.nombre + '</div>' +
                '</div>';
            }).join('');
            
            document.getElementById('badgesGrid').innerHTML = html;
        }

        function showBadgeDetail(badgeId) {
            var badge = allBadges.find(function(b) { return b.id === badgeId; });
            if (!badge) return;
            
            var userBadges = gamificationData?.badges || [];
            var owned = userBadges.some(function(b) { return b.id === badgeId; });
            
            var msg = badge.icono + ' ' + badge.nombre + '\n\n' +
                badge.descripcion + '\n\n' +
                (owned ? 'âœ… Conseguido' : 'ðŸ”’ AÃºn no conseguido') +
                (badge.xp_bonus > 0 ? '\n+' + badge.xp_bonus + ' XP de bonus' : '') +
                (badge.recompensa_tipo ? '\nðŸŽ Recompensa: ' + badge.recompensa_valor : '');
            
            alert(msg);
        }

        async function loadRanking() {
            if (!db) return;
            
            var { data } = await db.rpc('obtener_ranking_mensual', { p_limite: 10 });
            rankingData = data || [];
            
            var html = rankingData.map(function(r, i) {
                var isMe = currentUser && r.usuario_id === currentUser.id;
                var posClass = i === 0 ? 'gold' : (i === 1 ? 'silver' : (i === 2 ? 'bronze' : ''));
                
                return '<div class="ranking-item' + (isMe ? ' me' : '') + '">' +
                    '<div class="ranking-position ' + posClass + '">' + (i + 1) + '</div>' +
                    '<div class="ranking-avatar">' + (r.nombre || 'U')[0].toUpperCase() + '</div>' +
                    '<div class="ranking-info">' +
                        '<div class="ranking-name">' + (r.nombre || 'Usuario') + 
                            (r.plan === 'coach' ? ' <span class="plan-badge coach">COACH</span>' : '') +
                        '</div>' +
                        '<div class="ranking-title">' + (r.titulo || 'Canterano') + '</div>' +
                    '</div>' +
                    '<div class="ranking-xp">' + formatNumber(r.xp_mes) + ' XP</div>' +
                '</div>';
            }).join('');
            
            if (!html) {
                html = '<div style="padding:24px;text-align:center;color:var(--text-muted);">No hay datos de ranking aÃºn</div>';
            }
            
            document.getElementById('rankingList').innerHTML = html;
        }

        function switchRankingTab(tab) {
            document.querySelectorAll('.ranking-tab').forEach(function(t) {
                t.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            // TODO: Implementar ranking semanal
            if (tab === 'semanal') {
                showToast('Ranking semanal prÃ³ximamente', 'error');
            }
        }

        async function loadChallenges() {
            if (!db) return;
            
            // Obtener semana actual
            var now = new Date();
            var startOfYear = new Date(now.getFullYear(), 0, 1);
            var weekNum = Math.ceil((((now - startOfYear) / 86400000) + startOfYear.getDay() + 1) / 7);
            var semana = now.getFullYear() + '-W' + String(weekNum).padStart(2, '0');
            
            var { data: challenges } = await db.from('challenges')
                .select('*')
                .eq('semana', semana)
                .eq('activo', true);
            
            if (!challenges || !challenges.length) {
                document.getElementById('challengesList').innerHTML = 
                    '<div style="padding:16px;text-align:center;color:var(--text-muted);">No hay challenges esta semana</div>';
                return;
            }
            
            // Obtener progreso del usuario
            var { data: progreso } = await db.from('challenge_progreso')
                .select('*')
                .eq('usuario_id', currentUser.id);
            
            var progresoMap = {};
            if (progreso) {
                progreso.forEach(function(p) { progresoMap[p.challenge_id] = p; });
            }
            
            var html = challenges.map(function(c) {
                var p = progresoMap[c.id] || { progreso: 0, completado: false };
                var percent = Math.min(100, (p.progreso / c.objetivo_cantidad) * 100);
                var daysLeft = 7 - now.getDay();
                
                return '<div class="challenge-card' + (p.completado ? ' challenge-completed' : '') + '">' +
                    '<div class="challenge-header">' +
                        '<div class="challenge-icon">' + c.icono + '</div>' +
                        '<div class="challenge-info">' +
                            '<div class="challenge-title">' + c.titulo + '</div>' +
                            '<div class="challenge-desc">' + c.descripcion + '</div>' +
                        '</div>' +
                        '<div class="challenge-reward">+' + c.xp_recompensa + ' XP</div>' +
                    '</div>' +
                    '<div class="challenge-progress">' +
                        '<div class="challenge-progress-fill" style="width:' + percent + '%"></div>' +
                    '</div>' +
                    '<div class="challenge-progress-text">' +
                        '<span>' + p.progreso + ' / ' + c.objetivo_cantidad + '</span>' +
                        '<span>' + (p.completado ? 'âœ… Completado' : daysLeft + ' dÃ­as restantes') + '</span>' +
                    '</div>' +
                '</div>';
            }).join('');
            
            document.getElementById('challengesList').innerHTML = html;
        }

        async function loadPendingRewards() {
            if (!db) return;
            
            var { data: rewards } = await db.from('recompensas_pendientes')
                .select('*')
                .eq('usuario_id', currentUser.id)
                .eq('usado', false)
                .order('created_at', { ascending: false });
            
            if (!rewards || !rewards.length) {
                document.getElementById('rewardsSection').style.display = 'none';
                return;
            }
            
            document.getElementById('rewardsSection').style.display = 'block';
            
            var html = rewards.map(function(r) {
                var icon = r.tipo === 'descuento' ? 'ðŸ·ï¸' : 'ðŸŽ';
                var title = r.tipo === 'descuento' ? r.valor + '% de descuento' : 'Mes gratis de ' + r.valor;
                var expiry = new Date(r.expira_en);
                var daysLeft = Math.ceil((expiry - new Date()) / 86400000);
                
                return '<div class="reward-card">' +
                    '<div class="reward-icon">' + icon + '</div>' +
                    '<div class="reward-info">' +
                        '<div class="reward-title">' + title + '</div>' +
                        '<div class="reward-desc">' + r.motivo + '</div>' +
                        '<div class="reward-expiry">Expira en ' + daysLeft + ' dÃ­as</div>' +
                    '</div>' +
                    '<button class="reward-btn" onclick="useReward(\'' + r.id + '\')">Usar</button>' +
                '</div>';
            }).join('');
            
            document.getElementById('rewardsList').innerHTML = html;
        }

        async function useReward(rewardId) {
            showToast('ðŸš§ Sistema de recompensas en desarrollo', 'error');
        }

        // Actualizar racha al cargar la pÃ¡gina
        async function checkAndUpdateRacha() {
            if (!currentUser || !db) return;
            
            try {
                var { data, error } = await db.rpc('actualizar_racha', { p_usuario_id: currentUser.id });
                if (data && data.xp_ganado > 0) {
                    showToast('ðŸ”¥ Â¡Racha de ' + data.racha + ' dÃ­as! +' + data.xp_ganado + ' XP', 'success');
                }
                if (data && data.badge_obtenido) {
                    showToast('ðŸŽ–ï¸ Â¡Nuevo badge desbloqueado!', 'success');
                }
            } catch (e) {
                console.error('Error actualizando racha:', e);
            }
        }

        // Cargar gamificaciÃ³n en la home (visible para todos)
        async function loadHomeGamification() {
            await loadHomeRanking();
            await loadHomeChallenge();
            loadHomeBadges();
        }

        async function loadHomeRanking() {
            if (!db) return;
            
            try {
                var { data } = await db.rpc('obtener_ranking_mensual', { p_limite: 5 });
                
                if (!data || !data.length) {
                    document.getElementById('homeRankingList').innerHTML = 
                        '<div style="text-align:center;padding:20px;color:var(--text-muted);">SÃ© el primero en el ranking ðŸš€</div>';
                    return;
                }
                
                var html = data.map(function(r, i) {
                    var posClass = i === 0 ? 'gold' : (i === 1 ? 'silver' : (i === 2 ? 'bronze' : 'normal'));
                    var planBadge = r.plan === 'coach' ? '<span class="plan-badge coach" style="font-size:9px;padding:2px 6px;">COACH</span>' : 
                                    (r.plan === 'pro' ? '<span class="plan-badge pro" style="font-size:9px;padding:2px 6px;">PRO</span>' : '');
                    
                    return '<div class="ranking-mini-item">' +
                        '<div class="ranking-mini-pos ' + posClass + '">' + (i + 1) + '</div>' +
                        '<div class="ranking-mini-avatar">' + (r.nombre || 'U')[0].toUpperCase() + '</div>' +
                        '<div class="ranking-mini-info">' +
                            '<div class="ranking-mini-name">' + (r.nombre || 'Usuario') + ' ' + planBadge + '</div>' +
                            '<div class="ranking-mini-level">' + (r.titulo || 'Canterano') + '</div>' +
                        '</div>' +
                        '<div class="ranking-mini-xp">' + formatNumber(r.xp_mes) + '</div>' +
                    '</div>';
                }).join('');
                
                document.getElementById('homeRankingList').innerHTML = html;
                
            } catch (e) {
                console.error('Error cargando ranking home:', e);
            }
        }

        async function loadHomeChallenge() {
            if (!db) return;
            
            try {
                // Obtener semana actual
                var now = new Date();
                var startOfYear = new Date(now.getFullYear(), 0, 1);
                var weekNum = Math.ceil((((now - startOfYear) / 86400000) + startOfYear.getDay() + 1) / 7);
                var semana = now.getFullYear() + '-W' + String(weekNum).padStart(2, '0');
                
                var { data: challenges } = await db.from('challenges')
                    .select('*')
                    .eq('semana', semana)
                    .eq('activo', true)
                    .limit(1);
                
                if (!challenges || !challenges.length) {
                    document.getElementById('homeChallengeTitle').textContent = 'PrÃ³ximamente';
                    document.getElementById('homeChallengeDesc').textContent = 'Los challenges semanales empezarÃ¡n pronto. Â¡PrepÃ¡rate!';
                    document.getElementById('homeChallengeReward').textContent = 'ðŸŽ Grandes premios';
                    return;
                }
                
                var c = challenges[0];
                var daysLeft = 7 - now.getDay();
                if (daysLeft === 0) daysLeft = 7;
                
                document.getElementById('homeChallengeIcon').textContent = c.icono || 'ðŸŽ¯';
                document.getElementById('homeChallengeTitle').textContent = c.titulo;
                document.getElementById('homeChallengeDesc').textContent = c.descripcion;
                document.getElementById('homeChallengeReward').textContent = 'ðŸŽ +' + c.xp_recompensa + ' XP';
                document.getElementById('homeChallengeCount').textContent = '0 / ' + c.objetivo_cantidad + ' completados';
                document.getElementById('homeChallengeDays').textContent = daysLeft + ' dÃ­as restantes';
                
                // Si el usuario estÃ¡ logueado, cargar su progreso
                if (currentUser) {
                    var { data: progreso } = await db.from('challenge_progreso')
                        .select('*')
                        .eq('usuario_id', currentUser.id)
                        .eq('challenge_id', c.id)
                        .single();
                    
                    if (progreso) {
                        var percent = Math.min(100, (progreso.progreso / c.objetivo_cantidad) * 100);
                        document.getElementById('homeChallengeProgress').style.width = percent + '%';
                        document.getElementById('homeChallengeCount').textContent = progreso.progreso + ' / ' + c.objetivo_cantidad + (progreso.completado ? ' âœ…' : '');
                    }
                }
                
            } catch (e) {
                console.error('Error cargando challenge home:', e);
            }
        }

        async function loadHomeBadges() {
            // Los badges ya estÃ¡n estÃ¡ticos en el HTML, pero podrÃ­amos cargarlos dinÃ¡micamente
            // Por ahora dejamos los predefinidos que muestran variedad
        }

        // ==================== HELPERS ====================
        function scrollToSection(id) { document.getElementById(id).scrollIntoView({ behavior: 'smooth' }); }
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function showToast(msg, type) {
            var t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast ' + type + ' show';
            setTimeout(function() { t.className = 'toast'; }, 3000);
        }

        // Close dropdowns on outside click
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) document.getElementById('userDropdown')?.classList.remove('show');
            if (!e.target.closest('.notif-bell')) document.getElementById('notifDropdown')?.classList.remove('show');
        });

        // Add change listeners for validation
        document.getElementById('uploadDificultad')?.addEventListener('change', validateUpload);
        document.getElementById('uploadIdioma')?.addEventListener('change', validateUpload);
        document.getElementById('uploadDescripcion')?.addEventListener('input', validateUpload);

        // ==================== ONBOARDING ====================
        var currentOnboardingStep = 0;
        var totalOnboardingSteps = 6;

        function showOnboarding(force) {
            // Verificar si ya completÃ³ el onboarding (a menos que se fuerce)
            if (!force && localStorage.getItem('onboarding_completed')) return;
            
            currentOnboardingStep = 0;
            updateOnboardingUI();
            document.getElementById('onboardingOverlay').classList.add('active');
        }

        function closeOnboarding() {
            document.getElementById('onboardingOverlay').classList.remove('active');
            localStorage.setItem('onboarding_completed', 'true');
        }

        function nextOnboardingStep() {
            if (currentOnboardingStep < totalOnboardingSteps - 1) {
                currentOnboardingStep++;
                updateOnboardingUI();
            } else {
                closeOnboarding();
                showToast('ðŸŽ‰ Â¡Bienvenido a Futbol Base TUBE!', 'success');
            }
        }

        function prevOnboardingStep() {
            if (currentOnboardingStep > 0) {
                currentOnboardingStep--;
                updateOnboardingUI();
            }
        }

        function updateOnboardingUI() {
            // Actualizar dots de progreso
            document.querySelectorAll('.onboarding-progress-dot').forEach(function(dot, i) {
                dot.classList.remove('active', 'completed');
                if (i === currentOnboardingStep) dot.classList.add('active');
                if (i < currentOnboardingStep) dot.classList.add('completed');
            });
            
            // Mostrar slide actual
            document.querySelectorAll('.onboarding-slide').forEach(function(slide, i) {
                slide.classList.remove('active');
                if (i === currentOnboardingStep) slide.classList.add('active');
            });
            
            // Mostrar/ocultar botÃ³n atrÃ¡s
            var backBtn = document.getElementById('onboardingBack');
            backBtn.style.display = currentOnboardingStep === 0 ? 'none' : 'block';
            
            // Cambiar texto del botÃ³n siguiente
            var nextBtn = document.getElementById('onboardingNext');
            if (currentOnboardingStep === totalOnboardingSteps - 1) {
                nextBtn.textContent = 'ðŸš€ Â¡Empezar!';
                nextBtn.classList.add('onboarding-btn-start');
            } else {
                nextBtn.textContent = 'Siguiente â†’';
                nextBtn.classList.remove('onboarding-btn-start');
            }
        }

        // Mostrar onboarding para nuevos usuarios despuÃ©s del registro
        function checkShowOnboarding() {
            // Mostrar si es nuevo usuario o nunca lo ha visto
            if (!localStorage.getItem('onboarding_completed')) {
                setTimeout(function() {
                    showOnboarding();
                }, 1000);
            }
        }
    </script>

    <!-- Onboarding Modal -->
    <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-modal">
            <div class="onboarding-progress">
                <div class="onboarding-progress-dot active"></div>
                <div class="onboarding-progress-dot"></div>
                <div class="onboarding-progress-dot"></div>
                <div class="onboarding-progress-dot"></div>
                <div class="onboarding-progress-dot"></div>
                <div class="onboarding-progress-dot"></div>
            </div>
            
            <!-- Slide 1: Bienvenida -->
            <div class="onboarding-slide active">
                <span class="onboarding-icon">ðŸ‘‹</span>
                <h2 class="onboarding-title">Â¡Bienvenido a <span>Futbol Base TUBE</span>!</h2>
                <p class="onboarding-text">La mayor biblioteca de ejercicios de fÃºtbol del mundo, creada por entrenadores como tÃº.</p>
                
                <div class="onboarding-features">
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ“š</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Miles de ejercicios</div>
                            <div class="onboarding-feature-desc">Filtrados y organizados por categorÃ­a, dificultad, edad...</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ‘¥</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Comunidad activa</div>
                            <div class="onboarding-feature-desc">Colabora con otros entrenadores de todo el mundo</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ†</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">GamificaciÃ³n</div>
                            <div class="onboarding-feature-desc">Gana XP, sube de nivel y consigue premios reales</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slide 2: CÃ³mo funciona -->
            <div class="onboarding-slide">
                <span class="onboarding-icon">ðŸŽ¯</span>
                <h2 class="onboarding-title">Â¿CÃ³mo <span>funciona</span>?</h2>
                <p class="onboarding-text">En 3 simples pasos puedes empezar a mejorar tus entrenamientos:</p>
                
                <div class="onboarding-features">
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">1ï¸âƒ£</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Explora y filtra</div>
                            <div class="onboarding-feature-desc">Usa +12 filtros para encontrar el ejercicio perfecto</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">2ï¸âƒ£</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Guarda en sesiones</div>
                            <div class="onboarding-feature-desc">Crea sesiones de entrenamiento con tus ejercicios favoritos</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">3ï¸âƒ£</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Comparte y gana</div>
                            <div class="onboarding-feature-desc">Sube ejercicios y gana XP para subir de nivel</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slide 3: Sistema de XP -->
            <div class="onboarding-slide">
                <span class="onboarding-icon">â­</span>
                <h2 class="onboarding-title">Sistema de <span>XP</span></h2>
                <p class="onboarding-text">Gana puntos de experiencia participando en la comunidad:</p>
                
                <div class="onboarding-xp-example">
                    <div class="onboarding-xp-row">
                        <div class="onboarding-xp-action">ðŸ“¤ Subir ejercicio aprobado</div>
                        <div class="onboarding-xp-points">+50 XP</div>
                    </div>
                    <div class="onboarding-xp-row">
                        <div class="onboarding-xp-action">ðŸŽ¨ Con imagen de pizarra tÃ¡ctica</div>
                        <div class="onboarding-xp-points">+50 XP</div>
                    </div>
                    <div class="onboarding-xp-row">
                        <div class="onboarding-xp-action">â¤ï¸ Recibir un like</div>
                        <div class="onboarding-xp-points">+5 XP</div>
                    </div>
                    <div class="onboarding-xp-row">
                        <div class="onboarding-xp-action">ðŸ”¥ Racha diaria</div>
                        <div class="onboarding-xp-points">+5 XP</div>
                    </div>
                    <div class="onboarding-xp-row">
                        <div class="onboarding-xp-action">ðŸŽ¯ Completar challenge</div>
                        <div class="onboarding-xp-points">+200 XP</div>
                    </div>
                </div>
                
                <div class="onboarding-warning">
                    <div class="onboarding-warning-title">âš ï¸ Â¡Importante!</div>
                    <div class="onboarding-warning-text">Los XP caducan a los 3 meses. Participa regularmente para mantener tu nivel y no perder tu posiciÃ³n en el ranking.</div>
                </div>
            </div>
            
            <!-- Slide 4: Niveles -->
            <div class="onboarding-slide">
                <span class="onboarding-icon">ðŸ“ˆ</span>
                <h2 class="onboarding-title">Sube de <span>Nivel</span></h2>
                <p class="onboarding-text">Cada nivel desbloquea nuevos beneficios:</p>
                
                <div class="onboarding-levels">
                    <div class="onboarding-level">
                        <div class="onboarding-level-icon">âš½</div>
                        <div class="onboarding-level-name">Canterano</div>
                    </div>
                    <div class="onboarding-level">
                        <div class="onboarding-level-icon">ðŸ¥‰</div>
                        <div class="onboarding-level-name">Juvenil</div>
                    </div>
                    <div class="onboarding-level">
                        <div class="onboarding-level-icon">ðŸ¥ˆ</div>
                        <div class="onboarding-level-name">Amateur</div>
                    </div>
                    <div class="onboarding-level">
                        <div class="onboarding-level-icon">ðŸ¥‡</div>
                        <div class="onboarding-level-name">Semi-Pro</div>
                    </div>
                    <div class="onboarding-level highlighted">
                        <div class="onboarding-level-icon">â­</div>
                        <div class="onboarding-level-name">Profesional</div>
                    </div>
                    <div class="onboarding-level">
                        <div class="onboarding-level-icon">ðŸ’Ž</div>
                        <div class="onboarding-level-name">Ã‰lite</div>
                    </div>
                    <div class="onboarding-level highlighted">
                        <div class="onboarding-level-icon">ðŸ‘‘</div>
                        <div class="onboarding-level-name">Leyenda</div>
                    </div>
                </div>
                
                <div class="onboarding-features">
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ’¬</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Nivel 3: Comentarios</div>
                            <div class="onboarding-feature-desc">Comenta en los ejercicios de otros</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">â­</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Nivel 4: Ejercicios Premium</div>
                            <div class="onboarding-feature-desc">Acceso a ejercicios de Ã©lite</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ‘‘</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Nivel 7: 50% Descuento</div>
                            <div class="onboarding-feature-desc">Descuento permanente en tu suscripciÃ³n</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slide 5: Badges y Ranking -->
            <div class="onboarding-slide">
                <span class="onboarding-icon">ðŸ…</span>
                <h2 class="onboarding-title"><span>Badges</span> y Ranking</h2>
                <p class="onboarding-text">Colecciona badges y compite en el ranking mensual:</p>
                
                <div class="onboarding-badges-grid">
                    <div class="onboarding-badge">
                        <div class="onboarding-badge-icon">ðŸ†</div>
                        <div class="onboarding-badge-name">Primer Ejercicio</div>
                    </div>
                    <div class="onboarding-badge">
                        <div class="onboarding-badge-icon">ðŸ”¥</div>
                        <div class="onboarding-badge-name">En Racha</div>
                    </div>
                    <div class="onboarding-badge rare">
                        <div class="onboarding-badge-icon">âš¡</div>
                        <div class="onboarding-badge-name">Imparable</div>
                    </div>
                    <div class="onboarding-badge rare">
                        <div class="onboarding-badge-icon">ðŸ‘‘</div>
                        <div class="onboarding-badge-name">Leyenda</div>
                    </div>
                </div>
                
                <div class="onboarding-features">
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ¥‡</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Top 1 Mensual: 50% descuento</div>
                            <div class="onboarding-feature-desc">El campeÃ³n del mes gana 50% en su siguiente pago</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ¥ˆ</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Top 3: 25% descuento</div>
                            <div class="onboarding-feature-desc">El podio tambiÃ©n tiene premio</div>
                        </div>
                    </div>
                </div>
                
                <div class="ligas-preview" style="margin-top: 20px;">
                    <div class="liga-mini bronce">ðŸ¥‰ Bronce</div>
                    <div class="liga-mini plata">ðŸ¥ˆ Plata</div>
                    <div class="liga-mini oro">ðŸ¥‡ Oro</div>
                    <div class="liga-mini diamante">ðŸ’Ž Diamante</div>
                    <div class="liga-mini elite">ðŸ‘‘ Ã‰lite</div>
                </div>
            </div>
            
            <!-- Slide 6: Â¡Empieza! -->
            <div class="onboarding-slide">
                <span class="onboarding-icon">ðŸš€</span>
                <h2 class="onboarding-title">Â¡Todo <span>listo</span>!</h2>
                <p class="onboarding-text">Ya conoces cÃ³mo funciona. Ahora te toca a ti:</p>
                
                <div class="onboarding-features">
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ“š</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Explora la biblioteca</div>
                            <div class="onboarding-feature-desc">Encuentra ejercicios perfectos para tu equipo</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸ“¤</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Sube tu primer ejercicio</div>
                            <div class="onboarding-feature-desc">Comparte con la comunidad y gana +50 XP</div>
                        </div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">ðŸŽ¯</div>
                        <div class="onboarding-feature-text">
                            <div class="onboarding-feature-title">Completa el challenge</div>
                            <div class="onboarding-feature-desc">Mira el reto de esta semana y participa</div>
                        </div>
                    </div>
                </div>
                
                <div class="onboarding-warning" style="background: rgba(13, 159, 79, 0.1); border-color: rgba(13, 159, 79, 0.3);">
                    <div class="onboarding-warning-title" style="color: var(--primary);">ðŸ’¡ Consejo</div>
                    <div class="onboarding-warning-text">Puedes volver a ver este tutorial en cualquier momento haciendo clic en el botÃ³n <strong>â“</strong> en la esquina inferior derecha.</div>
                </div>
            </div>
            
            <div class="onboarding-footer">
                <button class="onboarding-skip" onclick="closeOnboarding()">Saltar tutorial</button>
                <div class="onboarding-nav">
                    <button class="onboarding-btn onboarding-btn-back" id="onboardingBack" onclick="prevOnboardingStep()" style="display:none;">â† AtrÃ¡s</button>
                    <button class="onboarding-btn onboarding-btn-next" id="onboardingNext" onclick="nextOnboardingStep()">Siguiente â†’</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Button Flotante -->
    <div class="help-button" onclick="showOnboarding(true)" title="Ver tutorial">â“</div>
</body>
</html>
